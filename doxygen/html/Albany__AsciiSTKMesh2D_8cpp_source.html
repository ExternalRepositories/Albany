<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Albany: a Trilinos-based PDE code: Albany_AsciiSTKMesh2D.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>Albany_AsciiSTKMesh2D.cpp</h1>  </div>
</div>
<div class="contents">
<a href="Albany__AsciiSTKMesh2D_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//*****************************************************************//</span>
<a name="l00002"></a>00002 <span class="comment">//    Albany 2.0:  Copyright 2012 Sandia Corporation               //</span>
<a name="l00003"></a>00003 <span class="comment">//    This Software is released under the BSD license detailed     //</span>
<a name="l00004"></a>00004 <span class="comment">//    in the file &quot;license.txt&quot; in the top-level Albany directory  //</span>
<a name="l00005"></a>00005 <span class="comment">//*****************************************************************//</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="Albany__AsciiSTKMesh2D_8hpp.html">Albany_AsciiSTKMesh2D.hpp</a>&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;Teuchos_VerboseObject.hpp&quot;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;Shards_BasicTopologies.hpp&gt;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;stk_mesh/base/Entity.hpp&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;stk_mesh/base/GetEntities.hpp&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;stk_mesh/base/GetBuckets.hpp&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;stk_mesh/base/FieldData.hpp&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;stk_mesh/base/Selector.hpp&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#ifdef ALBANY_SEACAS</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stk_io/IossBridge.hpp&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#endif</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>
<a name="l00024"></a>00024 <span class="comment">//#include &lt;stk_mesh/fem/FEMHelpers.hpp&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;boost/algorithm/string/predicate.hpp&gt;</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="Albany__Utils_8hpp.html">Albany_Utils.hpp</a>&quot;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a9ef9e4bde77a405a5ce18d485068a00a">00029</a> <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a9ef9e4bde77a405a5ce18d485068a00a">Albany::AsciiSTKMesh2D::AsciiSTKMesh2D</a>(
<a name="l00030"></a>00030     <span class="keyword">const</span> Teuchos::RCP&lt;Teuchos::ParameterList&gt;&amp; params,
<a name="l00031"></a>00031     <span class="keyword">const</span> Teuchos::RCP&lt;const Epetra_Comm&gt;&amp; <a class="code" href="felix__driver_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>) :
<a name="l00032"></a>00032     <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html">GenericSTKMeshStruct</a>(params, Teuchos::null, 2), out(
<a name="l00033"></a>00033         Teuchos::VerboseObjectBase::getDefaultOStream()), periodic(false), sh(0) {
<a name="l00034"></a>00034   std::string fname = params-&gt;get(<span class="stringliteral">&quot;Ascii Input Mesh File Name&quot;</span>,
<a name="l00035"></a>00035       <span class="stringliteral">&quot;greenland.msh&quot;</span>);
<a name="l00036"></a>00036 
<a name="l00037"></a>00037   std::string shape;
<a name="l00038"></a>00038   <span class="keywordflow">if</span> (comm-&gt;MyPID() == 0) {
<a name="l00039"></a>00039     std::ifstream ifile;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041     <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#af081a2d8e534e620452ccacb4699d007">NumElemNodes</a> = 0;
<a name="l00042"></a>00042     ifile.open(fname.c_str());
<a name="l00043"></a>00043     <span class="keywordflow">if</span> (ifile.is_open()) {
<a name="l00044"></a>00044       ifile &gt;&gt; shape &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#af081a2d8e534e620452ccacb4699d007">NumElemNodes</a>;
<a name="l00045"></a>00045       <span class="keywordflow">if</span>(shape == <span class="stringliteral">&quot;Triangle&quot;</span>) {
<a name="l00046"></a>00046         TEUCHOS_TEST_FOR_EXCEPTION(NumElemNodes != 3, Teuchos::Exceptions::InvalidParameter,
<a name="l00047"></a>00047                   std::endl &lt;&lt; <span class="stringliteral">&quot;Error in AsciiSTKMesh2D: Triangles must be linear. Number of nodes per element in file &quot;</span> &lt;&lt; fname &lt;&lt; <span class="stringliteral">&quot; is: &quot;</span> &lt;&lt; NumElemNodes &lt;&lt; <span class="stringliteral">&quot;. Should be 3!&quot;</span> &lt;&lt; std::endl);
<a name="l00048"></a>00048       }
<a name="l00049"></a>00049       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(shape == <span class="stringliteral">&quot;Quadrilateral&quot;</span>) {
<a name="l00050"></a>00050         TEUCHOS_TEST_FOR_EXCEPTION(NumElemNodes != 4, Teuchos::Exceptions::InvalidParameter,
<a name="l00051"></a>00051                   std::endl &lt;&lt; <span class="stringliteral">&quot;Error in AsciiSTKMesh2D: Quadrilaterals must be bilinear. Number of nodes per element in file &quot;</span> &lt;&lt; fname &lt;&lt; <span class="stringliteral">&quot; is: &quot;</span>  &lt;&lt; <span class="stringliteral">&quot; is: &quot;</span> &lt;&lt; NumElemNodes &lt;&lt; <span class="stringliteral">&quot;. Should be 4!&quot;</span> &lt;&lt; std::endl);
<a name="l00052"></a>00052       }
<a name="l00053"></a>00053       <span class="keywordflow">else</span>
<a name="l00054"></a>00054         TEUCHOS_TEST_FOR_EXCEPTION(<span class="keyword">true</span>, Teuchos::Exceptions::InvalidParameter,
<a name="l00055"></a>00055                           std::endl &lt;&lt; <span class="stringliteral">&quot;Error in AsciiSTKMesh2D: Only Triangle or Quadrilateral grids can be imported. Shape in in file &quot;</span> &lt;&lt; fname &lt;&lt; <span class="stringliteral">&quot; is: &quot;</span> &lt;&lt; shape &lt;&lt; <span class="stringliteral">&quot;. Should be Triangle or Quadrialteral&quot;</span> &lt;&lt; std::endl);
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 
<a name="l00058"></a>00058       ifile &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#af84d754c1754833c74a3098d17798a00">NumNodes</a> &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#afe4f4b203f56ed4a838388f79c59483a">NumEles</a> &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a6e020d9e622ea57d34c304f9125262f6">NumBdEdges</a>;
<a name="l00059"></a>00059       <span class="comment">//read in nodes coordinates</span>
<a name="l00060"></a>00060       <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a38bb018af7042dcc705a3b4f3902b73c">xyz</a> = <span class="keyword">new</span> <span class="keywordtype">double</span>[<a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#af84d754c1754833c74a3098d17798a00">NumNodes</a>][3];
<a name="l00061"></a>00061       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#af84d754c1754833c74a3098d17798a00">NumNodes</a>; i++) {
<a name="l00062"></a>00062         ifile &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a38bb018af7042dcc705a3b4f3902b73c">xyz</a>[i][0] &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a38bb018af7042dcc705a3b4f3902b73c">xyz</a>[i][1] &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a38bb018af7042dcc705a3b4f3902b73c">xyz</a>[i][2];
<a name="l00063"></a>00063       }
<a name="l00064"></a>00064 
<a name="l00065"></a>00065       <span class="comment">//read in element connectivity</span>
<a name="l00066"></a>00066       <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a37099531a396152d71598368050d557c">eles</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#afe4f4b203f56ed4a838388f79c59483a">NumEles</a>][4];
<a name="l00067"></a>00067       <span class="keywordtype">int</span> temp;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069       <span class="keywordflow">if</span>(shape == <span class="stringliteral">&quot;Triangle&quot;</span>)
<a name="l00070"></a>00070         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#afe4f4b203f56ed4a838388f79c59483a">NumEles</a>; i++) {
<a name="l00071"></a>00071           ifile &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a37099531a396152d71598368050d557c">eles</a>[i][0] &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a37099531a396152d71598368050d557c">eles</a>[i][1] &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a37099531a396152d71598368050d557c">eles</a>[i][2] &gt;&gt; temp;
<a name="l00072"></a>00072         }
<a name="l00073"></a>00073       <span class="keywordflow">else</span>
<a name="l00074"></a>00074         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; NumEles; i++) {
<a name="l00075"></a>00075           ifile &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a37099531a396152d71598368050d557c">eles</a>[i][0] &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a37099531a396152d71598368050d557c">eles</a>[i][1] &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a37099531a396152d71598368050d557c">eles</a>[i][2] &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a37099531a396152d71598368050d557c">eles</a>[i][3] &gt;&gt; temp;
<a name="l00076"></a>00076         }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078       <span class="comment">//read in boundary edges connectivity</span>
<a name="l00079"></a>00079       <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a455f70dd382bd13082263081e917a519">be</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[NumBdEdges][2];
<a name="l00080"></a>00080       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; NumBdEdges; i++) {
<a name="l00081"></a>00081         ifile &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a455f70dd382bd13082263081e917a519">be</a>[i][0] &gt;&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a455f70dd382bd13082263081e917a519">be</a>[i][1] &gt;&gt; temp;
<a name="l00082"></a>00082       }
<a name="l00083"></a>00083       ifile.close();
<a name="l00084"></a>00084     } <span class="keywordflow">else</span> {
<a name="l00085"></a>00085       TEUCHOS_TEST_FOR_EXCEPTION(<span class="keyword">true</span>, Teuchos::Exceptions::InvalidParameter,
<a name="l00086"></a>00086           std::endl &lt;&lt; <span class="stringliteral">&quot;Error in AsciiSTKMesh2D: Input Mesh File &quot;</span> &lt;&lt; fname &lt;&lt; <span class="stringliteral">&quot; not found!&quot;</span>&lt;&lt; std::endl);
<a name="l00087"></a>00087     }
<a name="l00088"></a>00088   }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090   comm-&gt;Broadcast(&amp;<a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#af081a2d8e534e620452ccacb4699d007">NumElemNodes</a>, 1, 0);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092   params-&gt;validateParameters(*<a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a28e1ed9a57c357604c70b9c905ae101c">getValidDiscretizationParameters</a>(), 0);
<a name="l00093"></a>00093 
<a name="l00094"></a>00094   std::string ebn = <span class="stringliteral">&quot;Element Block 0&quot;</span>;
<a name="l00095"></a>00095   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a7f5a8f068baee4ccb3b557d0ea267b4a">partVec</a>[0] = &amp;<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;declare_part(ebn, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;element_rank());
<a name="l00096"></a>00096   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a1fe4dbe7e44920f111a80ffd008f1e37">ebNameToIndex</a>[ebn] = 0;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="preprocessor">#ifdef ALBANY_SEACAS</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span>  <span class="comment">//  stk::io::put_io_part_attribute(metaData-&gt;universal_part());</span>
<a name="l00100"></a>00100   stk::io::put_io_part_attribute(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a7f5a8f068baee4ccb3b557d0ea267b4a">partVec</a>[0]);
<a name="l00101"></a>00101 <span class="preprocessor">#endif</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>
<a name="l00103"></a>00103   std::vector &lt; std::string &gt; nsNames;
<a name="l00104"></a>00104   std::string <a class="code" href="felix__driver_8cpp.html#ab535ad6429f94303bc2e0347bb388e0d">nsn</a> = <span class="stringliteral">&quot;Node&quot;</span>;
<a name="l00105"></a>00105   nsNames.push_back(nsn);
<a name="l00106"></a>00106   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a2537c7892b3f78ca370d4f6f89e940e7">nsPartVec</a>[nsn] = &amp;<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;declare_part(nsn, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;node_rank());
<a name="l00107"></a>00107 <span class="preprocessor">#ifdef ALBANY_SEACAS</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span>  stk::io::put_io_part_attribute(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a2537c7892b3f78ca370d4f6f89e940e7">nsPartVec</a>[nsn]);
<a name="l00109"></a>00109 <span class="preprocessor">#endif</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span>
<a name="l00111"></a>00111   std::vector &lt; std::string &gt; ssNames;
<a name="l00112"></a>00112   std::string ssn = <span class="stringliteral">&quot;LateralSide&quot;</span>;
<a name="l00113"></a>00113   ssNames.push_back(ssn);
<a name="l00114"></a>00114   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#ae5e5266d1857bf139c408182987ec81d">ssPartVec</a>[ssn] = &amp;<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;declare_part(ssn, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;side_rank());
<a name="l00115"></a>00115 <span class="preprocessor">#ifdef ALBANY_SEACAS</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>  stk::io::put_io_part_attribute(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#ae5e5266d1857bf139c408182987ec81d">ssPartVec</a>[ssn]);
<a name="l00117"></a>00117   stk::io::put_io_part_attribute(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;universal_part());
<a name="l00118"></a>00118 <span class="preprocessor">#endif</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>
<a name="l00120"></a>00120   <span class="keywordflow">if</span>(<a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#af081a2d8e534e620452ccacb4699d007">NumElemNodes</a> == 3)
<a name="l00121"></a>00121     stk::mesh::fem::set_cell_topology&lt;shards::Triangle&lt;3&gt; &gt;(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a7f5a8f068baee4ccb3b557d0ea267b4a">partVec</a>[0]);
<a name="l00122"></a>00122   <span class="keywordflow">else</span>
<a name="l00123"></a>00123     stk::mesh::fem::set_cell_topology&lt;shards::Quadrilateral&lt;4&gt; &gt;(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a7f5a8f068baee4ccb3b557d0ea267b4a">partVec</a>[0]);
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   stk::mesh::fem::set_cell_topology&lt;shards::Line&lt;2&gt; &gt;(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#ae5e5266d1857bf139c408182987ec81d">ssPartVec</a>[ssn]);
<a name="l00126"></a>00126   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a302b929f043c676f028876f393978787">numDim</a> = 2;
<a name="l00127"></a>00127   <span class="keywordtype">int</span> cub = params-&gt;get(<span class="stringliteral">&quot;Cubature Degree&quot;</span>, 3);
<a name="l00128"></a>00128   <span class="keywordtype">int</span> worksetSizeMax = params-&gt;get(<span class="stringliteral">&quot;Workset Size&quot;</span>, 50);
<a name="l00129"></a>00129   <span class="keywordtype">int</span> worksetSize = this-&gt;<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a65a072dfa4df218a71f3ea0f88b6fdd2" title="Utility function that uses some integer arithmetic to choose a good worksetSize.">computeWorksetSize</a>(worksetSizeMax, <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#afe4f4b203f56ed4a838388f79c59483a">NumEles</a>);
<a name="l00130"></a>00130   *<a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a72b3afbcbe633fa132cd7c295d54adf4">out</a> &lt;&lt; __LINE__ &lt;&lt; std::endl;
<a name="l00131"></a>00131   <span class="keyword">const</span> CellTopologyData&amp; ctd =
<a name="l00132"></a>00132       *<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;get_cell_topology(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a7f5a8f068baee4ccb3b557d0ea267b4a">partVec</a>[0]).getCellTopologyData();
<a name="l00133"></a>00133   <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a4a4f61de6a24d9180ab8a234c8c532a2">cullSubsetParts</a>(ssNames, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#ae5e5266d1857bf139c408182987ec81d">ssPartVec</a>);
<a name="l00134"></a>00134   this-&gt;<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#aa5b51847bf2f760e188e953d00d250e9">meshSpecs</a>[0] = Teuchos::rcp(
<a name="l00135"></a>00135       <span class="keyword">new</span> <a class="code" href="structAlbany_1_1MeshSpecsStruct.html">Albany::MeshSpecsStruct</a>(ctd, numDim, cub, nsNames, ssNames,
<a name="l00136"></a>00136           worksetSize, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a7f5a8f068baee4ccb3b557d0ea267b4a">partVec</a>[0]-&gt;name(), <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a1fe4dbe7e44920f111a80ffd008f1e37">ebNameToIndex</a>,
<a name="l00137"></a>00137           this-&gt;<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a69d84e0494e6ab2a2c78201c8d5224fa">interleavedOrdering</a>));
<a name="l00138"></a>00138   std::cout &lt;&lt; <span class="stringliteral">&quot;Spatial dim: &quot;</span> &lt;&lt; <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;spatial_dimension() &lt;&lt; std::endl;
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a9bd81ec661074812497609623ecd3acc">00141</a> <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a9bd81ec661074812497609623ecd3acc">Albany::AsciiSTKMesh2D::~AsciiSTKMesh2D</a>() {
<a name="l00142"></a>00142   <span class="keyword">delete</span>[] <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a38bb018af7042dcc705a3b4f3902b73c">xyz</a>;
<a name="l00143"></a>00143   <span class="keyword">delete</span>[] <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a455f70dd382bd13082263081e917a519">be</a>;
<a name="l00144"></a>00144   <span class="keyword">delete</span>[] <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a37099531a396152d71598368050d557c">eles</a>;
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a><a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a7e3d2ebed3ca81b7e862f58cc9a6bf87">00147</a> <span class="keywordtype">void</span> <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a7e3d2ebed3ca81b7e862f58cc9a6bf87">Albany::AsciiSTKMesh2D::setFieldAndBulkData</a>(
<a name="l00148"></a>00148     <span class="keyword">const</span> Teuchos::RCP&lt;const Epetra_Comm&gt;&amp; <a class="code" href="felix__driver_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>,
<a name="l00149"></a>00149     <span class="keyword">const</span> Teuchos::RCP&lt;Teuchos::ParameterList&gt;&amp; params, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neq_,
<a name="l00150"></a>00150     <span class="keyword">const</span> <a class="code" href="classAlbany_1_1AbstractFieldContainer.html#a2bfe39ada257455a2bbe082a0b743704">AbstractFieldContainer::FieldContainerRequirements</a>&amp; req,
<a name="l00151"></a>00151     <span class="keyword">const</span> Teuchos::RCP&lt;Albany::StateInfoStruct&gt;&amp; <a class="code" href="InterfaceTry_8cpp.html#a22a797db574d6de7b11c63d19b59ce22">sis</a>,
<a name="l00152"></a>00152     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> worksetSize) {
<a name="l00153"></a>00153   this-&gt;<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#ae82d1109009b447cbc774991cd23d8dd">SetupFieldData</a>(comm, neq_, req, sis, worksetSize);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;commit();
<a name="l00156"></a>00156 
<a name="l00157"></a>00157   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;modification_begin(); <span class="comment">// Begin modifying the mesh</span>
<a name="l00158"></a>00158 
<a name="l00159"></a>00159   stk::mesh::PartVector nodePartVec;
<a name="l00160"></a>00160   stk::mesh::PartVector singlePartVec(1);
<a name="l00161"></a>00161   std::cout &lt;&lt; <span class="stringliteral">&quot;elem_map # elments: &quot;</span> &lt;&lt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#afe4f4b203f56ed4a838388f79c59483a">NumEles</a> &lt;&lt; std::endl;
<a name="l00162"></a>00162   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ebNo = 0; <span class="comment">//element block #???</span>
<a name="l00163"></a>00163   <span class="keywordtype">int</span> sideID = 0;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   <a class="code" href="classAlbany_1_1AbstractSTKFieldContainer.html#a9f8c0890f03fd3c85d90028183aefcb4">AbstractSTKFieldContainer::IntScalarFieldType</a>* proc_rank_field =
<a name="l00166"></a>00166       <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#aeb01f5da92ae994535ad182db65d0841">fieldContainer</a>-&gt;getProcRankField();
<a name="l00167"></a>00167   <a class="code" href="classAlbany_1_1AbstractSTKFieldContainer.html#ab29b7b67367d394e0364838c6e3fcf73">AbstractSTKFieldContainer::VectorFieldType</a>* coordinates_field =
<a name="l00168"></a>00168       <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#aeb01f5da92ae994535ad182db65d0841">fieldContainer</a>-&gt;getCoordinatesField();
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   singlePartVec[0] = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a2537c7892b3f78ca370d4f6f89e940e7">nsPartVec</a>[<span class="stringliteral">&quot;Node&quot;</span>];
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#af84d754c1754833c74a3098d17798a00">NumNodes</a>; i++) {
<a name="l00173"></a>00173     <a class="code" href="namespaceAAdapt.html#a6e672c66f1cfcf2ba9f8baf4a51e0381">stk::mesh::Entity</a>&amp; node = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;declare_entity(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;node_rank(),
<a name="l00174"></a>00174         i + 1, singlePartVec);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="keywordtype">double</span>* coord;
<a name="l00177"></a>00177     coord = stk::mesh::field_data(*coordinates_field, node);
<a name="l00178"></a>00178     coord[0] = <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a38bb018af7042dcc705a3b4f3902b73c">xyz</a>[i][0];
<a name="l00179"></a>00179     coord[1] = <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a38bb018af7042dcc705a3b4f3902b73c">xyz</a>[i][1];
<a name="l00180"></a>00180     coord[2] = 0.; <span class="comment">//xyz[i][2];</span>
<a name="l00181"></a>00181   }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#afe4f4b203f56ed4a838388f79c59483a">NumEles</a>; i++) {
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     singlePartVec[0] = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a7f5a8f068baee4ccb3b557d0ea267b4a">partVec</a>[ebNo];
<a name="l00186"></a>00186     <a class="code" href="namespaceAAdapt.html#a6e672c66f1cfcf2ba9f8baf4a51e0381">stk::mesh::Entity</a>&amp; elem = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;declare_entity(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;element_rank(),
<a name="l00187"></a>00187         i + 1, singlePartVec);
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#af081a2d8e534e620452ccacb4699d007">NumElemNodes</a>; j++) {
<a name="l00190"></a>00190       <a class="code" href="namespaceAAdapt.html#a6e672c66f1cfcf2ba9f8baf4a51e0381">stk::mesh::Entity</a>&amp; node = *<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;get_entity(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;node_rank(),
<a name="l00191"></a>00191           <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a37099531a396152d71598368050d557c">eles</a>[i][j]);
<a name="l00192"></a>00192       <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;declare_relation(elem, node, j);
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="comment">//  int* p_rank = stk::mesh::field_data(*proc_rank_field, elem);</span>
<a name="l00196"></a>00196     <span class="comment">//    p_rank[0] = comm-&gt;MyPID();</span>
<a name="l00197"></a>00197   }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199   std::map&lt;std::pair&lt;int, int&gt;, <span class="keywordtype">int</span>&gt; edgeMap;
<a name="l00200"></a>00200   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a6e020d9e622ea57d34c304f9125262f6">NumBdEdges</a>; i++)
<a name="l00201"></a>00201     edgeMap.insert(
<a name="l00202"></a>00202         std::pair&lt;std::pair&lt;int, int&gt;, <span class="keywordtype">int</span>&gt;(std::make_pair(<a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a455f70dd382bd13082263081e917a519">be</a>[i][0], <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a455f70dd382bd13082263081e917a519">be</a>[i][1]),
<a name="l00203"></a>00203             i + 1));
<a name="l00204"></a>00204 
<a name="l00205"></a>00205   singlePartVec[0] = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#ae5e5266d1857bf139c408182987ec81d">ssPartVec</a>[<span class="stringliteral">&quot;LateralSide&quot;</span>];
<a name="l00206"></a>00206   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; NumEles; i++) {
<a name="l00207"></a>00207     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#af081a2d8e534e620452ccacb4699d007">NumElemNodes</a>; j++) {
<a name="l00208"></a>00208       std::map&lt;std::pair&lt;int, int&gt;, <span class="keywordtype">int</span>&gt;::iterator it = edgeMap.find(
<a name="l00209"></a>00209           std::make_pair(<a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a37099531a396152d71598368050d557c">eles</a>[i][j], <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a37099531a396152d71598368050d557c">eles</a>[i][(j + 1) % NumElemNodes]));
<a name="l00210"></a>00210       <span class="keywordflow">if</span> (it != edgeMap.end()) {
<a name="l00211"></a>00211         <a class="code" href="namespaceAAdapt.html#a6e672c66f1cfcf2ba9f8baf4a51e0381">stk::mesh::Entity</a>&amp; side = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;declare_entity(
<a name="l00212"></a>00212             <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;side_rank(), it-&gt;second, singlePartVec);
<a name="l00213"></a>00213         <a class="code" href="namespaceAAdapt.html#a6e672c66f1cfcf2ba9f8baf4a51e0381">stk::mesh::Entity</a>&amp; elem = *<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;get_entity(
<a name="l00214"></a>00214             <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;element_rank(), i + 1);
<a name="l00215"></a>00215         <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;declare_relation(elem, side, j <span class="comment">/*local side id*/</span>);
<a name="l00216"></a>00216         stk::mesh::PairIterRelation rel_elemNodes = elem.relations(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;node_rank());
<a name="l00217"></a>00217         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 2; k++) {
<a name="l00218"></a>00218           <a class="code" href="namespaceAAdapt.html#a6e672c66f1cfcf2ba9f8baf4a51e0381">stk::mesh::Entity</a>&amp; node = *rel_elemNodes[this-&gt;<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#aa5b51847bf2f760e188e953d00d250e9">meshSpecs</a>[0]-&gt;ctd.side[j].node[k]].entity();
<a name="l00219"></a>00219           <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;declare_relation(side, node, k);
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221         edgeMap.erase(it);
<a name="l00222"></a>00222       }
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224   }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;modification_end();
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <span class="preprocessor">#ifdef ALBANY_ZOLTAN</span>
<a name="l00229"></a>00229 <span class="preprocessor"></span>
<a name="l00230"></a>00230   <span class="comment">// Refine the mesh before starting the simulation if indicated</span>
<a name="l00231"></a>00231   <span class="comment">//  uniformRefineMesh(comm);</span>
<a name="l00232"></a>00232 
<a name="l00233"></a>00233   <span class="comment">// Rebalance the mesh before starting the simulation if indicated</span>
<a name="l00234"></a>00234   <span class="comment">//   rebalanceInitialMesh(comm);</span>
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 <span class="preprocessor">#endif</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span>
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 
<a name="l00240"></a><a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a28e1ed9a57c357604c70b9c905ae101c">00240</a> Teuchos::RCP&lt;const Teuchos::ParameterList&gt; <a class="code" href="classAlbany_1_1AsciiSTKMesh2D.html#a28e1ed9a57c357604c70b9c905ae101c">Albany::AsciiSTKMesh2D::getValidDiscretizationParameters</a>()<span class="keyword"> const </span>{
<a name="l00241"></a>00241   Teuchos::RCP&lt;Teuchos::ParameterList&gt; validPL =
<a name="l00242"></a>00242       this-&gt;<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a81cdcb00e08a795989c5ea1b859da13d">getValidGenericSTKParameters</a>(<span class="stringliteral">&quot;Valid ASCII_DiscParams&quot;</span>);
<a name="l00243"></a>00243   validPL-&gt;set&lt;std::string&gt;(<span class="stringliteral">&quot;Ascii Input Mesh File Name&quot;</span>, <span class="stringliteral">&quot;greenland.msh&quot;</span>,
<a name="l00244"></a>00244       <span class="stringliteral">&quot;Name of the file containing the 2D mesh, with list of coordinates, elements&#39; connectivity and boundary edges&#39; connectivity&quot;</span>);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <span class="keywordflow">return</span> validPL;
<a name="l00247"></a>00247 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Mar 26 2014 18:36:36 for Albany: a Trilinos-based PDE code by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
