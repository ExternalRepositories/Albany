<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Albany: a Trilinos-based PDE code: AAdapt_ThyraAdaptiveModelEvaluator.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>AAdapt_ThyraAdaptiveModelEvaluator.cpp</h1>  </div>
</div>
<div class="contents">
<a href="AAdapt__ThyraAdaptiveModelEvaluator_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//*****************************************************************//</span>
<a name="l00002"></a>00002 <span class="comment">//    Albany 2.0:  Copyright 2012 Sandia Corporation               //</span>
<a name="l00003"></a>00003 <span class="comment">//    This Software is released under the BSD license detailed     //</span>
<a name="l00004"></a>00004 <span class="comment">//    in the file &quot;license.txt&quot; in the top-level Albany directory  //</span>
<a name="l00005"></a>00005 <span class="comment">//*****************************************************************//</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="AAdapt__ThyraAdaptiveModelEvaluator_8hpp.html">AAdapt_ThyraAdaptiveModelEvaluator.hpp</a>&quot;</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;Thyra_EpetraModelEvaluator.hpp&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;Thyra_LinearOpWithSolveFactoryHelpers.hpp&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;Thyra_EpetraThyraWrappers.hpp&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;Thyra_EpetraLinearOp.hpp&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;Thyra_DetachedMultiVectorView.hpp&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;Thyra_ModelEvaluatorDelegatorBase.hpp&quot;</span> <span class="comment">// Gives verbose macros!</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;EpetraExt_ModelEvaluatorScalingTools.h&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;Epetra_RowMatrix.h&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;Teuchos_Time.hpp&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;Teuchos_implicit_cast.hpp&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;Teuchos_Assert.hpp&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;Teuchos_StandardParameterEntryValidators.hpp&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;Teuchos_VerboseObjectParameterListHelpers.hpp&quot;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="keyword">namespace </span>{
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="keyword">const</span> std::string StateFunctionScaling_name = <span class="stringliteral">&quot;State Function Scaling&quot;</span>;
<a name="l00028"></a>00028 Teuchos::RCP&lt;
<a name="l00029"></a>00029   Teuchos::StringToIntegralParameterEntryValidator&lt;
<a name="l00030"></a>00030     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aa68f4a350638e1332e7ee9137a1cfc05">AAdapt::ThyraAdaptiveModelEvaluator::EStateFunctionScaling</a>
<a name="l00031"></a>00031     &gt;
<a name="l00032"></a>00032   &gt;
<a name="l00033"></a>00033 stateFunctionScalingValidator;
<a name="l00034"></a>00034 <span class="keyword">const</span> std::string StateFunctionScaling_default = <span class="stringliteral">&quot;None&quot;</span>;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">// Extract out the Epetra_RowMatrix from the set W in an Epetra OutArgs object</span>
<a name="l00038"></a>00038 Teuchos::RCP&lt;Epetra_RowMatrix&gt;
<a name="l00039"></a>00039 get_Epetra_RowMatrix(
<a name="l00040"></a>00040   <span class="keyword">const</span> EpetraExt::ModelEvaluator::OutArgs &amp;epetraOutArgs
<a name="l00041"></a>00041   )
<a name="l00042"></a>00042 {
<a name="l00043"></a>00043   <span class="keyword">using</span> Teuchos::RCP;
<a name="l00044"></a>00044   <span class="keyword">const</span> RCP&lt;Epetra_Operator&gt;
<a name="l00045"></a>00045     eW = epetraOutArgs.get_W();
<a name="l00046"></a>00046   <span class="keyword">const</span> RCP&lt;Epetra_RowMatrix&gt;
<a name="l00047"></a>00047     ermW = Teuchos::rcp_dynamic_cast&lt;Epetra_RowMatrix&gt;(eW,<span class="keyword">false</span>);
<a name="l00048"></a>00048   TEUCHOS_TEST_FOR_EXCEPTION(
<a name="l00049"></a>00049     is_null(ermW), std::logic_error,
<a name="l00050"></a>00050     <span class="stringliteral">&quot;AAdapt::ThyraAdaptiveModelEvaluator::evalModel(...): Error, if\n&quot;</span>
<a name="l00051"></a>00051     <span class="stringliteral">&quot;scaling is turned on, the underlying Epetra_Operator created\n&quot;</span>
<a name="l00052"></a>00052     <span class="stringliteral">&quot;an initialized by the underlying epetra model evaluator\n&quot;</span>
<a name="l00053"></a>00053     <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; epetraOutArgs.modelEvalDescription() &lt;&lt; <span class="stringliteral">&quot;\&quot;\n&quot;</span>
<a name="l00054"></a>00054     <span class="stringliteral">&quot;must support the Epetra_RowMatrix interface through a dynamic cast.\n&quot;</span>
<a name="l00055"></a>00055     <span class="stringliteral">&quot;The concrete type &quot;</span> &lt;&lt; Teuchos::typeName(*eW) &lt;&lt; <span class="stringliteral">&quot; does not support\n&quot;</span>
<a name="l00056"></a>00056     <span class="stringliteral">&quot;Epetra_RowMatrix!&quot;</span>
<a name="l00057"></a>00057     );
<a name="l00058"></a>00058   <span class="keywordflow">return</span> ermW;
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 Teuchos::RCP&lt;Epetra_Operator&gt;
<a name="l00063"></a>00063 create_and_assert_W( 
<a name="l00064"></a>00064   <span class="keyword">const</span> EpetraExt::ModelEvaluator &amp;epetraModel
<a name="l00065"></a>00065   )
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067   <span class="keyword">using</span> Teuchos::RCP;
<a name="l00068"></a>00068   RCP&lt;Epetra_Operator&gt;
<a name="l00069"></a>00069     eW = epetraModel.create_W();
<a name="l00070"></a>00070   TEUCHOS_TEST_FOR_EXCEPTION(
<a name="l00071"></a>00071     is_null(eW), std::logic_error,
<a name="l00072"></a>00072     <span class="stringliteral">&quot;Error, the call to create_W() returned null on the &quot;</span>
<a name="l00073"></a>00073     <span class="stringliteral">&quot;EpetraExt::ModelEvaluator object &quot;</span>
<a name="l00074"></a>00074     <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; epetraModel.description() &lt;&lt; <span class="stringliteral">&quot;\&quot;.  This may mean that &quot;</span>
<a name="l00075"></a>00075     <span class="stringliteral">&quot;the underlying model does not support more than one copy of &quot;</span>
<a name="l00076"></a>00076     <span class="stringliteral">&quot;W at one time!&quot;</span> );
<a name="l00077"></a>00077   <span class="keywordflow">return</span> eW;
<a name="l00078"></a>00078 }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 } <span class="comment">// namespace</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="keyword">namespace </span>AAdapt {
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="keyword">using</span> Teuchos::RCP;
<a name="l00087"></a>00087 <span class="keyword">using</span> Thyra::LinearOpWithSolveFactoryBase;
<a name="l00088"></a>00088 <span class="keyword">using</span> Thyra::LinearOpBase;
<a name="l00089"></a>00089 <span class="keyword">using</span> Thyra::create_VectorSpace;
<a name="l00090"></a>00090 <span class="keyword">using</span> Thyra::ModelEvaluatorBase;
<a name="l00091"></a>00091 <span class="keyword">using</span> Thyra::VectorSpaceBase;
<a name="l00092"></a>00092 <span class="keyword">using</span> Thyra::VectorBase;
<a name="l00093"></a>00093 <span class="keyword">using</span> Thyra::PreconditionerBase;
<a name="l00094"></a>00094 <span class="keyword">using</span> Thyra::EpetraLinearOp;
<a name="l00095"></a>00095 <span class="keyword">using</span> Thyra::get_Epetra_Vector;
<a name="l00096"></a>00096 <span class="keyword">using</span> Thyra::convert;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">// Constructors/initializers/accessors.</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a96ffbaf78c56b689e5be55cb613b665e">00101</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a96ffbaf78c56b689e5be55cb613b665e" title=".">ThyraAdaptiveModelEvaluator::ThyraAdaptiveModelEvaluator</a>()
<a name="l00102"></a>00102   :nominalValuesAndBoundsAreUpdated_(false), stateFunctionScaling_(STATE_FUNC_SCALING_NONE),
<a name="l00103"></a>00103    currentInArgsOutArgs_(false), finalPointWasSolved_(false)
<a name="l00104"></a>00104 {}
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a96ffbaf78c56b689e5be55cb613b665e" title=".">ThyraAdaptiveModelEvaluator::ThyraAdaptiveModelEvaluator</a>(
<a name="l00108"></a>00108   <span class="keyword">const</span> RCP&lt;const EpetraExt::ModelEvaluator&gt; &amp;epetraModel,
<a name="l00109"></a>00109   <span class="keyword">const</span> RCP&lt;LinearOpWithSolveFactoryBase&lt;double&gt; &gt; &amp;W_factory
<a name="l00110"></a>00110   )
<a name="l00111"></a>00111   :nominalValuesAndBoundsAreUpdated_(false), stateFunctionScaling_(STATE_FUNC_SCALING_NONE),
<a name="l00112"></a>00112    currentInArgsOutArgs_(false), finalPointWasSolved_(false)
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a5fef5dcd703ef1a92d43d3299cdea7eb" title=".">initialize</a>(epetraModel,W_factory);
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a5fef5dcd703ef1a92d43d3299cdea7eb" title=".">ThyraAdaptiveModelEvaluator::initialize</a>(
<a name="l00119"></a>00119   <span class="keyword">const</span> RCP&lt;const EpetraExt::ModelEvaluator&gt; &amp;epetraModel,
<a name="l00120"></a>00120   <span class="keyword">const</span> RCP&lt;LinearOpWithSolveFactoryBase&lt;double&gt; &gt; &amp;W_factory
<a name="l00121"></a>00121   )
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123   <span class="keyword">using</span> Teuchos::implicit_cast;
<a name="l00124"></a>00124   <span class="keyword">typedef</span> ModelEvaluatorBase MEB;
<a name="l00125"></a>00125   <span class="comment">//</span>
<a name="l00126"></a>00126   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a> = epetraModel;
<a name="l00127"></a>00127   <span class="comment">//</span>
<a name="l00128"></a>00128   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a52a101deff76bb090b062f760eeecc18">W_factory_</a> = W_factory;
<a name="l00129"></a>00129   <span class="comment">//</span>
<a name="l00130"></a>00130   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a1091e6560c3206681a1295988c5c9738">x_map_</a> = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;get_x_map();
<a name="l00131"></a>00131   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aea77c1812ea611749c9e7e1a0a5599ac">f_map_</a> = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;get_f_map();
<a name="l00132"></a>00132   <span class="keywordflow">if</span> (!is_null(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a1091e6560c3206681a1295988c5c9738">x_map_</a>)) {
<a name="l00133"></a>00133     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7277bb4571cfa23d8b71749663d741d3">x_space_</a> = create_VectorSpace(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a1091e6560c3206681a1295988c5c9738">x_map_</a>);
<a name="l00134"></a>00134     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4dcb9b2c9305e3db8903d8e6056c057b">f_space_</a> = create_VectorSpace(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aea77c1812ea611749c9e7e1a0a5599ac">f_map_</a>);
<a name="l00135"></a>00135   }
<a name="l00136"></a>00136   <span class="comment">//</span>
<a name="l00137"></a>00137   EpetraExt::ModelEvaluator::InArgs inArgs = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createInArgs();
<a name="l00138"></a>00138   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ac400a29fa880daf0a3251fdc1430c24c">p_map_</a>.resize(inArgs.Np()); <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7817b38743673e1a6e621ee064a468df">p_space_</a>.resize(inArgs.Np());
<a name="l00139"></a>00139   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a0948d3ca4037f990f672cd07fd1338a3">p_map_is_local_</a>.resize(inArgs.Np(),<span class="keyword">false</span>);
<a name="l00140"></a>00140   <span class="keywordflow">for</span>( <span class="keywordtype">int</span> l = 0; l &lt; implicit_cast&lt;int&gt;(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7817b38743673e1a6e621ee064a468df">p_space_</a>.size()); ++l ) {
<a name="l00141"></a>00141     RCP&lt;const Epetra_Map&gt;
<a name="l00142"></a>00142       p_map_l = ( <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ac400a29fa880daf0a3251fdc1430c24c">p_map_</a>[l] = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;get_p_map(l) );
<a name="l00143"></a>00143 <span class="preprocessor">#ifdef TEUCHOS_DEBUG</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>    TEUCHOS_TEST_FOR_EXCEPTION(
<a name="l00145"></a>00145       is_null(p_map_l), std::logic_error,
<a name="l00146"></a>00146       <span class="stringliteral">&quot;Error, the the map p[&quot;</span>&lt;&lt;l&lt;&lt;<span class="stringliteral">&quot;] for the model \&quot;&quot;</span>
<a name="l00147"></a>00147       &lt;&lt;epetraModel-&gt;description()&lt;&lt;<span class="stringliteral">&quot;\&quot; can not be null!&quot;</span>);
<a name="l00148"></a>00148 <span class="preprocessor">#endif</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>
<a name="l00150"></a>00150     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a0948d3ca4037f990f672cd07fd1338a3">p_map_is_local_</a>[l] = !p_map_l-&gt;DistributedGlobal();
<a name="l00151"></a>00151     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7817b38743673e1a6e621ee064a468df">p_space_</a>[l] = create_VectorSpace(p_map_l);
<a name="l00152"></a>00152   }
<a name="l00153"></a>00153   <span class="comment">//</span>
<a name="l00154"></a>00154   EpetraExt::ModelEvaluator::OutArgs outArgs = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createOutArgs();
<a name="l00155"></a>00155   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a2cc4a6ddc8ad20174d90364e544a9f9d">g_map_</a>.resize(outArgs.Ng()); <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a08f74298d8435cbd8c6716b7073f0429">g_space_</a>.resize(outArgs.Ng());
<a name="l00156"></a>00156   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a08a28555e1a98c72330e36587ff7178a">g_map_is_local_</a>.resize(outArgs.Ng(),<span class="keyword">false</span>);
<a name="l00157"></a>00157   <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j = 0; j &lt; implicit_cast&lt;int&gt;(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a08f74298d8435cbd8c6716b7073f0429">g_space_</a>.size()); ++j ) {
<a name="l00158"></a>00158     RCP&lt;const Epetra_Map&gt;
<a name="l00159"></a>00159       g_map_j = ( <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a2cc4a6ddc8ad20174d90364e544a9f9d">g_map_</a>[j] = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;get_g_map(j) );
<a name="l00160"></a>00160     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a08a28555e1a98c72330e36587ff7178a">g_map_is_local_</a>[j] = !g_map_j-&gt;DistributedGlobal();
<a name="l00161"></a>00161     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a08f74298d8435cbd8c6716b7073f0429">g_space_</a>[j] = create_VectorSpace( g_map_j );
<a name="l00162"></a>00162   }
<a name="l00163"></a>00163   <span class="comment">//</span>
<a name="l00164"></a>00164   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a080091e2ec065680ccb17fc9f43ff49f">epetraInArgsScaling_</a> = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createInArgs();
<a name="l00165"></a>00165   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a606845977a120c02163efe367fefa7e4">epetraOutArgsScaling_</a> = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createOutArgs();
<a name="l00166"></a>00166   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a92ca4d2be3d32458f95294e589b3099d">nominalValuesAndBoundsAreUpdated_</a> = <span class="keyword">false</span>;
<a name="l00167"></a>00167   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a91386b16ef77be7fc9b67ae14a027abd">finalPointWasSolved_</a> = <span class="keyword">false</span>;
<a name="l00168"></a>00168   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8d0dd28b26631ea23e94f81395c3d1ea">stateFunctionScalingVec_</a> = Teuchos::null; <span class="comment">// Must set new scaling!</span>
<a name="l00169"></a>00169   <span class="comment">//</span>
<a name="l00170"></a>00170   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a62ce7144f04d83758930bfc1455e8904">currentInArgsOutArgs_</a> = <span class="keyword">false</span>;
<a name="l00171"></a>00171 }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 RCP&lt;const EpetraExt::ModelEvaluator&gt;
<a name="l00175"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7a8b93de949a72693d1ae1bc3a697c07">00175</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7a8b93de949a72693d1ae1bc3a697c07" title=".">ThyraAdaptiveModelEvaluator::getEpetraModel</a>()<span class="keyword"> const</span>
<a name="l00176"></a>00176 <span class="keyword"></span>{
<a name="l00177"></a>00177   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>;
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a3e148c30387666688f92b0d9f15c8c78" title="Set the nominal values.">ThyraAdaptiveModelEvaluator::setNominalValues</a>(
<a name="l00182"></a>00182   <span class="keyword">const</span> ModelEvaluatorBase::InArgs&lt;double&gt;&amp; nominalValues
<a name="l00183"></a>00183  )
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aa84ba7b31d3dc627575b24b0a56363c8">nominalValues_</a>.setArgs(nominalValues);
<a name="l00186"></a>00186   <span class="comment">// Note: These must be the scaled values so we don&#39;t need to scale!</span>
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#acfd61222e6db6d9e0b94a9b9f820dcc3" title="Set the state variable scaling vector s_x (see above).">ThyraAdaptiveModelEvaluator::setStateVariableScalingVec</a>(
<a name="l00191"></a>00191   <span class="keyword">const</span> RCP&lt;const Epetra_Vector&gt; &amp;stateVariableScalingVec
<a name="l00192"></a>00192   )
<a name="l00193"></a>00193 {
<a name="l00194"></a>00194   <span class="keyword">typedef</span> ModelEvaluatorBase MEB;
<a name="l00195"></a>00195 <span class="preprocessor">#ifdef TEUCHOS_DEBUG</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span>  TEUCHOS_TEST_FOR_EXCEPT( !this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a00eea19814731baf3a2bb57146648a4f" title=".">createInArgs</a>().supports(MEB::IN_ARG_x) );
<a name="l00197"></a>00197 <span class="preprocessor">#endif  </span>
<a name="l00198"></a>00198 <span class="preprocessor"></span>  <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4e3ae6a1a4403f25f718af2eb0f9fb54">stateVariableScalingVec_</a> = stateVariableScalingVec.assert_not_null();
<a name="l00199"></a>00199   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a17d10e85775c84a66ed183b8c82e9e51">invStateVariableScalingVec_</a> = Teuchos::null;
<a name="l00200"></a>00200   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a92ca4d2be3d32458f95294e589b3099d">nominalValuesAndBoundsAreUpdated_</a> = <span class="keyword">false</span>;
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 RCP&lt;const Epetra_Vector&gt;
<a name="l00205"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a98f5c81c853026a7df948b0a2174e3df">00205</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a98f5c81c853026a7df948b0a2174e3df" title="Get the inverse state variable scaling vector inv_s_x (see above).">ThyraAdaptiveModelEvaluator::getStateVariableScalingVec</a>()<span class="keyword"> const</span>
<a name="l00206"></a>00206 <span class="keyword"></span>{
<a name="l00207"></a>00207   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4e3ae6a1a4403f25f718af2eb0f9fb54">stateVariableScalingVec_</a>;
<a name="l00208"></a>00208 }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 
<a name="l00211"></a>00211 RCP&lt;const Epetra_Vector&gt;
<a name="l00212"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#abc8b56d5ef3fa8d735b0ab22d2da5423">00212</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#abc8b56d5ef3fa8d735b0ab22d2da5423" title="Get the state variable scaling vector s_x (see above).">ThyraAdaptiveModelEvaluator::getStateVariableInvScalingVec</a>()<span class="keyword"> const</span>
<a name="l00213"></a>00213 <span class="keyword"></span>{
<a name="l00214"></a>00214   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a30a9c30e8b09768bcc924bcce01dcda4" title=".">updateNominalValuesAndBounds</a>();
<a name="l00215"></a>00215   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a17d10e85775c84a66ed183b8c82e9e51">invStateVariableScalingVec_</a>;
<a name="l00216"></a>00216 }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#acbc570b9b0eae962e7be55f496e4f27e" title="Set the state function scaling vector s_f (see above).">ThyraAdaptiveModelEvaluator::setStateFunctionScalingVec</a>(
<a name="l00220"></a>00220   <span class="keyword">const</span> RCP&lt;const Epetra_Vector&gt; &amp;stateFunctionScalingVec
<a name="l00221"></a>00221   )
<a name="l00222"></a>00222 {
<a name="l00223"></a>00223   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8d0dd28b26631ea23e94f81395c3d1ea">stateFunctionScalingVec_</a> = stateFunctionScalingVec;
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 RCP&lt;const Epetra_Vector&gt;
<a name="l00228"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a5246bcd6491b0dc549407cf2af2e5a76">00228</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a5246bcd6491b0dc549407cf2af2e5a76" title="Get the state function scaling vector s_f (see above).">ThyraAdaptiveModelEvaluator::getStateFunctionScalingVec</a>()<span class="keyword"> const</span>
<a name="l00229"></a>00229 <span class="keyword"></span>{
<a name="l00230"></a>00230   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8d0dd28b26631ea23e94f81395c3d1ea">stateFunctionScalingVec_</a>;
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 
<a name="l00234"></a>00234 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8a1e49433d3c0eac3bf9108e6697d4fb" title=".">ThyraAdaptiveModelEvaluator::uninitialize</a>(
<a name="l00235"></a>00235   RCP&lt;const EpetraExt::ModelEvaluator&gt; *epetraModel,
<a name="l00236"></a>00236   RCP&lt;LinearOpWithSolveFactoryBase&lt;double&gt; &gt; *W_factory
<a name="l00237"></a>00237   )
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239   <span class="keywordflow">if</span>(epetraModel) *epetraModel = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>;
<a name="l00240"></a>00240   <span class="keywordflow">if</span>(W_factory) *W_factory = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a52a101deff76bb090b062f760eeecc18">W_factory_</a>;
<a name="l00241"></a>00241   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a> = Teuchos::null;
<a name="l00242"></a>00242   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a52a101deff76bb090b062f760eeecc18">W_factory_</a> = Teuchos::null;
<a name="l00243"></a>00243   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8d0dd28b26631ea23e94f81395c3d1ea">stateFunctionScalingVec_</a> = Teuchos::null;
<a name="l00244"></a>00244   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4e3ae6a1a4403f25f718af2eb0f9fb54">stateVariableScalingVec_</a> = Teuchos::null;
<a name="l00245"></a>00245   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a17d10e85775c84a66ed183b8c82e9e51">invStateVariableScalingVec_</a> = Teuchos::null;
<a name="l00246"></a>00246   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a62ce7144f04d83758930bfc1455e8904">currentInArgsOutArgs_</a> = <span class="keyword">false</span>;
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 <span class="keyword">const</span> ModelEvaluatorBase::InArgs&lt;double&gt;&amp;
<a name="l00251"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ad29b0bcc87fd53edf6bb7f772cf399d7">00251</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ad29b0bcc87fd53edf6bb7f772cf399d7" title=".">ThyraAdaptiveModelEvaluator::getFinalPoint</a>()<span class="keyword"> const</span>
<a name="l00252"></a>00252 <span class="keyword"></span>{
<a name="l00253"></a>00253   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#abd3e9dad86426c0b5952bc9ea1f5f35c">finalPoint_</a>;
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 
<a name="l00257"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a0d55b70ab795f35b5ad5f1cfa4f8bf93">00257</a> <span class="keywordtype">bool</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a0d55b70ab795f35b5ad5f1cfa4f8bf93" title=".">ThyraAdaptiveModelEvaluator::finalPointWasSolved</a>()<span class="keyword"> const</span>
<a name="l00258"></a>00258 <span class="keyword"></span>{
<a name="l00259"></a>00259   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a91386b16ef77be7fc9b67ae14a027abd">finalPointWasSolved_</a>;
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 <span class="keyword">const</span> Teuchos::RCP&lt;Thyra::VectorBase&lt;double&gt; &gt;
<a name="l00263"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a986d87836106dcc932df8989ae49867e">00263</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a986d87836106dcc932df8989ae49867e" title=".">ThyraAdaptiveModelEvaluator::resize_g_space</a>(<span class="keywordtype">int</span> index, Teuchos::RCP&lt;const Epetra_Map&gt; map){
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     RCP&lt;const Epetra_Map&gt;
<a name="l00266"></a>00266       g_map_j = ( <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a2cc4a6ddc8ad20174d90364e544a9f9d">g_map_</a>[index] = map );
<a name="l00267"></a>00267     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a08a28555e1a98c72330e36587ff7178a">g_map_is_local_</a>[index] = !g_map_j-&gt;DistributedGlobal();
<a name="l00268"></a>00268     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a08f74298d8435cbd8c6716b7073f0429">g_space_</a>[index] = create_VectorSpace( g_map_j );
<a name="l00269"></a>00269     <span class="keyword">const</span> Teuchos::RCP&lt;Thyra::VectorBase&lt;double&gt; &gt; g_j = Thyra::createMember(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a08f74298d8435cbd8c6716b7073f0429">g_space_</a>[index]);
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     RCP&lt;Epetra_Vector&gt; davector = get_Epetra_Vector(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a2cc4a6ddc8ad20174d90364e544a9f9d">g_map_</a>[index], g_j);
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     <span class="comment">// replace the vector in the outArgs being used in epetraModel-&gt;evalModel</span>
<a name="l00274"></a>00274     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4c7607a866a7d9ece76cdb7abb18ca49">evaluated_epetraUnscaledOutArgs</a>.set_g(index, davector);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     <span class="keywordflow">return</span> g_j;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="comment">/* Ordinarily, we would update the maps, but Piro_Epetra_ME returns NULL maps.</span>
<a name="l00279"></a>00279 <span class="comment">    x_map_ = epetraModel_-&gt;get_x_map();</span>
<a name="l00280"></a>00280 <span class="comment">    f_map_ = epetraModel_-&gt;get_f_map();</span>
<a name="l00281"></a>00281 <span class="comment">    if (!is_null(x_map_)) {</span>
<a name="l00282"></a>00282 <span class="comment">      x_space_ = create_VectorSpace(x_map_);</span>
<a name="l00283"></a>00283 <span class="comment">      f_space_ = create_VectorSpace(f_map_);</span>
<a name="l00284"></a>00284 <span class="comment">    }</span>
<a name="l00285"></a>00285 <span class="comment">*/</span>
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 <span class="comment">// Public functions overridden from Teuchos::Describable</span>
<a name="l00291"></a>00291 
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a065bb5db0a4b6c55875adc90978707f2">00293</a> std::string <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a065bb5db0a4b6c55875adc90978707f2" title=".">ThyraAdaptiveModelEvaluator::description</a>()<span class="keyword"> const</span>
<a name="l00294"></a>00294 <span class="keyword"></span>{
<a name="l00295"></a>00295   std::ostringstream oss;
<a name="l00296"></a>00296   oss &lt;&lt; <span class="stringliteral">&quot;Thyra::ThyraAdaptiveModelEvaluator{&quot;</span>;
<a name="l00297"></a>00297   oss &lt;&lt; <span class="stringliteral">&quot;epetraModel=&quot;</span>;
<a name="l00298"></a>00298   <span class="keywordflow">if</span>(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>.get())
<a name="l00299"></a>00299     oss &lt;&lt; <span class="stringliteral">&quot;\&#39;&quot;</span>&lt;&lt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;description()&lt;&lt;<span class="stringliteral">&quot;\&#39;&quot;</span>;
<a name="l00300"></a>00300   <span class="keywordflow">else</span>
<a name="l00301"></a>00301     oss &lt;&lt; <span class="stringliteral">&quot;NULL&quot;</span>;
<a name="l00302"></a>00302   oss &lt;&lt; <span class="stringliteral">&quot;,W_factory=&quot;</span>;
<a name="l00303"></a>00303   <span class="keywordflow">if</span>(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a52a101deff76bb090b062f760eeecc18">W_factory_</a>.get())
<a name="l00304"></a>00304     oss &lt;&lt; <span class="stringliteral">&quot;\&#39;&quot;</span>&lt;&lt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a52a101deff76bb090b062f760eeecc18">W_factory_</a>-&gt;description()&lt;&lt;<span class="stringliteral">&quot;\&#39;&quot;</span>;
<a name="l00305"></a>00305   <span class="keywordflow">else</span>
<a name="l00306"></a>00306     oss &lt;&lt; <span class="stringliteral">&quot;NULL&quot;</span>;
<a name="l00307"></a>00307   oss &lt;&lt; <span class="stringliteral">&quot;}&quot;</span>;
<a name="l00308"></a>00308   <span class="keywordflow">return</span> oss.str();
<a name="l00309"></a>00309 }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 <span class="comment">// Overridden from Teuchos::ParameterListAcceptor</span>
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ace422d1c26ef2de9566d22850194e3d0" title=".">ThyraAdaptiveModelEvaluator::setParameterList</a>(
<a name="l00316"></a>00316   RCP&lt;Teuchos::ParameterList&gt; <span class="keyword">const</span>&amp; paramList
<a name="l00317"></a>00317   )
<a name="l00318"></a>00318 {
<a name="l00319"></a>00319   TEUCHOS_TEST_FOR_EXCEPT(is_null(paramList));
<a name="l00320"></a>00320   paramList-&gt;validateParameters(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a09215bff09efa32861459e17a84fecb8" title=".">getValidParameters</a>(),0); <span class="comment">// Just validate my params</span>
<a name="l00321"></a>00321   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a507d2fa5b602e9bcefaf4a1332a0bf16">paramList_</a> = paramList;
<a name="l00322"></a>00322   <span class="keyword">const</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aa68f4a350638e1332e7ee9137a1cfc05">EStateFunctionScaling</a> stateFunctionScaling_old = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a972ab0ad7440608f5d3deaeb0d5004d2">stateFunctionScaling_</a>; 
<a name="l00323"></a>00323   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a972ab0ad7440608f5d3deaeb0d5004d2">stateFunctionScaling_</a> = stateFunctionScalingValidator-&gt;getIntegralValue(
<a name="l00324"></a>00324     *<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a507d2fa5b602e9bcefaf4a1332a0bf16">paramList_</a>, StateFunctionScaling_name, StateFunctionScaling_default
<a name="l00325"></a>00325     );
<a name="l00326"></a>00326   <span class="keywordflow">if</span>( <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a972ab0ad7440608f5d3deaeb0d5004d2">stateFunctionScaling_</a> != stateFunctionScaling_old )
<a name="l00327"></a>00327     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8d0dd28b26631ea23e94f81395c3d1ea">stateFunctionScalingVec_</a> = Teuchos::null;
<a name="l00328"></a>00328   Teuchos::readVerboseObjectSublist(&amp;*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a507d2fa5b602e9bcefaf4a1332a0bf16">paramList_</a>,<span class="keyword">this</span>);
<a name="l00329"></a>00329 <span class="preprocessor">#ifdef TEUCHOS_DEBUG</span>
<a name="l00330"></a>00330 <span class="preprocessor"></span>  <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a507d2fa5b602e9bcefaf4a1332a0bf16">paramList_</a>-&gt;validateParameters(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a09215bff09efa32861459e17a84fecb8" title=".">getValidParameters</a>(),0);
<a name="l00331"></a>00331 <span class="preprocessor">#endif // TEUCHOS_DEBUG</span>
<a name="l00332"></a>00332 <span class="preprocessor"></span>}
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 RCP&lt;Teuchos::ParameterList&gt;
<a name="l00336"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab194dc66c8a34a5bdc663e91eeffc29b">00336</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab194dc66c8a34a5bdc663e91eeffc29b" title=".">ThyraAdaptiveModelEvaluator::getNonconstParameterList</a>()
<a name="l00337"></a>00337 {
<a name="l00338"></a>00338   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a507d2fa5b602e9bcefaf4a1332a0bf16">paramList_</a>;
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 RCP&lt;Teuchos::ParameterList&gt;
<a name="l00343"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a6aa6bada0dded5ce59304654048058fb">00343</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a6aa6bada0dded5ce59304654048058fb" title=".">ThyraAdaptiveModelEvaluator::unsetParameterList</a>()
<a name="l00344"></a>00344 {
<a name="l00345"></a>00345   RCP&lt;Teuchos::ParameterList&gt; _paramList = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a507d2fa5b602e9bcefaf4a1332a0bf16">paramList_</a>;
<a name="l00346"></a>00346   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a507d2fa5b602e9bcefaf4a1332a0bf16">paramList_</a> = Teuchos::null;
<a name="l00347"></a>00347   <span class="keywordflow">return</span> _paramList;
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 RCP&lt;const Teuchos::ParameterList&gt;
<a name="l00352"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ad98becb9ed4385789b3288213592286b">00352</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ad98becb9ed4385789b3288213592286b" title=".">ThyraAdaptiveModelEvaluator::getParameterList</a>()<span class="keyword"> const</span>
<a name="l00353"></a>00353 <span class="keyword"></span>{
<a name="l00354"></a>00354   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a507d2fa5b602e9bcefaf4a1332a0bf16">paramList_</a>;
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 RCP&lt;const Teuchos::ParameterList&gt;
<a name="l00359"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a09215bff09efa32861459e17a84fecb8">00359</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a09215bff09efa32861459e17a84fecb8" title=".">ThyraAdaptiveModelEvaluator::getValidParameters</a>()<span class="keyword"> const</span>
<a name="l00360"></a>00360 <span class="keyword"></span>{
<a name="l00361"></a>00361   <span class="keyword">using</span> Teuchos::rcp;
<a name="l00362"></a>00362   <span class="keyword">using</span> Teuchos::StringToIntegralParameterEntryValidator;
<a name="l00363"></a>00363   <span class="keyword">using</span> Teuchos::tuple;
<a name="l00364"></a>00364   <span class="keyword">using</span> Teuchos::rcp_implicit_cast;
<a name="l00365"></a>00365   <span class="keyword">typedef</span> Teuchos::ParameterEntryValidator PEV;
<a name="l00366"></a>00366   <span class="keyword">static</span> RCP&lt;const Teuchos::ParameterList&gt; validPL;
<a name="l00367"></a>00367   <span class="keywordflow">if</span>(is_null(validPL)) {
<a name="l00368"></a>00368     RCP&lt;Teuchos::ParameterList&gt;
<a name="l00369"></a>00369       pl = Teuchos::rcp(<span class="keyword">new</span> Teuchos::ParameterList());
<a name="l00370"></a>00370     stateFunctionScalingValidator = rcp(
<a name="l00371"></a>00371       <span class="keyword">new</span> StringToIntegralParameterEntryValidator&lt;EStateFunctionScaling&gt;(
<a name="l00372"></a>00372         tuple&lt;std::string&gt;(
<a name="l00373"></a>00373           <span class="stringliteral">&quot;None&quot;</span>,
<a name="l00374"></a>00374           <span class="stringliteral">&quot;Row Sum&quot;</span>
<a name="l00375"></a>00375           ),
<a name="l00376"></a>00376         tuple&lt;std::string&gt;(
<a name="l00377"></a>00377           <span class="stringliteral">&quot;Do not scale the state function f(...) in this class.&quot;</span>,
<a name="l00378"></a>00378 
<a name="l00379"></a>00379           <span class="stringliteral">&quot;Scale the state function f(...) and all its derivatives\n&quot;</span>
<a name="l00380"></a>00380           <span class="stringliteral">&quot;using the row sum scaling from the initial Jacobian\n&quot;</span>
<a name="l00381"></a>00381           <span class="stringliteral">&quot;W=d(f)/d(x).  Note, this only works with Epetra_CrsMatrix\n&quot;</span>
<a name="l00382"></a>00382           <span class="stringliteral">&quot;currently.&quot;</span>
<a name="l00383"></a>00383           ),
<a name="l00384"></a>00384         tuple&lt;EStateFunctionScaling&gt;(
<a name="l00385"></a>00385           <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aa68f4a350638e1332e7ee9137a1cfc05ab05cd87179c053d8a43a93d5b296b2cc">STATE_FUNC_SCALING_NONE</a>,
<a name="l00386"></a>00386           <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aa68f4a350638e1332e7ee9137a1cfc05a9addc0753608275ed246238e0e9d8b7a">STATE_FUNC_SCALING_ROW_SUM</a>
<a name="l00387"></a>00387           ),
<a name="l00388"></a>00388         StateFunctionScaling_name
<a name="l00389"></a>00389         )
<a name="l00390"></a>00390       );
<a name="l00391"></a>00391     pl-&gt;set(StateFunctionScaling_name,StateFunctionScaling_default,
<a name="l00392"></a>00392       <span class="stringliteral">&quot;Determines if and how the state function f(...) and all of its\n&quot;</span>
<a name="l00393"></a>00393       <span class="stringliteral">&quot;derivatives are scaled.  The scaling is done explicitly so there should\n&quot;</span>
<a name="l00394"></a>00394       <span class="stringliteral">&quot;be no impact on the meaning of inner products or tolerances for\n&quot;</span>
<a name="l00395"></a>00395       <span class="stringliteral">&quot;linear solves.&quot;</span>,
<a name="l00396"></a>00396       rcp_implicit_cast&lt;const PEV&gt;(stateFunctionScalingValidator)
<a name="l00397"></a>00397       );
<a name="l00398"></a>00398     Teuchos::setupVerboseObjectSublist(&amp;*pl);
<a name="l00399"></a>00399     validPL = pl;
<a name="l00400"></a>00400   }
<a name="l00401"></a>00401   <span class="keywordflow">return</span> validPL;
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 <span class="comment">// Overridden from ModelEvaulator.</span>
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 
<a name="l00408"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8099e8e1084ba1b513a35d3129046550">00408</a> <span class="keywordtype">int</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8099e8e1084ba1b513a35d3129046550" title=".">ThyraAdaptiveModelEvaluator::Np</a>()<span class="keyword"> const</span>
<a name="l00409"></a>00409 <span class="keyword"></span>{
<a name="l00410"></a>00410   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7817b38743673e1a6e621ee064a468df">p_space_</a>.size();
<a name="l00411"></a>00411 }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 
<a name="l00414"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aeb979b166a07585ce03131da39f85108">00414</a> <span class="keywordtype">int</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aeb979b166a07585ce03131da39f85108" title=".">ThyraAdaptiveModelEvaluator::Ng</a>()<span class="keyword"> const</span>
<a name="l00415"></a>00415 <span class="keyword"></span>{
<a name="l00416"></a>00416   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a08f74298d8435cbd8c6716b7073f0429">g_space_</a>.size();
<a name="l00417"></a>00417 }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 
<a name="l00420"></a>00420 RCP&lt;const VectorSpaceBase&lt;double&gt; &gt;
<a name="l00421"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a0792123894ab0e35f07da80cf56c65c2">00421</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a0792123894ab0e35f07da80cf56c65c2" title=".">ThyraAdaptiveModelEvaluator::get_x_space</a>()<span class="keyword"> const</span>
<a name="l00422"></a>00422 <span class="keyword"></span>{
<a name="l00423"></a>00423   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7277bb4571cfa23d8b71749663d741d3">x_space_</a>;
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 
<a name="l00427"></a>00427 RCP&lt;const VectorSpaceBase&lt;double&gt; &gt;
<a name="l00428"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae6cdbfb2def570563b2a21922a77431a">00428</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae6cdbfb2def570563b2a21922a77431a" title=".">ThyraAdaptiveModelEvaluator::get_f_space</a>()<span class="keyword"> const</span>
<a name="l00429"></a>00429 <span class="keyword"></span>{
<a name="l00430"></a>00430   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4dcb9b2c9305e3db8903d8e6056c057b">f_space_</a>;
<a name="l00431"></a>00431 }
<a name="l00432"></a>00432 
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 RCP&lt;const VectorSpaceBase&lt;double&gt; &gt;
<a name="l00435"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a63a3a3141705a8903423cc2daea3068a">00435</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a63a3a3141705a8903423cc2daea3068a" title=".">ThyraAdaptiveModelEvaluator::get_p_space</a>(<span class="keywordtype">int</span> l)<span class="keyword"> const</span>
<a name="l00436"></a>00436 <span class="keyword"></span>{
<a name="l00437"></a>00437 <span class="preprocessor">#ifdef TEUCHOS_DEBUG</span>
<a name="l00438"></a>00438 <span class="preprocessor"></span>  TEUCHOS_ASSERT_IN_RANGE_UPPER_EXCLUSIVE( l, 0, this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8099e8e1084ba1b513a35d3129046550" title=".">Np</a>() );
<a name="l00439"></a>00439 <span class="preprocessor">#endif</span>
<a name="l00440"></a>00440 <span class="preprocessor"></span>  <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7817b38743673e1a6e621ee064a468df">p_space_</a>[l];
<a name="l00441"></a>00441 }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 RCP&lt;const Teuchos::Array&lt;std::string&gt; &gt;
<a name="l00445"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a0a6fd3db935f93cb44971af93c7a79c4">00445</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a0a6fd3db935f93cb44971af93c7a79c4" title=".">ThyraAdaptiveModelEvaluator::get_p_names</a>(<span class="keywordtype">int</span> l)<span class="keyword"> const</span>
<a name="l00446"></a>00446 <span class="keyword"></span>{
<a name="l00447"></a>00447 <span class="preprocessor">#ifdef TEUCHOS_DEBUG</span>
<a name="l00448"></a>00448 <span class="preprocessor"></span>  TEUCHOS_ASSERT_IN_RANGE_UPPER_EXCLUSIVE( l, 0, this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8099e8e1084ba1b513a35d3129046550" title=".">Np</a>() );
<a name="l00449"></a>00449 <span class="preprocessor">#endif</span>
<a name="l00450"></a>00450 <span class="preprocessor"></span>  <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;get_p_names(l);
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 RCP&lt;const VectorSpaceBase&lt;double&gt; &gt;
<a name="l00455"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a48deae321a0518817035bf3ea9d52a27">00455</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a48deae321a0518817035bf3ea9d52a27" title=".">ThyraAdaptiveModelEvaluator::get_g_space</a>(<span class="keywordtype">int</span> j)<span class="keyword"> const</span>
<a name="l00456"></a>00456 <span class="keyword"></span>{
<a name="l00457"></a>00457   TEUCHOS_TEST_FOR_EXCEPT( ! ( 0 &lt;= j &amp;&amp; j &lt; this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aeb979b166a07585ce03131da39f85108" title=".">Ng</a>() ) );
<a name="l00458"></a>00458   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a08f74298d8435cbd8c6716b7073f0429">g_space_</a>[j];
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 ModelEvaluatorBase::InArgs&lt;double&gt;
<a name="l00463"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a6128f6ec5c4e2b8a4aeed04c696dd4ee">00463</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a6128f6ec5c4e2b8a4aeed04c696dd4ee" title=".">ThyraAdaptiveModelEvaluator::getNominalValues</a>()<span class="keyword"> const</span>
<a name="l00464"></a>00464 <span class="keyword"></span>{
<a name="l00465"></a>00465   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a30a9c30e8b09768bcc924bcce01dcda4" title=".">updateNominalValuesAndBounds</a>();
<a name="l00466"></a>00466   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aa84ba7b31d3dc627575b24b0a56363c8">nominalValues_</a>;
<a name="l00467"></a>00467 }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469 
<a name="l00470"></a>00470 ModelEvaluatorBase::InArgs&lt;double&gt;
<a name="l00471"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a91c2f100fe55cd042b7c8beb8447bb67">00471</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a91c2f100fe55cd042b7c8beb8447bb67" title=".">ThyraAdaptiveModelEvaluator::getLowerBounds</a>()<span class="keyword"> const</span>
<a name="l00472"></a>00472 <span class="keyword"></span>{
<a name="l00473"></a>00473   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a30a9c30e8b09768bcc924bcce01dcda4" title=".">updateNominalValuesAndBounds</a>();
<a name="l00474"></a>00474   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a84c801426edd49ef03def88ab22e7e27">lowerBounds_</a>;
<a name="l00475"></a>00475 }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477 
<a name="l00478"></a>00478 ModelEvaluatorBase::InArgs&lt;double&gt;
<a name="l00479"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae95a88137fa4840751da83d07b34d878">00479</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae95a88137fa4840751da83d07b34d878" title=".">ThyraAdaptiveModelEvaluator::getUpperBounds</a>()<span class="keyword"> const</span>
<a name="l00480"></a>00480 <span class="keyword"></span>{
<a name="l00481"></a>00481   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a30a9c30e8b09768bcc924bcce01dcda4" title=".">updateNominalValuesAndBounds</a>();
<a name="l00482"></a>00482   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a0b253569b86d01a2577eb3a86bc63243">upperBounds_</a>;
<a name="l00483"></a>00483 }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 RCP&lt;LinearOpBase&lt;double&gt; &gt;
<a name="l00487"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a12e7aff1200e83a2a4f74a2db857befd">00487</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a12e7aff1200e83a2a4f74a2db857befd" title=".">ThyraAdaptiveModelEvaluator::create_W_op</a>()<span class="keyword"> const</span>
<a name="l00488"></a>00488 <span class="keyword"></span>{
<a name="l00489"></a>00489   <span class="keywordflow">return</span> this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ada910df3336884ea15fe24a578579f19" title=".">create_epetra_W_op</a>();
<a name="l00490"></a>00490 }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 
<a name="l00493"></a>00493 RCP&lt;PreconditionerBase&lt;double&gt; &gt;
<a name="l00494"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a57d2ab716891ddcd59bec39e6e02e8b9">00494</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a57d2ab716891ddcd59bec39e6e02e8b9" title="Returns null currently.">ThyraAdaptiveModelEvaluator::create_W_prec</a>()<span class="keyword"> const</span>
<a name="l00495"></a>00495 <span class="keyword"></span>{
<a name="l00496"></a>00496   <span class="keywordflow">return</span> Teuchos::null;
<a name="l00497"></a>00497 }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 
<a name="l00500"></a>00500 RCP&lt;const LinearOpWithSolveFactoryBase&lt;double&gt; &gt;
<a name="l00501"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7f91a7f8c78f743e05c9d7b2101e8a0a">00501</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7f91a7f8c78f743e05c9d7b2101e8a0a" title=".">ThyraAdaptiveModelEvaluator::get_W_factory</a>()<span class="keyword"> const</span>
<a name="l00502"></a>00502 <span class="keyword"></span>{
<a name="l00503"></a>00503   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a52a101deff76bb090b062f760eeecc18">W_factory_</a>;
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 
<a name="l00507"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a00eea19814731baf3a2bb57146648a4f">00507</a> ModelEvaluatorBase::InArgs&lt;double&gt; <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a00eea19814731baf3a2bb57146648a4f" title=".">ThyraAdaptiveModelEvaluator::createInArgs</a>()<span class="keyword"> const</span>
<a name="l00508"></a>00508 <span class="keyword"></span>{
<a name="l00509"></a>00509   <span class="keywordflow">if</span> (!<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a62ce7144f04d83758930bfc1455e8904">currentInArgsOutArgs_</a>)
<a name="l00510"></a>00510     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae2dea303b6d4bed722611fb8ecea429a" title=".">updateInArgsOutArgs</a>();
<a name="l00511"></a>00511   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aa529477680405fcc78073c917f06ab01">prototypeInArgs_</a>;
<a name="l00512"></a>00512 }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8e8be9e7f9ae84058736f293af3edbe9" title=".">ThyraAdaptiveModelEvaluator::reportFinalPoint</a>(
<a name="l00516"></a>00516   <span class="keyword">const</span> ModelEvaluatorBase::InArgs&lt;double&gt; &amp;finalPoint,
<a name="l00517"></a>00517   <span class="keyword">const</span> <span class="keywordtype">bool</span> wasSolved
<a name="l00518"></a>00518   )
<a name="l00519"></a>00519 {
<a name="l00520"></a>00520   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#abd3e9dad86426c0b5952bc9ea1f5f35c">finalPoint_</a> = this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a00eea19814731baf3a2bb57146648a4f" title=".">createInArgs</a>();
<a name="l00521"></a>00521   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#abd3e9dad86426c0b5952bc9ea1f5f35c">finalPoint_</a>.setArgs(finalPoint);
<a name="l00522"></a>00522   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a91386b16ef77be7fc9b67ae14a027abd">finalPointWasSolved_</a> = wasSolved;
<a name="l00523"></a>00523 }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 <span class="comment">// Private functions overridden from ModelEvaulatorDefaultBase</span>
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 RCP&lt;LinearOpBase&lt;double&gt; &gt;
<a name="l00530"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aac7d9a6995255a1554a821946211ace2">00530</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aac7d9a6995255a1554a821946211ace2" title=".">ThyraAdaptiveModelEvaluator::create_DfDp_op_impl</a>(<span class="keywordtype">int</span> l)<span class="keyword"> const</span>
<a name="l00531"></a>00531 <span class="keyword"></span>{
<a name="l00532"></a>00532   TEUCHOS_TEST_FOR_EXCEPT(<span class="keyword">true</span>);
<a name="l00533"></a>00533   <span class="keywordflow">return</span> Teuchos::null;
<a name="l00534"></a>00534 }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 RCP&lt;LinearOpBase&lt;double&gt; &gt;
<a name="l00538"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a222b84a4c24fa11c768054e7df110310">00538</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a222b84a4c24fa11c768054e7df110310" title=".">ThyraAdaptiveModelEvaluator::create_DgDx_dot_op_impl</a>(<span class="keywordtype">int</span> j)<span class="keyword"> const</span>
<a name="l00539"></a>00539 <span class="keyword"></span>{
<a name="l00540"></a>00540   TEUCHOS_TEST_FOR_EXCEPT(<span class="keyword">true</span>);
<a name="l00541"></a>00541   <span class="keywordflow">return</span> Teuchos::null;
<a name="l00542"></a>00542 }
<a name="l00543"></a>00543 
<a name="l00544"></a>00544 
<a name="l00545"></a>00545 RCP&lt;LinearOpBase&lt;double&gt; &gt;
<a name="l00546"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a079edbcd0d7dfe260e9b07b5beb61854">00546</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a079edbcd0d7dfe260e9b07b5beb61854" title=".">ThyraAdaptiveModelEvaluator::create_DgDx_op_impl</a>(<span class="keywordtype">int</span> j)<span class="keyword"> const</span>
<a name="l00547"></a>00547 <span class="keyword"></span>{
<a name="l00548"></a>00548   TEUCHOS_TEST_FOR_EXCEPT(<span class="keyword">true</span>);
<a name="l00549"></a>00549   <span class="keywordflow">return</span> Teuchos::null;
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 RCP&lt;LinearOpBase&lt;double&gt; &gt;
<a name="l00554"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#acddb7986157829cdf58801446ea23a3a">00554</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#acddb7986157829cdf58801446ea23a3a" title=".">ThyraAdaptiveModelEvaluator::create_DgDp_op_impl</a>( <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> l )<span class="keyword"> const</span>
<a name="l00555"></a>00555 <span class="keyword"></span>{
<a name="l00556"></a>00556   TEUCHOS_TEST_FOR_EXCEPT(<span class="keyword">true</span>);
<a name="l00557"></a>00557   <span class="keywordflow">return</span> Teuchos::null;
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 
<a name="l00561"></a>00561 ModelEvaluatorBase::OutArgs&lt;double&gt;
<a name="l00562"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a3fbf0af203fb328cb9c1bf9385cde142">00562</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a3fbf0af203fb328cb9c1bf9385cde142" title=".">ThyraAdaptiveModelEvaluator::createOutArgsImpl</a>()<span class="keyword"> const</span>
<a name="l00563"></a>00563 <span class="keyword"></span>{
<a name="l00564"></a>00564   <span class="keywordflow">if</span> (!<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a62ce7144f04d83758930bfc1455e8904">currentInArgsOutArgs_</a>)
<a name="l00565"></a>00565     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae2dea303b6d4bed722611fb8ecea429a" title=".">updateInArgsOutArgs</a>();
<a name="l00566"></a>00566   <span class="keywordflow">return</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a16fa52e85181e6d8bd3efea219386cc9">prototypeOutArgs_</a>;
<a name="l00567"></a>00567 }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569 
<a name="l00570"></a>00570 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aed9962df382475753990f90d762b46ae" title=".">ThyraAdaptiveModelEvaluator::evalModelImpl</a>(
<a name="l00571"></a>00571   <span class="keyword">const</span> ModelEvaluatorBase::InArgs&lt;double&gt;&amp; inArgs_in,
<a name="l00572"></a>00572   <span class="keyword">const</span> ModelEvaluatorBase::OutArgs&lt;double&gt;&amp; outArgs
<a name="l00573"></a>00573   )<span class="keyword"> const</span>
<a name="l00574"></a>00574 <span class="keyword"></span>{
<a name="l00575"></a>00575 
<a name="l00576"></a>00576   <span class="keyword">using</span> Teuchos::rcp;
<a name="l00577"></a>00577   <span class="keyword">using</span> Teuchos::rcp_const_cast;
<a name="l00578"></a>00578   <span class="keyword">using</span> Teuchos::rcp_dynamic_cast;
<a name="l00579"></a>00579   <span class="keyword">using</span> Teuchos::OSTab;
<a name="l00580"></a>00580   <span class="keyword">using</span> Teuchos::includesVerbLevel;
<a name="l00581"></a>00581   <span class="keyword">typedef</span> EpetraExt::ModelEvaluator EME;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583   <span class="comment">//</span>
<a name="l00584"></a>00584   <span class="comment">// A) Initial setup</span>
<a name="l00585"></a>00585   <span class="comment">//</span>
<a name="l00586"></a>00586 
<a name="l00587"></a>00587   <span class="comment">// Make sure that we are fully initialized!</span>
<a name="l00588"></a>00588   this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a30a9c30e8b09768bcc924bcce01dcda4" title=".">updateNominalValuesAndBounds</a>();
<a name="l00589"></a>00589 
<a name="l00590"></a>00590   <span class="comment">// Make sure we grab the initial guess first!</span>
<a name="l00591"></a>00591   InArgs&lt;double&gt; inArgs = this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a6128f6ec5c4e2b8a4aeed04c696dd4ee" title=".">getNominalValues</a>();
<a name="l00592"></a>00592   <span class="comment">// Now, copy the parameters from the input inArgs_in object to the inArgs</span>
<a name="l00593"></a>00593   <span class="comment">// object.  Any input objects that are set in inArgs_in will overwrite those</span>
<a name="l00594"></a>00594   <span class="comment">// in inArgs that will already contain the nominal values.  This will insure</span>
<a name="l00595"></a>00595   <span class="comment">// that all input parameters are set and those that are not set by the</span>
<a name="l00596"></a>00596   <span class="comment">// client will be at their nominal values (as defined by the underlying</span>
<a name="l00597"></a>00597   <span class="comment">// EpetraExt::ModelEvaluator object).  The full set of Thyra input arguments</span>
<a name="l00598"></a>00598   <span class="comment">// must be set before these can be translated into Epetra input arguments.</span>
<a name="l00599"></a>00599   inArgs.setArgs(inArgs_in);
<a name="l00600"></a>00600 
<a name="l00601"></a>00601   <span class="comment">// This is a special exception: see evalModel() in Thyra::ME</span>
<a name="l00602"></a>00602   <span class="comment">// documentation.  If inArgs() supports x_dot but the evaluate call</span>
<a name="l00603"></a>00603   <span class="comment">// passes in a null value, then we need to make sure the null value</span>
<a name="l00604"></a>00604   <span class="comment">// gets passed on instead of the nominal value.</span>
<a name="l00605"></a>00605   <span class="keywordflow">if</span> (inArgs.supports(Thyra::ModelEvaluatorBase::IN_ARG_x_dot)) {
<a name="l00606"></a>00606     <span class="keywordflow">if</span> (is_null(inArgs_in.get_x_dot()))
<a name="l00607"></a>00607       inArgs.set_x_dot(Teuchos::null);
<a name="l00608"></a>00608   }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610   <span class="comment">// Print the header and the values of the inArgs and outArgs objects!</span>
<a name="l00611"></a>00611   <span class="keyword">typedef</span> <span class="keywordtype">double</span> Scalar; <span class="comment">// Needed for below macro!</span>
<a name="l00612"></a>00612   THYRA_MODEL_EVALUATOR_DECORATOR_EVAL_MODEL_GEN_BEGIN(
<a name="l00613"></a>00613     <span class="stringliteral">&quot;Thyra::ThyraAdaptiveModelEvaluator&quot;</span>,inArgs,outArgs,Teuchos::null
<a name="l00614"></a>00614     );
<a name="l00615"></a>00615 
<a name="l00616"></a>00616   <span class="comment">// State function Scaling</span>
<a name="l00617"></a>00617   <span class="keyword">const</span> <span class="keywordtype">bool</span> firstTimeStateFuncScaling
<a name="l00618"></a>00618     = (
<a name="l00619"></a>00619       <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a972ab0ad7440608f5d3deaeb0d5004d2">stateFunctionScaling_</a> != <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aa68f4a350638e1332e7ee9137a1cfc05ab05cd87179c053d8a43a93d5b296b2cc">STATE_FUNC_SCALING_NONE</a>
<a name="l00620"></a>00620       &amp;&amp; is_null(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8d0dd28b26631ea23e94f81395c3d1ea">stateFunctionScalingVec_</a>)
<a name="l00621"></a>00621       );
<a name="l00622"></a>00622   
<a name="l00623"></a>00623   <span class="keyword">typedef</span> Teuchos::VerboseObjectTempState&lt;LinearOpWithSolveFactoryBase&lt;double&gt; &gt; VOTSLOWSF;
<a name="l00624"></a>00624   VOTSLOWSF W_factory_outputTempState(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a52a101deff76bb090b062f760eeecc18">W_factory_</a>,out,verbLevel);
<a name="l00625"></a>00625 
<a name="l00626"></a>00626   Teuchos::Time timer(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00627"></a>00627 
<a name="l00628"></a>00628   <span class="comment">//</span>
<a name="l00629"></a>00629   <span class="comment">// B) Prepressess the InArgs and OutArgs in preparation to call</span>
<a name="l00630"></a>00630   <span class="comment">// the underlying EpetraExt::ModelEvaluator</span>
<a name="l00631"></a>00631   <span class="comment">//</span>
<a name="l00632"></a>00632 
<a name="l00633"></a>00633   <span class="comment">//</span>
<a name="l00634"></a>00634   <span class="comment">// B.1) Translate InArgs from Thyra to Epetra objects</span>
<a name="l00635"></a>00635   <span class="comment">//</span>
<a name="l00636"></a>00636   
<a name="l00637"></a>00637   <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW))
<a name="l00638"></a>00638     *out &lt;&lt; <span class="stringliteral">&quot;\nSetting-up/creating input arguments ...\n&quot;</span>;
<a name="l00639"></a>00639   timer.start(<span class="keyword">true</span>);
<a name="l00640"></a>00640 
<a name="l00641"></a>00641   <span class="comment">// Unwrap input Thyra objects to get Epetra objects</span>
<a name="l00642"></a>00642   EME::InArgs epetraScaledInArgs = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createInArgs();
<a name="l00643"></a>00643   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ad31b141d4876d0e8b7cf32d97dcc585c" title=".">convertInArgsFromThyraToEpetra</a>( inArgs, &amp;epetraScaledInArgs );
<a name="l00644"></a>00644 
<a name="l00645"></a>00645   <span class="comment">// Unscale the input Epetra objects which will be passed to the underlying</span>
<a name="l00646"></a>00646   <span class="comment">// EpetraExt::ModelEvaluator object.</span>
<a name="l00647"></a>00647   EME::InArgs epetraInArgs = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createInArgs();
<a name="l00648"></a>00648   EpetraExt::unscaleModelVars(
<a name="l00649"></a>00649     epetraScaledInArgs, <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a080091e2ec065680ccb17fc9f43ff49f">epetraInArgsScaling_</a>, &amp;epetraInArgs,
<a name="l00650"></a>00650     out.get(), verbLevel
<a name="l00651"></a>00651     );
<a name="l00652"></a>00652 
<a name="l00653"></a>00653   timer.stop();
<a name="l00654"></a>00654   <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW))
<a name="l00655"></a>00655     OSTab(out).o() &lt;&lt; <span class="stringliteral">&quot;\nTime to setup InArgs = &quot;</span>&lt;&lt;timer.totalElapsedTime()&lt;&lt;<span class="stringliteral">&quot; sec\n&quot;</span>;
<a name="l00656"></a>00656 
<a name="l00657"></a>00657   <span class="comment">//</span>
<a name="l00658"></a>00658   <span class="comment">// B.2) Convert from Thyra to Epetra OutArgs</span>
<a name="l00659"></a>00659   <span class="comment">//</span>
<a name="l00660"></a>00660   
<a name="l00661"></a>00661   <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW))
<a name="l00662"></a>00662     *out &lt;&lt; <span class="stringliteral">&quot;\nSetting-up/creating output arguments ...\n&quot;</span>;
<a name="l00663"></a>00663   timer.start(<span class="keyword">true</span>);
<a name="l00664"></a>00664   
<a name="l00665"></a>00665   <span class="comment">// The unscaled Epetra OutArgs that will be passed to the</span>
<a name="l00666"></a>00666   <span class="comment">// underlying EpetraExt::ModelEvaluator object</span>
<a name="l00667"></a>00667   <span class="comment">// This is a private class member to allow resizing the solution data array</span>
<a name="l00668"></a>00668   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4c7607a866a7d9ece76cdb7abb18ca49">evaluated_epetraUnscaledOutArgs</a> = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createOutArgs();
<a name="l00669"></a>00669 
<a name="l00670"></a>00670   <span class="comment">// Various objects that are needed later (see documentation in</span>
<a name="l00671"></a>00671   <span class="comment">// the function convertOutArgsFromThyraToEpetra(...)</span>
<a name="l00672"></a>00672   RCP&lt;LinearOpBase&lt;double&gt; &gt; W_op;
<a name="l00673"></a>00673   RCP&lt;EpetraLinearOp&gt; efwdW;
<a name="l00674"></a>00674   RCP&lt;Epetra_Operator&gt; eW;
<a name="l00675"></a>00675   
<a name="l00676"></a>00676   <span class="comment">// Convert from Thyra to Epetra OutArgs and grap some of the intermediate</span>
<a name="l00677"></a>00677   <span class="comment">// objects accessed along the way that are needed later.</span>
<a name="l00678"></a>00678   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a637bd694e117f42e4771b2aacb1491b7" title=".">convertOutArgsFromThyraToEpetra</a>(
<a name="l00679"></a>00679     outArgs,
<a name="l00680"></a>00680     &amp;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4c7607a866a7d9ece76cdb7abb18ca49">evaluated_epetraUnscaledOutArgs</a>,
<a name="l00681"></a>00681     &amp;W_op, &amp;efwdW, &amp;eW
<a name="l00682"></a>00682     );
<a name="l00683"></a>00683 
<a name="l00684"></a>00684   <span class="comment">//</span>
<a name="l00685"></a>00685   <span class="comment">// B.3) Setup OutArgs to computing scaling if needed</span>
<a name="l00686"></a>00686   <span class="comment">//</span>
<a name="l00687"></a>00687 
<a name="l00688"></a>00688   <span class="keywordflow">if</span> (firstTimeStateFuncScaling) {
<a name="l00689"></a>00689     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a6feb806b4bd8762200b756d1f3697962" title=".">preEvalScalingSetup</a>(&amp;epetraInArgs,&amp;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4c7607a866a7d9ece76cdb7abb18ca49">evaluated_epetraUnscaledOutArgs</a>,out,verbLevel);
<a name="l00690"></a>00690   }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692   timer.stop();
<a name="l00693"></a>00693   <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW))
<a name="l00694"></a>00694     OSTab(out).o()
<a name="l00695"></a>00695       &lt;&lt; <span class="stringliteral">&quot;\nTime to setup OutArgs = &quot;</span>
<a name="l00696"></a>00696       &lt;&lt; timer.totalElapsedTime() &lt;&lt;<span class="stringliteral">&quot; sec\n&quot;</span>;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698   <span class="comment">//</span>
<a name="l00699"></a>00699   <span class="comment">// C) Evaluate the underlying EpetraExt model to compute the Epetra outputs</span>
<a name="l00700"></a>00700   <span class="comment">//</span>
<a name="l00701"></a>00701   
<a name="l00702"></a>00702   <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW))
<a name="l00703"></a>00703     *out &lt;&lt; <span class="stringliteral">&quot;\nEvaluating the Epetra output functions ...\n&quot;</span>;
<a name="l00704"></a>00704   timer.start(<span class="keyword">true</span>);
<a name="l00705"></a>00705 
<a name="l00706"></a>00706   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;evalModel(epetraInArgs, <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4c7607a866a7d9ece76cdb7abb18ca49">evaluated_epetraUnscaledOutArgs</a>);
<a name="l00707"></a>00707 
<a name="l00708"></a>00708   timer.stop();
<a name="l00709"></a>00709   <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW))
<a name="l00710"></a>00710     OSTab(out).o()
<a name="l00711"></a>00711       &lt;&lt; <span class="stringliteral">&quot;\nTime to evaluate Epetra output functions = &quot;</span>
<a name="l00712"></a>00712       &lt;&lt; timer.totalElapsedTime() &lt;&lt;<span class="stringliteral">&quot; sec\n&quot;</span>;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714   <span class="comment">//</span>
<a name="l00715"></a>00715   <span class="comment">// D) Postprocess the output objects</span>
<a name="l00716"></a>00716   <span class="comment">//</span>
<a name="l00717"></a>00717 
<a name="l00718"></a>00718   <span class="comment">//</span>
<a name="l00719"></a>00719   <span class="comment">// D.1) Compute the scaling factors if needed</span>
<a name="l00720"></a>00720   <span class="comment">//</span>
<a name="l00721"></a>00721   
<a name="l00722"></a>00722   <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW))
<a name="l00723"></a>00723     *out &lt;&lt; <span class="stringliteral">&quot;\nCompute scale factors if needed ...\n&quot;</span>;
<a name="l00724"></a>00724   timer.start(<span class="keyword">true</span>);
<a name="l00725"></a>00725 
<a name="l00726"></a>00726   <span class="keywordflow">if</span> (firstTimeStateFuncScaling) {
<a name="l00727"></a>00727     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ada29e56806ef483d24063ab7ab50846e" title=".">postEvalScalingSetup</a>(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4c7607a866a7d9ece76cdb7abb18ca49">evaluated_epetraUnscaledOutArgs</a>,out,verbLevel);
<a name="l00728"></a>00728   }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730   timer.stop();
<a name="l00731"></a>00731   <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW))
<a name="l00732"></a>00732     OSTab(out).o()
<a name="l00733"></a>00733       &lt;&lt; <span class="stringliteral">&quot;\nTime to compute scale factors = &quot;</span>
<a name="l00734"></a>00734       &lt;&lt; timer.totalElapsedTime() &lt;&lt;<span class="stringliteral">&quot; sec\n&quot;</span>;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736   <span class="comment">//</span>
<a name="l00737"></a>00737   <span class="comment">// D.2) Scale the output Epetra objects</span>
<a name="l00738"></a>00738   <span class="comment">//</span>
<a name="l00739"></a>00739 
<a name="l00740"></a>00740   <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW))
<a name="l00741"></a>00741     *out &lt;&lt; <span class="stringliteral">&quot;\nScale the output objects ...\n&quot;</span>;
<a name="l00742"></a>00742   timer.start(<span class="keyword">true</span>);
<a name="l00743"></a>00743 
<a name="l00744"></a>00744   EME::OutArgs epetraOutArgs = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createOutArgs();
<a name="l00745"></a>00745   <span class="keywordtype">bool</span> allFuncsWhereScaled = <span class="keyword">false</span>;
<a name="l00746"></a>00746   EpetraExt::scaleModelFuncs(
<a name="l00747"></a>00747     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4c7607a866a7d9ece76cdb7abb18ca49">evaluated_epetraUnscaledOutArgs</a>, <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a080091e2ec065680ccb17fc9f43ff49f">epetraInArgsScaling_</a>, <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a606845977a120c02163efe367fefa7e4">epetraOutArgsScaling_</a>,
<a name="l00748"></a>00748     &amp;epetraOutArgs, &amp;allFuncsWhereScaled,
<a name="l00749"></a>00749     out.get(), verbLevel
<a name="l00750"></a>00750     );
<a name="l00751"></a>00751   TEUCHOS_TEST_FOR_EXCEPTION(
<a name="l00752"></a>00752     !allFuncsWhereScaled, std::logic_error,
<a name="l00753"></a>00753     <span class="stringliteral">&quot;Error, we can not currently handle epetra output objects that could not be&quot;</span>
<a name="l00754"></a>00754     <span class="stringliteral">&quot; scaled.  Special code will have to be added to handle this (i.e. using&quot;</span>
<a name="l00755"></a>00755     <span class="stringliteral">&quot; implicit diagonal and multiplied linear operators to implicitly do&quot;</span>
<a name="l00756"></a>00756     <span class="stringliteral">&quot; the scaling.&quot;</span>
<a name="l00757"></a>00757     );
<a name="l00758"></a>00758 
<a name="l00759"></a>00759   timer.stop();
<a name="l00760"></a>00760   <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW))
<a name="l00761"></a>00761     OSTab(out).o()
<a name="l00762"></a>00762       &lt;&lt; <span class="stringliteral">&quot;\nTime to scale the output objects = &quot;</span>
<a name="l00763"></a>00763       &lt;&lt; timer.totalElapsedTime() &lt;&lt; <span class="stringliteral">&quot; sec\n&quot;</span>;
<a name="l00764"></a>00764 
<a name="l00765"></a>00765   <span class="comment">//</span>
<a name="l00766"></a>00766   <span class="comment">// D.3) Convert any Epetra objects to Thyra OutArgs objects that still need to</span>
<a name="l00767"></a>00767   <span class="comment">// be converted</span>
<a name="l00768"></a>00768   <span class="comment">//</span>
<a name="l00769"></a>00769 
<a name="l00770"></a>00770   <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW))
<a name="l00771"></a>00771     *out &lt;&lt; <span class="stringliteral">&quot;\nFinish processing and wrapping the output objects ...\n&quot;</span>;
<a name="l00772"></a>00772   timer.start(<span class="keyword">true</span>);
<a name="l00773"></a>00773 
<a name="l00774"></a>00774   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a9a44ece1a12ddbd09856487f2bc4756d" title=".">finishConvertingOutArgsFromEpetraToThyra</a>(
<a name="l00775"></a>00775     epetraOutArgs, W_op, efwdW, eW,
<a name="l00776"></a>00776     outArgs
<a name="l00777"></a>00777     );
<a name="l00778"></a>00778 
<a name="l00779"></a>00779   timer.stop();
<a name="l00780"></a>00780   <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW))
<a name="l00781"></a>00781     OSTab(out).o()
<a name="l00782"></a>00782       &lt;&lt; <span class="stringliteral">&quot;\nTime to finish processing and wrapping the output objects = &quot;</span>
<a name="l00783"></a>00783       &lt;&lt; timer.totalElapsedTime() &lt;&lt;<span class="stringliteral">&quot; sec\n&quot;</span>;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785   <span class="comment">//</span>
<a name="l00786"></a>00786   <span class="comment">// E) Print footer to end the function</span>
<a name="l00787"></a>00787   <span class="comment">//</span>
<a name="l00788"></a>00788 
<a name="l00789"></a>00789   THYRA_MODEL_EVALUATOR_DECORATOR_EVAL_MODEL_END();
<a name="l00790"></a>00790   
<a name="l00791"></a>00791 }
<a name="l00792"></a>00792 
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 <span class="comment">// private</span>
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 
<a name="l00797"></a>00797 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae43eab0dfa783b6c094405477ce29062" title=".">ThyraAdaptiveModelEvaluator::convertInArgsFromEpetraToThyra</a>(
<a name="l00798"></a>00798   <span class="keyword">const</span> EpetraExt::ModelEvaluator::InArgs &amp;epetraInArgs,
<a name="l00799"></a>00799   ModelEvaluatorBase::InArgs&lt;double&gt; *inArgs
<a name="l00800"></a>00800   )<span class="keyword"> const</span>
<a name="l00801"></a>00801 <span class="keyword"></span>{
<a name="l00802"></a>00802   
<a name="l00803"></a>00803   <span class="keyword">using</span> Teuchos::implicit_cast;
<a name="l00804"></a>00804   <span class="keyword">typedef</span> ModelEvaluatorBase MEB;
<a name="l00805"></a>00805 
<a name="l00806"></a>00806   TEUCHOS_TEST_FOR_EXCEPT(!inArgs);
<a name="l00807"></a>00807 
<a name="l00808"></a>00808   <span class="keywordflow">if</span>(inArgs-&gt;supports(MEB::IN_ARG_x)) {
<a name="l00809"></a>00809     inArgs-&gt;set_x( create_Vector( epetraInArgs.get_x(), <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7277bb4571cfa23d8b71749663d741d3">x_space_</a> ) );
<a name="l00810"></a>00810   }
<a name="l00811"></a>00811   
<a name="l00812"></a>00812   <span class="keywordflow">if</span>(inArgs-&gt;supports(MEB::IN_ARG_x_dot)) {
<a name="l00813"></a>00813     inArgs-&gt;set_x_dot( create_Vector( epetraInArgs.get_x_dot(), <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7277bb4571cfa23d8b71749663d741d3">x_space_</a> ) );
<a name="l00814"></a>00814   }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816   <span class="keyword">const</span> <span class="keywordtype">int</span> l_Np = inArgs-&gt;Np();
<a name="l00817"></a>00817   <span class="keywordflow">for</span>( <span class="keywordtype">int</span> l = 0; l &lt; l_Np; ++l ) {
<a name="l00818"></a>00818     inArgs-&gt;set_p( l, create_Vector( epetraInArgs.get_p(l), <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a7817b38743673e1a6e621ee064a468df">p_space_</a>[l] ) );
<a name="l00819"></a>00819   }
<a name="l00820"></a>00820   
<a name="l00821"></a>00821   <span class="keywordflow">if</span>(inArgs-&gt;supports(MEB::IN_ARG_t)) {
<a name="l00822"></a>00822     inArgs-&gt;set_t(epetraInArgs.get_t());
<a name="l00823"></a>00823   }
<a name="l00824"></a>00824   
<a name="l00825"></a>00825 }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ad31b141d4876d0e8b7cf32d97dcc585c" title=".">ThyraAdaptiveModelEvaluator::convertInArgsFromThyraToEpetra</a>(
<a name="l00829"></a>00829   <span class="keyword">const</span> ModelEvaluatorBase::InArgs&lt;double&gt; &amp;inArgs,
<a name="l00830"></a>00830   EpetraExt::ModelEvaluator::InArgs *epetraInArgs
<a name="l00831"></a>00831   )<span class="keyword"> const</span>
<a name="l00832"></a>00832 <span class="keyword"></span>{
<a name="l00833"></a>00833 
<a name="l00834"></a>00834   <span class="keyword">using</span> Teuchos::rcp;
<a name="l00835"></a>00835   <span class="keyword">using</span> Teuchos::rcp_const_cast;
<a name="l00836"></a>00836 <span class="preprocessor">#ifdef HAVE_THYRA_ME_POLYNOMIAL</span>
<a name="l00837"></a>00837 <span class="preprocessor"></span>  <span class="keyword">using</span> Teuchos::Polynomial;
<a name="l00838"></a>00838 <span class="preprocessor">#endif // HAVE_THYRA_ME_POLYNOMIAL</span>
<a name="l00839"></a>00839 <span class="preprocessor"></span>
<a name="l00840"></a>00840 
<a name="l00841"></a>00841   TEUCHOS_TEST_FOR_EXCEPT(0==epetraInArgs);
<a name="l00842"></a>00842 
<a name="l00843"></a>00843   RCP&lt;const VectorBase&lt;double&gt; &gt; x_dot;
<a name="l00844"></a>00844   <span class="keywordflow">if</span>( inArgs.supports(IN_ARG_x_dot) &amp;&amp; (x_dot = inArgs.get_x_dot()).<span class="keyword">get</span>() ) {
<a name="l00845"></a>00845     RCP&lt;const Epetra_Vector&gt; e_x_dot = get_Epetra_Vector(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a1091e6560c3206681a1295988c5c9738">x_map_</a>,x_dot);
<a name="l00846"></a>00846     epetraInArgs-&gt;set_x_dot(e_x_dot);
<a name="l00847"></a>00847   }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849   RCP&lt;const VectorBase&lt;double&gt; &gt; x;
<a name="l00850"></a>00850   <span class="keywordflow">if</span>( inArgs.supports(IN_ARG_x) &amp;&amp; (x = inArgs.get_x()).<span class="keyword">get</span>() ) {
<a name="l00851"></a>00851     RCP&lt;const Epetra_Vector&gt; e_x = get_Epetra_Vector(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a1091e6560c3206681a1295988c5c9738">x_map_</a>,x);
<a name="l00852"></a>00852     epetraInArgs-&gt;set_x(e_x);
<a name="l00853"></a>00853   }
<a name="l00854"></a>00854 
<a name="l00855"></a>00855   RCP&lt;const VectorBase&lt;double&gt; &gt; p_l;
<a name="l00856"></a>00856   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l = 0;  l &lt; inArgs.Np(); ++l ) {
<a name="l00857"></a>00857     p_l = inArgs.get_p(l);
<a name="l00858"></a>00858     <span class="keywordflow">if</span>(p_l.get()) epetraInArgs-&gt;set_p(l,get_Epetra_Vector(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ac400a29fa880daf0a3251fdc1430c24c">p_map_</a>[l],p_l));
<a name="l00859"></a>00859   }
<a name="l00860"></a>00860 
<a name="l00861"></a>00861 <span class="preprocessor">#ifdef HAVE_THYRA_ME_POLYNOMIAL</span>
<a name="l00862"></a>00862 <span class="preprocessor"></span>
<a name="l00863"></a>00863   RCP&lt;const Polynomial&lt; VectorBase&lt;double&gt; &gt; &gt; x_dot_poly;
<a name="l00864"></a>00864   RCP&lt;Epetra_Vector&gt; epetra_ptr;
<a name="l00865"></a>00865   <span class="keywordflow">if</span>(
<a name="l00866"></a>00866     inArgs.supports(IN_ARG_x_dot_poly)
<a name="l00867"></a>00867     &amp;&amp; (x_dot_poly = inArgs.get_x_dot_poly()).<span class="keyword">get</span>()
<a name="l00868"></a>00868     )
<a name="l00869"></a>00869   {
<a name="l00870"></a>00870     RCP&lt;Polynomial&lt;Epetra_Vector&gt; &gt; epetra_x_dot_poly = 
<a name="l00871"></a>00871       rcp(<span class="keyword">new</span> Polynomial&lt;Epetra_Vector&gt;(x_dot_poly-&gt;degree()));
<a name="l00872"></a>00872     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;=x_dot_poly-&gt;degree(); i++) {
<a name="l00873"></a>00873       epetra_ptr = rcp_const_cast&lt;Epetra_Vector&gt;(
<a name="l00874"></a>00874         get_Epetra_Vector(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a1091e6560c3206681a1295988c5c9738">x_map_</a>, x_dot_poly-&gt;getCoefficient(i)) );
<a name="l00875"></a>00875       epetra_x_dot_poly-&gt;setCoefficientPtr(i,epetra_ptr);
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877     epetraInArgs-&gt;set_x_dot_poly(epetra_x_dot_poly);
<a name="l00878"></a>00878   }
<a name="l00879"></a>00879   
<a name="l00880"></a>00880   RCP&lt;const Polynomial&lt; VectorBase&lt;double&gt; &gt; &gt; x_poly;
<a name="l00881"></a>00881   <span class="keywordflow">if</span>(
<a name="l00882"></a>00882     inArgs.supports(IN_ARG_x_poly)
<a name="l00883"></a>00883     &amp;&amp; (x_poly = inArgs.get_x_poly()).<span class="keyword">get</span>()
<a name="l00884"></a>00884     )
<a name="l00885"></a>00885   {
<a name="l00886"></a>00886     RCP&lt;Polynomial&lt;Epetra_Vector&gt; &gt; epetra_x_poly = 
<a name="l00887"></a>00887       rcp(<span class="keyword">new</span> Polynomial&lt;Epetra_Vector&gt;(x_poly-&gt;degree()));
<a name="l00888"></a>00888     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;=x_poly-&gt;degree(); i++) {
<a name="l00889"></a>00889       epetra_ptr = rcp_const_cast&lt;Epetra_Vector&gt;(
<a name="l00890"></a>00890         get_Epetra_Vector(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a1091e6560c3206681a1295988c5c9738">x_map_</a>, x_poly-&gt;getCoefficient(i)) );
<a name="l00891"></a>00891       epetra_x_poly-&gt;setCoefficientPtr(i,epetra_ptr);
<a name="l00892"></a>00892     }
<a name="l00893"></a>00893     epetraInArgs-&gt;set_x_poly(epetra_x_poly);
<a name="l00894"></a>00894   }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 <span class="preprocessor">#endif // HAVE_THYRA_ME_POLYNOMIAL</span>
<a name="l00897"></a>00897 <span class="preprocessor"></span>
<a name="l00898"></a>00898   <span class="keywordflow">if</span>( inArgs.supports(IN_ARG_t) )
<a name="l00899"></a>00899     epetraInArgs-&gt;set_t(inArgs.get_t());
<a name="l00900"></a>00900   
<a name="l00901"></a>00901   <span class="keywordflow">if</span>( inArgs.supports(IN_ARG_alpha) )
<a name="l00902"></a>00902     epetraInArgs-&gt;set_alpha(inArgs.get_alpha());
<a name="l00903"></a>00903   
<a name="l00904"></a>00904   <span class="keywordflow">if</span>( inArgs.supports(IN_ARG_beta) )
<a name="l00905"></a>00905     epetraInArgs-&gt;set_beta(inArgs.get_beta());
<a name="l00906"></a>00906 
<a name="l00907"></a>00907 }
<a name="l00908"></a>00908 
<a name="l00909"></a>00909 
<a name="l00910"></a>00910 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a637bd694e117f42e4771b2aacb1491b7" title=".">ThyraAdaptiveModelEvaluator::convertOutArgsFromThyraToEpetra</a>(
<a name="l00911"></a>00911   <span class="keyword">const</span> ModelEvaluatorBase::OutArgs&lt;double&gt; &amp;outArgs,
<a name="l00912"></a>00912   EpetraExt::ModelEvaluator::OutArgs *epetraUnscaledOutArgs_inout,
<a name="l00913"></a>00913   RCP&lt;LinearOpBase&lt;double&gt; &gt; *W_op_out,
<a name="l00914"></a>00914   RCP&lt;EpetraLinearOp&gt; *efwdW_out,
<a name="l00915"></a>00915   RCP&lt;Epetra_Operator&gt; *eW_out
<a name="l00916"></a>00916   )<span class="keyword"> const</span>
<a name="l00917"></a>00917 <span class="keyword"></span>{
<a name="l00918"></a>00918 
<a name="l00919"></a>00919   <span class="keyword">using</span> Teuchos::rcp;
<a name="l00920"></a>00920   <span class="keyword">using</span> Teuchos::rcp_const_cast;
<a name="l00921"></a>00921   <span class="keyword">using</span> Teuchos::rcp_dynamic_cast;
<a name="l00922"></a>00922   <span class="keyword">using</span> Teuchos::OSTab;
<a name="l00923"></a>00923   <span class="keyword">using</span> Teuchos::implicit_cast;
<a name="l00924"></a>00924   <span class="keyword">using</span> Thyra::get_Epetra_Vector;
<a name="l00925"></a>00925   <span class="keyword">typedef</span> EpetraExt::ModelEvaluator EME;
<a name="l00926"></a>00926 
<a name="l00927"></a>00927   <span class="comment">// Assert input</span>
<a name="l00928"></a>00928 <span class="preprocessor">#ifdef TEUCHOS_DEBUG</span>
<a name="l00929"></a>00929 <span class="preprocessor"></span>  TEUCHOS_ASSERT(epetraUnscaledOutArgs_inout);
<a name="l00930"></a>00930   TEUCHOS_ASSERT(W_op_out);
<a name="l00931"></a>00931   TEUCHOS_ASSERT(efwdW_out);
<a name="l00932"></a>00932   TEUCHOS_ASSERT(eW_out);
<a name="l00933"></a>00933 <span class="preprocessor">#endif</span>
<a name="l00934"></a>00934 <span class="preprocessor"></span>
<a name="l00935"></a>00935   <span class="comment">// Create easy to use references</span>
<a name="l00936"></a>00936   EpetraExt::ModelEvaluator::OutArgs &amp;epetraUnscaledOutArgs = *epetraUnscaledOutArgs_inout;
<a name="l00937"></a>00937   RCP&lt;LinearOpBase&lt;double&gt; &gt; &amp;W_op = *W_op_out;
<a name="l00938"></a>00938   RCP&lt;EpetraLinearOp&gt; &amp;efwdW = *efwdW_out;
<a name="l00939"></a>00939   RCP&lt;Epetra_Operator&gt; &amp;eW = *eW_out;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941   <span class="comment">// f</span>
<a name="l00942"></a>00942   { 
<a name="l00943"></a>00943     RCP&lt;VectorBase&lt;double&gt; &gt; f;
<a name="l00944"></a>00944     <span class="keywordflow">if</span>( outArgs.supports(OUT_ARG_f) &amp;&amp; (f = outArgs.get_f()).<span class="keyword">get</span>() )
<a name="l00945"></a>00945       epetraUnscaledOutArgs.set_f(get_Epetra_Vector(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aea77c1812ea611749c9e7e1a0a5599ac">f_map_</a>,f));
<a name="l00946"></a>00946   }
<a name="l00947"></a>00947     
<a name="l00948"></a>00948   <span class="comment">// g</span>
<a name="l00949"></a>00949   {
<a name="l00950"></a>00950     RCP&lt;VectorBase&lt;double&gt; &gt; g_j;
<a name="l00951"></a>00951     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0;  j &lt; outArgs.Ng(); ++j ) {
<a name="l00952"></a>00952       g_j = outArgs.get_g(j);
<a name="l00953"></a>00953       <span class="keywordflow">if</span>(g_j.get()) epetraUnscaledOutArgs.set_g(j,get_Epetra_Vector(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a2cc4a6ddc8ad20174d90364e544a9f9d">g_map_</a>[j],g_j));
<a name="l00954"></a>00954     }
<a name="l00955"></a>00955   }
<a name="l00956"></a>00956   
<a name="l00957"></a>00957   <span class="comment">// W_op</span>
<a name="l00958"></a>00958   {
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     <span class="keywordflow">if</span> (outArgs.supports(OUT_ARG_W_op) &amp;&amp; nonnull(W_op = outArgs.get_W_op())) {
<a name="l00961"></a>00961       <span class="keywordflow">if</span> (nonnull(W_op) &amp;&amp; is_null(efwdW)) {
<a name="l00962"></a>00962         efwdW = rcp_const_cast&lt;EpetraLinearOp&gt;(
<a name="l00963"></a>00963           rcp_dynamic_cast&lt;<span class="keyword">const</span> EpetraLinearOp&gt;(W_op, <span class="keyword">true</span>));
<a name="l00964"></a>00964       }
<a name="l00965"></a>00965     }
<a name="l00966"></a>00966     
<a name="l00967"></a>00967     <span class="keywordflow">if</span> (nonnull(efwdW)) {
<a name="l00968"></a>00968       <span class="comment">// By the time we get here, if we have an object in efwdW, then it</span>
<a name="l00969"></a>00969       <span class="comment">// should already be embeadded with an underlying Epetra_Operator object</span>
<a name="l00970"></a>00970       <span class="comment">// that was allocated by the EpetraExt::ModelEvaluator object.</span>
<a name="l00971"></a>00971       <span class="comment">// Therefore, we should just have to grab this object and be on our way.</span>
<a name="l00972"></a>00972       eW = efwdW-&gt;epetra_op();
<a name="l00973"></a>00973       epetraUnscaledOutArgs.set_W(eW);
<a name="l00974"></a>00974     }
<a name="l00975"></a>00975     
<a name="l00976"></a>00976     <span class="comment">// Note: The following derivative objects update in place!</span>
<a name="l00977"></a>00977 
<a name="l00978"></a>00978   }
<a name="l00979"></a>00979 
<a name="l00980"></a>00980   <span class="comment">// DfDp</span>
<a name="l00981"></a>00981   {
<a name="l00982"></a>00982     Derivative&lt;double&gt; DfDp_l;
<a name="l00983"></a>00983     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l = 0;  l &lt; outArgs.Np(); ++l ) {
<a name="l00984"></a>00984       <span class="keywordflow">if</span>( !outArgs.supports(OUT_ARG_DfDp,l).none()
<a name="l00985"></a>00985         &amp;&amp; !(DfDp_l = outArgs.get_DfDp(l)).isEmpty() )
<a name="l00986"></a>00986       {
<a name="l00987"></a>00987         epetraUnscaledOutArgs.set_DfDp(l,convert(DfDp_l,<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aea77c1812ea611749c9e7e1a0a5599ac">f_map_</a>,<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ac400a29fa880daf0a3251fdc1430c24c">p_map_</a>[l]));
<a name="l00988"></a>00988       }
<a name="l00989"></a>00989     }
<a name="l00990"></a>00990   }
<a name="l00991"></a>00991 
<a name="l00992"></a>00992   <span class="comment">// DgDx_dot</span>
<a name="l00993"></a>00993   {
<a name="l00994"></a>00994     Derivative&lt;double&gt; DgDx_dot_j;
<a name="l00995"></a>00995     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0;  j &lt; outArgs.Ng(); ++j ) {
<a name="l00996"></a>00996       <span class="keywordflow">if</span>( !outArgs.supports(OUT_ARG_DgDx_dot,j).none()
<a name="l00997"></a>00997         &amp;&amp; !(DgDx_dot_j = outArgs.get_DgDx_dot(j)).isEmpty() )
<a name="l00998"></a>00998       {
<a name="l00999"></a>00999         epetraUnscaledOutArgs.set_DgDx_dot(j,convert(DgDx_dot_j,<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a2cc4a6ddc8ad20174d90364e544a9f9d">g_map_</a>[j],<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a1091e6560c3206681a1295988c5c9738">x_map_</a>));
<a name="l01000"></a>01000       }
<a name="l01001"></a>01001     }
<a name="l01002"></a>01002   }
<a name="l01003"></a>01003 
<a name="l01004"></a>01004   <span class="comment">// DgDx</span>
<a name="l01005"></a>01005   {
<a name="l01006"></a>01006     Derivative&lt;double&gt; DgDx_j;
<a name="l01007"></a>01007     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0;  j &lt; outArgs.Ng(); ++j ) {
<a name="l01008"></a>01008       <span class="keywordflow">if</span>( !outArgs.supports(OUT_ARG_DgDx,j).none()
<a name="l01009"></a>01009         &amp;&amp; !(DgDx_j = outArgs.get_DgDx(j)).isEmpty() )
<a name="l01010"></a>01010       {
<a name="l01011"></a>01011         epetraUnscaledOutArgs.set_DgDx(j,convert(DgDx_j,<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a2cc4a6ddc8ad20174d90364e544a9f9d">g_map_</a>[j],<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a1091e6560c3206681a1295988c5c9738">x_map_</a>));
<a name="l01012"></a>01012       }
<a name="l01013"></a>01013     }
<a name="l01014"></a>01014   }
<a name="l01015"></a>01015 
<a name="l01016"></a>01016   <span class="comment">// DgDp</span>
<a name="l01017"></a>01017   {
<a name="l01018"></a>01018     DerivativeSupport DgDp_j_l_support;
<a name="l01019"></a>01019     Derivative&lt;double&gt; DgDp_j_l;
<a name="l01020"></a>01020     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0;  j &lt; outArgs.Ng(); ++j ) {
<a name="l01021"></a>01021       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0;  l &lt; outArgs.Np(); ++l ) {
<a name="l01022"></a>01022         <span class="keywordflow">if</span> (!(DgDp_j_l_support = outArgs.supports(OUT_ARG_DgDp,j,l)).none()
<a name="l01023"></a>01023           &amp;&amp; !(DgDp_j_l = outArgs.get_DgDp(j,l)).isEmpty() )
<a name="l01024"></a>01024         {
<a name="l01025"></a>01025           epetraUnscaledOutArgs.set_DgDp(j,l,convert(DgDp_j_l,<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a2cc4a6ddc8ad20174d90364e544a9f9d">g_map_</a>[j],<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ac400a29fa880daf0a3251fdc1430c24c">p_map_</a>[l]));
<a name="l01026"></a>01026         }
<a name="l01027"></a>01027       }
<a name="l01028"></a>01028     }
<a name="l01029"></a>01029   }
<a name="l01030"></a>01030 
<a name="l01031"></a>01031 <span class="preprocessor">#ifdef HAVE_THYRA_ME_POLYNOMIAL</span>
<a name="l01032"></a>01032 <span class="preprocessor"></span>
<a name="l01033"></a>01033   <span class="comment">// f_poly</span>
<a name="l01034"></a>01034   RCP&lt;const Teuchos::Polynomial&lt; VectorBase&lt;double&gt; &gt; &gt; f_poly;
<a name="l01035"></a>01035   <span class="keywordflow">if</span>( outArgs.supports(OUT_ARG_f_poly) &amp;&amp; (f_poly = outArgs.get_f_poly()).<span class="keyword">get</span>() )
<a name="l01036"></a>01036   {
<a name="l01037"></a>01037     RCP&lt;Teuchos::Polynomial&lt;Epetra_Vector&gt; &gt; epetra_f_poly = 
<a name="l01038"></a>01038       Teuchos::rcp(<span class="keyword">new</span> Teuchos::Polynomial&lt;Epetra_Vector&gt;(f_poly-&gt;degree()));
<a name="l01039"></a>01039     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;=f_poly-&gt;degree(); i++) {
<a name="l01040"></a>01040       RCP&lt;Epetra_Vector&gt; epetra_ptr
<a name="l01041"></a>01041         = Teuchos::rcp_const_cast&lt;Epetra_Vector&gt;(get_Epetra_Vector(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aea77c1812ea611749c9e7e1a0a5599ac">f_map_</a>,
<a name="l01042"></a>01042             f_poly-&gt;getCoefficient(i)));
<a name="l01043"></a>01043       epetra_f_poly-&gt;setCoefficientPtr(i,epetra_ptr);
<a name="l01044"></a>01044     }
<a name="l01045"></a>01045     epetraUnscaledOutArgs.set_f_poly(epetra_f_poly);
<a name="l01046"></a>01046   }
<a name="l01047"></a>01047 
<a name="l01048"></a>01048 <span class="preprocessor">#endif // HAVE_THYRA_ME_POLYNOMIAL</span>
<a name="l01049"></a>01049 <span class="preprocessor"></span>
<a name="l01050"></a>01050 }
<a name="l01051"></a>01051 
<a name="l01052"></a>01052 
<a name="l01053"></a>01053 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a6feb806b4bd8762200b756d1f3697962" title=".">ThyraAdaptiveModelEvaluator::preEvalScalingSetup</a>(
<a name="l01054"></a>01054   EpetraExt::ModelEvaluator::InArgs *epetraInArgs_inout,
<a name="l01055"></a>01055   EpetraExt::ModelEvaluator::OutArgs *epetraUnscaledOutArgs_inout,
<a name="l01056"></a>01056   <span class="keyword">const</span> RCP&lt;Teuchos::FancyOStream&gt; &amp;out,
<a name="l01057"></a>01057   <span class="keyword">const</span> Teuchos::EVerbosityLevel verbLevel
<a name="l01058"></a>01058   )<span class="keyword"> const</span>
<a name="l01059"></a>01059 <span class="keyword"></span>{
<a name="l01060"></a>01060   
<a name="l01061"></a>01061   <span class="keyword">typedef</span> EpetraExt::ModelEvaluator EME;
<a name="l01062"></a>01062   
<a name="l01063"></a>01063 <span class="preprocessor">#ifdef TEUCHOS_DEBUG</span>
<a name="l01064"></a>01064 <span class="preprocessor"></span>  TEUCHOS_ASSERT(epetraInArgs_inout);
<a name="l01065"></a>01065   TEUCHOS_ASSERT(epetraUnscaledOutArgs_inout);
<a name="l01066"></a>01066 <span class="preprocessor">#endif</span>
<a name="l01067"></a>01067 <span class="preprocessor"></span>
<a name="l01068"></a>01068   EpetraExt::ModelEvaluator::InArgs
<a name="l01069"></a>01069     &amp;epetraInArgs = *epetraInArgs_inout;
<a name="l01070"></a>01070   EpetraExt::ModelEvaluator::OutArgs
<a name="l01071"></a>01071     &amp;epetraUnscaledOutArgs = *epetraUnscaledOutArgs_inout;
<a name="l01072"></a>01072 
<a name="l01073"></a>01073   <span class="keywordflow">if</span> (
<a name="l01074"></a>01074     ( <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a972ab0ad7440608f5d3deaeb0d5004d2">stateFunctionScaling_</a> == <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aa68f4a350638e1332e7ee9137a1cfc05a9addc0753608275ed246238e0e9d8b7a">STATE_FUNC_SCALING_ROW_SUM</a> )
<a name="l01075"></a>01075     &amp;&amp;
<a name="l01076"></a>01076     (
<a name="l01077"></a>01077       epetraUnscaledOutArgs.supports(EME::OUT_ARG_f) 
<a name="l01078"></a>01078       &amp;&amp;
<a name="l01079"></a>01079       epetraUnscaledOutArgs.funcOrDerivesAreSet(EME::OUT_ARG_f)
<a name="l01080"></a>01080       )
<a name="l01081"></a>01081     &amp;&amp;
<a name="l01082"></a>01082     (
<a name="l01083"></a>01083       epetraUnscaledOutArgs.supports(EME::OUT_ARG_W)
<a name="l01084"></a>01084       &amp;&amp;
<a name="l01085"></a>01085       is_null(epetraUnscaledOutArgs.get_W())
<a name="l01086"></a>01086       )
<a name="l01087"></a>01087     )
<a name="l01088"></a>01088   {
<a name="l01089"></a>01089     <span class="comment">// This is the first pass through with scaling turned on and the client</span>
<a name="l01090"></a>01090     <span class="comment">// turned on automatic scaling but did not ask for W.  We must compute W</span>
<a name="l01091"></a>01091     <span class="comment">// in order to compute the scale factors so we must allocate a temporary W</span>
<a name="l01092"></a>01092     <span class="comment">// just to compute the scale factors and then throw it away.  If the</span>
<a name="l01093"></a>01093     <span class="comment">// client wants to evaluate W at the same point, then it should have</span>
<a name="l01094"></a>01094     <span class="comment">// passed W in but that is not our problem here.  The ModelEvaluator</span>
<a name="l01095"></a>01095     <span class="comment">// relies on the client to set up the calls to allow for efficient</span>
<a name="l01096"></a>01096     <span class="comment">// evaluation.</span>
<a name="l01097"></a>01097 
<a name="l01098"></a>01098     <span class="keywordflow">if</span>(out.get() &amp;&amp; verbLevel &gt;= Teuchos::VERB_LOW)
<a name="l01099"></a>01099       *out
<a name="l01100"></a>01100         &lt;&lt; <span class="stringliteral">&quot;\nCreating a temporary Epetra W to compute scale factors&quot;</span>
<a name="l01101"></a>01101         &lt;&lt; <span class="stringliteral">&quot; for f(...) ...\n&quot;</span>;
<a name="l01102"></a>01102     epetraUnscaledOutArgs.set_W(create_and_assert_W(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>));
<a name="l01103"></a>01103     <span class="keywordflow">if</span>( epetraInArgs.supports(EME::IN_ARG_beta) )
<a name="l01104"></a>01104       epetraInArgs.set_beta(1.0);
<a name="l01105"></a>01105     <span class="keywordflow">if</span>( epetraInArgs.supports(EME::IN_ARG_alpha) )
<a name="l01106"></a>01106       epetraInArgs.set_alpha(0.0);
<a name="l01107"></a>01107   }
<a name="l01108"></a>01108   
<a name="l01109"></a>01109 }
<a name="l01110"></a>01110 
<a name="l01111"></a>01111 
<a name="l01112"></a>01112 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ada29e56806ef483d24063ab7ab50846e" title=".">ThyraAdaptiveModelEvaluator::postEvalScalingSetup</a>(
<a name="l01113"></a>01113   <span class="keyword">const</span> EpetraExt::ModelEvaluator::OutArgs &amp;epetraUnscaledOutArgs,
<a name="l01114"></a>01114   <span class="keyword">const</span> RCP&lt;Teuchos::FancyOStream&gt; &amp;out,
<a name="l01115"></a>01115   <span class="keyword">const</span> Teuchos::EVerbosityLevel verbLevel
<a name="l01116"></a>01116   )<span class="keyword"> const</span>
<a name="l01117"></a>01117 <span class="keyword"></span>{
<a name="l01118"></a>01118 
<a name="l01119"></a>01119   <span class="keyword">using</span> Teuchos::OSTab;
<a name="l01120"></a>01120   <span class="keyword">using</span> Teuchos::rcp;
<a name="l01121"></a>01121   <span class="keyword">using</span> Teuchos::rcp_const_cast;
<a name="l01122"></a>01122   <span class="keyword">using</span> Teuchos::includesVerbLevel;
<a name="l01123"></a>01123 
<a name="l01124"></a>01124   <span class="comment">// Compute the scale factors for the state function f(...)</span>
<a name="l01125"></a>01125   <span class="keywordflow">switch</span>(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a972ab0ad7440608f5d3deaeb0d5004d2">stateFunctionScaling_</a>) {
<a name="l01126"></a>01126 
<a name="l01127"></a>01127     <span class="keywordflow">case</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aa68f4a350638e1332e7ee9137a1cfc05a9addc0753608275ed246238e0e9d8b7a">STATE_FUNC_SCALING_ROW_SUM</a>: {
<a name="l01128"></a>01128 
<a name="l01129"></a>01129       <span class="comment">// Compute the inverse row-sum scaling from W</span>
<a name="l01130"></a>01130 
<a name="l01131"></a>01131       <span class="keyword">const</span> RCP&lt;Epetra_RowMatrix&gt;
<a name="l01132"></a>01132         ermW = get_Epetra_RowMatrix(epetraUnscaledOutArgs);
<a name="l01133"></a>01133       <span class="comment">// Note: Above, we get the Epetra W object directly from the Epetra</span>
<a name="l01134"></a>01134       <span class="comment">// OutArgs object since this might be a temporary matrix just to</span>
<a name="l01135"></a>01135       <span class="comment">// compute scaling factors.  In this case, the stack funtion variable</span>
<a name="l01136"></a>01136       <span class="comment">// eW might be empty!</span>
<a name="l01137"></a>01137 
<a name="l01138"></a>01138       RCP&lt;Epetra_Vector&gt;
<a name="l01139"></a>01139         invRowSums = rcp(<span class="keyword">new</span> Epetra_Vector(ermW-&gt;OperatorRangeMap()));
<a name="l01140"></a>01140       <span class="comment">// Above: From the documentation is seems that the RangeMap should be</span>
<a name="l01141"></a>01141       <span class="comment">// okay but who knows for sure!</span>
<a name="l01142"></a>01142 
<a name="l01143"></a>01143       ermW-&gt;InvRowSums(*invRowSums);
<a name="l01144"></a>01144 
<a name="l01145"></a>01145       <span class="keywordflow">if</span> (out.get() &amp;&amp; includesVerbLevel(verbLevel,Teuchos::VERB_LOW)) {
<a name="l01146"></a>01146         *out
<a name="l01147"></a>01147           &lt;&lt; <span class="stringliteral">&quot;\nComputed inverse row sum scaling from W that&quot;</span>
<a name="l01148"></a>01148           <span class="stringliteral">&quot; will be used to scale f(...) and its derivatives:\n&quot;</span>;
<a name="l01149"></a>01149         <span class="keywordtype">double</span> minVal = 0, maxVal = 0, avgVal = 0;
<a name="l01150"></a>01150         invRowSums-&gt;MinValue(&amp;minVal);
<a name="l01151"></a>01151         invRowSums-&gt;MaxValue(&amp;maxVal);
<a name="l01152"></a>01152         invRowSums-&gt;MeanValue(&amp;avgVal);
<a name="l01153"></a>01153         OSTab tab(out);
<a name="l01154"></a>01154         *out
<a name="l01155"></a>01155           &lt;&lt; <span class="stringliteral">&quot;min(invRowSums) = &quot;</span> &lt;&lt; minVal &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
<a name="l01156"></a>01156           &lt;&lt; <span class="stringliteral">&quot;max(invRowSums) = &quot;</span> &lt;&lt; maxVal &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
<a name="l01157"></a>01157           &lt;&lt; <span class="stringliteral">&quot;avg(invRowSums) = &quot;</span> &lt;&lt; avgVal &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01158"></a>01158       }
<a name="l01159"></a>01159 
<a name="l01160"></a>01160       <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8d0dd28b26631ea23e94f81395c3d1ea">stateFunctionScalingVec_</a> = invRowSums;
<a name="l01161"></a>01161 
<a name="l01162"></a>01162       <span class="keywordflow">break</span>;
<a name="l01163"></a>01163 
<a name="l01164"></a>01164     }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166     <span class="keywordflow">default</span>:
<a name="l01167"></a>01167       TEUCHOS_TEST_FOR_EXCEPT(<span class="stringliteral">&quot;Should never get here!&quot;</span>);
<a name="l01168"></a>01168 
<a name="l01169"></a>01169   }
<a name="l01170"></a>01170 
<a name="l01171"></a>01171   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a606845977a120c02163efe367fefa7e4">epetraOutArgsScaling_</a> = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createOutArgs();
<a name="l01172"></a>01172 
<a name="l01173"></a>01173   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a606845977a120c02163efe367fefa7e4">epetraOutArgsScaling_</a>.set_f(
<a name="l01174"></a>01174     rcp_const_cast&lt;Epetra_Vector&gt;(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a8d0dd28b26631ea23e94f81395c3d1ea">stateFunctionScalingVec_</a>) );
<a name="l01175"></a>01175 
<a name="l01176"></a>01176 }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178 
<a name="l01179"></a>01179 <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a9a44ece1a12ddbd09856487f2bc4756d" title=".">ThyraAdaptiveModelEvaluator::finishConvertingOutArgsFromEpetraToThyra</a>(
<a name="l01180"></a>01180   <span class="keyword">const</span> EpetraExt::ModelEvaluator::OutArgs &amp;epetraOutArgs,
<a name="l01181"></a>01181   RCP&lt;LinearOpBase&lt;double&gt; &gt; &amp;W_op,
<a name="l01182"></a>01182   RCP&lt;EpetraLinearOp&gt; &amp;efwdW,
<a name="l01183"></a>01183   RCP&lt;Epetra_Operator&gt; &amp;eW,
<a name="l01184"></a>01184   <span class="keyword">const</span> ModelEvaluatorBase::OutArgs&lt;double&gt; &amp;outArgs
<a name="l01185"></a>01185   )<span class="keyword"> const</span>
<a name="l01186"></a>01186 <span class="keyword"></span>{
<a name="l01187"></a>01187 
<a name="l01188"></a>01188   <span class="keyword">using</span> Teuchos::rcp_dynamic_cast;
<a name="l01189"></a>01189   <span class="keyword">typedef</span> EpetraExt::ModelEvaluator EME;
<a name="l01190"></a>01190 
<a name="l01191"></a>01191   <span class="keywordflow">if</span> (nonnull(efwdW)) {
<a name="l01192"></a>01192     efwdW-&gt;setFullyInitialized(<span class="keyword">true</span>); 
<a name="l01193"></a>01193     <span class="comment">// NOTE: Above will directly update W_op also if W.get()==NULL!</span>
<a name="l01194"></a>01194   }
<a name="l01195"></a>01195 
<a name="l01196"></a>01196   <span class="keywordflow">if</span> (nonnull(W_op)) {
<a name="l01197"></a>01197     <span class="keywordflow">if</span> (W_op.shares_resource(efwdW)) {
<a name="l01198"></a>01198       <span class="comment">// W_op was already updated above since *efwdW is the same object as *W_op</span>
<a name="l01199"></a>01199     }
<a name="l01200"></a>01200     <span class="keywordflow">else</span> {
<a name="l01201"></a>01201       rcp_dynamic_cast&lt;EpetraLinearOp&gt;(W_op, <span class="keyword">true</span>)-&gt;setFullyInitialized(<span class="keyword">true</span>);
<a name="l01202"></a>01202     }
<a name="l01203"></a>01203   }
<a name="l01204"></a>01204   
<a name="l01205"></a>01205 }
<a name="l01206"></a>01206 
<a name="l01207"></a>01207 
<a name="l01208"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a30a9c30e8b09768bcc924bcce01dcda4">01208</a> <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a30a9c30e8b09768bcc924bcce01dcda4" title=".">ThyraAdaptiveModelEvaluator::updateNominalValuesAndBounds</a>()<span class="keyword"> const</span>
<a name="l01209"></a>01209 <span class="keyword"></span>{
<a name="l01210"></a>01210 
<a name="l01211"></a>01211   <span class="keyword">using</span> Teuchos::rcp;
<a name="l01212"></a>01212   <span class="keyword">using</span> Teuchos::implicit_cast;
<a name="l01213"></a>01213   <span class="keyword">typedef</span> ModelEvaluatorBase MEB;
<a name="l01214"></a>01214   <span class="keyword">typedef</span> EpetraExt::ModelEvaluator EME;
<a name="l01215"></a>01215 
<a name="l01216"></a>01216   <span class="keywordflow">if</span>( !<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a92ca4d2be3d32458f95294e589b3099d">nominalValuesAndBoundsAreUpdated_</a> ) {
<a name="l01217"></a>01217 
<a name="l01218"></a>01218     <span class="comment">// Gather the nominal values and bounds into Epetra InArgs objects</span>
<a name="l01219"></a>01219 
<a name="l01220"></a>01220     EME::InArgs epetraOrigNominalValues;
<a name="l01221"></a>01221     EpetraExt::gatherModelNominalValues(
<a name="l01222"></a>01222       *<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>, &amp;epetraOrigNominalValues );
<a name="l01223"></a>01223 
<a name="l01224"></a>01224     EME::InArgs epetraOrigLowerBounds;
<a name="l01225"></a>01225     EME::InArgs epetraOrigUpperBounds;
<a name="l01226"></a>01226     EpetraExt::gatherModelBounds(
<a name="l01227"></a>01227       *<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>, &amp;epetraOrigLowerBounds, &amp;epetraOrigUpperBounds );
<a name="l01228"></a>01228 
<a name="l01229"></a>01229     <span class="comment">// Set up Epetra InArgs scaling object</span>
<a name="l01230"></a>01230 
<a name="l01231"></a>01231     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a080091e2ec065680ccb17fc9f43ff49f">epetraInArgsScaling_</a> = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createInArgs();
<a name="l01232"></a>01232 
<a name="l01233"></a>01233     <span class="keywordflow">if</span>( !is_null(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4e3ae6a1a4403f25f718af2eb0f9fb54">stateVariableScalingVec_</a>) ) {
<a name="l01234"></a>01234       <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a17d10e85775c84a66ed183b8c82e9e51">invStateVariableScalingVec_</a>
<a name="l01235"></a>01235         = EpetraExt::createInverseModelScalingVector(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a4e3ae6a1a4403f25f718af2eb0f9fb54">stateVariableScalingVec_</a>);
<a name="l01236"></a>01236       <span class="keywordflow">if</span>( epetraOrigNominalValues.supports(EME::IN_ARG_x_dot) ) {
<a name="l01237"></a>01237         <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a080091e2ec065680ccb17fc9f43ff49f">epetraInArgsScaling_</a>.set_x_dot(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a17d10e85775c84a66ed183b8c82e9e51">invStateVariableScalingVec_</a>);
<a name="l01238"></a>01238       }
<a name="l01239"></a>01239       <span class="keywordflow">if</span>( epetraOrigNominalValues.supports(EME::IN_ARG_x) ) {
<a name="l01240"></a>01240         <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a080091e2ec065680ccb17fc9f43ff49f">epetraInArgsScaling_</a>.set_x(<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a17d10e85775c84a66ed183b8c82e9e51">invStateVariableScalingVec_</a>);
<a name="l01241"></a>01241       }
<a name="l01242"></a>01242     }
<a name="l01243"></a>01243     
<a name="l01244"></a>01244     <span class="comment">// Scale the original variables and bounds</span>
<a name="l01245"></a>01245 
<a name="l01246"></a>01246     EME::InArgs epetraScaledNominalValues = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createInArgs();
<a name="l01247"></a>01247     EpetraExt::scaleModelVars(
<a name="l01248"></a>01248       epetraOrigNominalValues, <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a080091e2ec065680ccb17fc9f43ff49f">epetraInArgsScaling_</a>, &amp;epetraScaledNominalValues
<a name="l01249"></a>01249       );
<a name="l01250"></a>01250 
<a name="l01251"></a>01251     EME::InArgs epetraScaledLowerBounds = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createInArgs();
<a name="l01252"></a>01252     EME::InArgs epetraScaledUpperBounds = <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;createInArgs();
<a name="l01253"></a>01253     EpetraExt::scaleModelBounds(
<a name="l01254"></a>01254       epetraOrigLowerBounds, epetraOrigUpperBounds, <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>-&gt;getInfBound(),
<a name="l01255"></a>01255       <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a080091e2ec065680ccb17fc9f43ff49f">epetraInArgsScaling_</a>,
<a name="l01256"></a>01256       &amp;epetraScaledLowerBounds, &amp;epetraScaledUpperBounds
<a name="l01257"></a>01257       );
<a name="l01258"></a>01258 
<a name="l01259"></a>01259     <span class="comment">// Wrap the scaled epetra InArgs objects as Thyra InArgs objects!</span>
<a name="l01260"></a>01260 
<a name="l01261"></a>01261     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aa84ba7b31d3dc627575b24b0a56363c8">nominalValues_</a> = this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a00eea19814731baf3a2bb57146648a4f" title=".">createInArgs</a>();
<a name="l01262"></a>01262     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a84c801426edd49ef03def88ab22e7e27">lowerBounds_</a> = this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a00eea19814731baf3a2bb57146648a4f" title=".">createInArgs</a>();
<a name="l01263"></a>01263     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a0b253569b86d01a2577eb3a86bc63243">upperBounds_</a> = this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a00eea19814731baf3a2bb57146648a4f" title=".">createInArgs</a>();
<a name="l01264"></a>01264     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae43eab0dfa783b6c094405477ce29062" title=".">convertInArgsFromEpetraToThyra</a>(epetraScaledNominalValues, &amp;nominalValues_);
<a name="l01265"></a>01265     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae43eab0dfa783b6c094405477ce29062" title=".">convertInArgsFromEpetraToThyra</a>(epetraScaledLowerBounds, &amp;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a84c801426edd49ef03def88ab22e7e27">lowerBounds_</a>);
<a name="l01266"></a>01266     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae43eab0dfa783b6c094405477ce29062" title=".">convertInArgsFromEpetraToThyra</a>(epetraScaledUpperBounds, &amp;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a0b253569b86d01a2577eb3a86bc63243">upperBounds_</a>);
<a name="l01267"></a>01267 
<a name="l01268"></a>01268     <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a92ca4d2be3d32458f95294e589b3099d">nominalValuesAndBoundsAreUpdated_</a> = <span class="keyword">true</span>;
<a name="l01269"></a>01269 
<a name="l01270"></a>01270   }
<a name="l01271"></a>01271   <span class="keywordflow">else</span> {
<a name="l01272"></a>01272 
<a name="l01273"></a>01273     <span class="comment">// The nominal values and bounds should already be updated an should have</span>
<a name="l01274"></a>01274     <span class="comment">// the currect scaling!</span>
<a name="l01275"></a>01275 
<a name="l01276"></a>01276   }
<a name="l01277"></a>01277 
<a name="l01278"></a>01278 }
<a name="l01279"></a>01279 
<a name="l01280"></a>01280 
<a name="l01281"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae2dea303b6d4bed722611fb8ecea429a">01281</a> <span class="keywordtype">void</span> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae2dea303b6d4bed722611fb8ecea429a" title=".">ThyraAdaptiveModelEvaluator::updateInArgsOutArgs</a>()<span class="keyword"> const</span>
<a name="l01282"></a>01282 <span class="keyword"></span>{
<a name="l01283"></a>01283 
<a name="l01284"></a>01284   <span class="keyword">typedef</span> EpetraExt::ModelEvaluator EME;
<a name="l01285"></a>01285 
<a name="l01286"></a>01286   <span class="keyword">const</span> EpetraExt::ModelEvaluator &amp;epetraModel = *<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>;
<a name="l01287"></a>01287   EME::InArgs  epetraInArgs  = epetraModel.createInArgs();
<a name="l01288"></a>01288   EME::OutArgs epetraOutArgs = epetraModel.createOutArgs();
<a name="l01289"></a>01289   <span class="keyword">const</span> <span class="keywordtype">int</span> l_Np = epetraOutArgs.Np();
<a name="l01290"></a>01290   <span class="keyword">const</span> <span class="keywordtype">int</span> l_Ng = epetraOutArgs.Ng();
<a name="l01291"></a>01291 
<a name="l01292"></a>01292   <span class="comment">//</span>
<a name="l01293"></a>01293   <span class="comment">// InArgs</span>
<a name="l01294"></a>01294   <span class="comment">//</span>
<a name="l01295"></a>01295 
<a name="l01296"></a>01296   InArgsSetup&lt;double&gt; inArgs;
<a name="l01297"></a>01297   inArgs.setModelEvalDescription(this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a065bb5db0a4b6c55875adc90978707f2" title=".">description</a>());
<a name="l01298"></a>01298   inArgs.set_Np(epetraInArgs.Np());
<a name="l01299"></a>01299   inArgs.setSupports(IN_ARG_x_dot, epetraInArgs.supports(EME::IN_ARG_x_dot));
<a name="l01300"></a>01300   inArgs.setSupports(IN_ARG_x, epetraInArgs.supports(EME::IN_ARG_x));
<a name="l01301"></a>01301 <span class="preprocessor">#ifdef HAVE_THYRA_ME_POLYNOMIAL</span>
<a name="l01302"></a>01302 <span class="preprocessor"></span>  inArgs.setSupports(IN_ARG_x_dot_poly,
<a name="l01303"></a>01303     epetraInArgs.supports(EME::IN_ARG_x_dot_poly));
<a name="l01304"></a>01304   inArgs.setSupports(IN_ARG_x_poly, epetraInArgs.supports(EME::IN_ARG_x_poly));
<a name="l01305"></a>01305 <span class="preprocessor">#endif // HAVE_THYRA_ME_POLYNOMIAL</span>
<a name="l01306"></a>01306 <span class="preprocessor"></span>  inArgs.setSupports(IN_ARG_t, epetraInArgs.supports(EME::IN_ARG_t));
<a name="l01307"></a>01307   inArgs.setSupports(IN_ARG_alpha, epetraInArgs.supports(EME::IN_ARG_alpha));
<a name="l01308"></a>01308   inArgs.setSupports(IN_ARG_beta, epetraInArgs.supports(EME::IN_ARG_beta));
<a name="l01309"></a>01309   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#aa529477680405fcc78073c917f06ab01">prototypeInArgs_</a> = inArgs;
<a name="l01310"></a>01310 
<a name="l01311"></a>01311   <span class="comment">//</span>
<a name="l01312"></a>01312   <span class="comment">// OutArgs</span>
<a name="l01313"></a>01313   <span class="comment">//</span>
<a name="l01314"></a>01314 
<a name="l01315"></a>01315   OutArgsSetup&lt;double&gt; outArgs;
<a name="l01316"></a>01316   outArgs.setModelEvalDescription(this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a065bb5db0a4b6c55875adc90978707f2" title=".">description</a>());
<a name="l01317"></a>01317   outArgs.set_Np_Ng(l_Np, l_Ng);
<a name="l01318"></a>01318   <span class="comment">// f</span>
<a name="l01319"></a>01319   outArgs.setSupports(OUT_ARG_f, epetraOutArgs.supports(EME::OUT_ARG_f));
<a name="l01320"></a>01320   <span class="keywordflow">if</span> (outArgs.supports(OUT_ARG_f)) {
<a name="l01321"></a>01321     <span class="comment">// W_op</span>
<a name="l01322"></a>01322     outArgs.setSupports(OUT_ARG_W_op,  epetraOutArgs.supports(EME::OUT_ARG_W));
<a name="l01323"></a>01323     outArgs.set_W_properties(convert(epetraOutArgs.get_W_properties()));
<a name="l01324"></a>01324     <span class="comment">// DfDp</span>
<a name="l01325"></a>01325     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0; l&lt;l_Np; ++l) {
<a name="l01326"></a>01326       outArgs.setSupports(OUT_ARG_DfDp, l,
<a name="l01327"></a>01327         convert(epetraOutArgs.supports(EME::OUT_ARG_DfDp, l)));
<a name="l01328"></a>01328       <span class="keywordflow">if</span>(!outArgs.supports(OUT_ARG_DfDp, l).none())
<a name="l01329"></a>01329         outArgs.set_DfDp_properties(l,
<a name="l01330"></a>01330           convert(epetraOutArgs.get_DfDp_properties(l)));
<a name="l01331"></a>01331     }
<a name="l01332"></a>01332   }
<a name="l01333"></a>01333   <span class="comment">// DgDx_dot and DgDx</span>
<a name="l01334"></a>01334   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;l_Ng; ++j) {
<a name="l01335"></a>01335     <span class="keywordflow">if</span> (inArgs.supports(IN_ARG_x_dot))
<a name="l01336"></a>01336       outArgs.setSupports(OUT_ARG_DgDx_dot, j,
<a name="l01337"></a>01337         convert(epetraOutArgs.supports(EME::OUT_ARG_DgDx_dot, j)));
<a name="l01338"></a>01338     <span class="keywordflow">if</span>(!outArgs.supports(OUT_ARG_DgDx_dot, j).none())
<a name="l01339"></a>01339       outArgs.set_DgDx_dot_properties(j,
<a name="l01340"></a>01340         convert(epetraOutArgs.get_DgDx_dot_properties(j)));
<a name="l01341"></a>01341     <span class="keywordflow">if</span> (inArgs.supports(IN_ARG_x))
<a name="l01342"></a>01342       outArgs.setSupports(OUT_ARG_DgDx, j,
<a name="l01343"></a>01343         convert(epetraOutArgs.supports(EME::OUT_ARG_DgDx, j)));
<a name="l01344"></a>01344     <span class="keywordflow">if</span>(!outArgs.supports(OUT_ARG_DgDx, j).none())
<a name="l01345"></a>01345       outArgs.set_DgDx_properties(j,
<a name="l01346"></a>01346         convert(epetraOutArgs.get_DgDx_properties(j)));
<a name="l01347"></a>01347   }
<a name="l01348"></a>01348   <span class="comment">// DgDp</span>
<a name="l01349"></a>01349   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j &lt; l_Ng; ++j) <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0; l &lt; l_Np; ++l) {
<a name="l01350"></a>01350     <span class="keyword">const</span> EME::DerivativeSupport epetra_DgDp_j_l_support =
<a name="l01351"></a>01351       epetraOutArgs.supports(EME::OUT_ARG_DgDp, j, l);
<a name="l01352"></a>01352     outArgs.setSupports(OUT_ARG_DgDp, j, l,
<a name="l01353"></a>01353       convert(epetra_DgDp_j_l_support));
<a name="l01354"></a>01354     <span class="keywordflow">if</span>(!outArgs.supports(OUT_ARG_DgDp, j, l).none())
<a name="l01355"></a>01355       outArgs.set_DgDp_properties(j, l,
<a name="l01356"></a>01356         convert(epetraOutArgs.get_DgDp_properties(j, l)));
<a name="l01357"></a>01357   }
<a name="l01358"></a>01358 <span class="preprocessor">#ifdef HAVE_THYRA_ME_POLYNOMIAL</span>
<a name="l01359"></a>01359 <span class="preprocessor"></span>  outArgs.setSupports(OUT_ARG_f_poly,
<a name="l01360"></a>01360     epetraOutArgs.supports(EME::OUT_ARG_f_poly));
<a name="l01361"></a>01361 <span class="preprocessor">#endif // HAVE_THYRA_ME_POLYNOMIAL</span>
<a name="l01362"></a>01362 <span class="preprocessor"></span>  <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a16fa52e85181e6d8bd3efea219386cc9">prototypeOutArgs_</a> = outArgs;
<a name="l01363"></a>01363 
<a name="l01364"></a>01364   <span class="comment">// We are current!</span>
<a name="l01365"></a>01365   <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a62ce7144f04d83758930bfc1455e8904">currentInArgsOutArgs_</a> = <span class="keyword">true</span>;
<a name="l01366"></a>01366 
<a name="l01367"></a>01367 }
<a name="l01368"></a>01368 
<a name="l01369"></a>01369 
<a name="l01370"></a>01370 RCP&lt;EpetraLinearOp&gt;
<a name="l01371"></a><a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ada910df3336884ea15fe24a578579f19">01371</a> <a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ada910df3336884ea15fe24a578579f19" title=".">ThyraAdaptiveModelEvaluator::create_epetra_W_op</a>()<span class="keyword"> const</span>
<a name="l01372"></a>01372 <span class="keyword"></span>{
<a name="l01373"></a>01373   <span class="keywordflow">return</span> Thyra::partialNonconstEpetraLinearOp(
<a name="l01374"></a>01374     this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ae6cdbfb2def570563b2a21922a77431a" title=".">get_f_space</a>(), this-&gt;<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#a0792123894ab0e35f07da80cf56c65c2" title=".">get_x_space</a>(),
<a name="l01375"></a>01375     create_and_assert_W(*<a class="code" href="classAAdapt_1_1ThyraAdaptiveModelEvaluator.html#ab4af4c8cd62d19afab66f737aa37a50d">epetraModel_</a>)
<a name="l01376"></a>01376     );
<a name="l01377"></a>01377 }
<a name="l01378"></a>01378 
<a name="l01379"></a>01379 
<a name="l01380"></a>01380 } <span class="comment">// namespace AAdapt</span>
<a name="l01381"></a>01381 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Mar 26 2014 18:36:35 for Albany: a Trilinos-based PDE code by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
