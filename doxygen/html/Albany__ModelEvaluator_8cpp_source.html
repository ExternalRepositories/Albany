<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Albany: a Trilinos-based PDE code: Albany_ModelEvaluator.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>Albany_ModelEvaluator.cpp</h1>  </div>
</div>
<div class="contents">
<a href="Albany__ModelEvaluator_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//*****************************************************************//</span>
<a name="l00002"></a>00002 <span class="comment">//    Albany 2.0:  Copyright 2012 Sandia Corporation               //</span>
<a name="l00003"></a>00003 <span class="comment">//    This Software is released under the BSD license detailed     //</span>
<a name="l00004"></a>00004 <span class="comment">//    in the file &quot;license.txt&quot; in the top-level Albany directory  //</span>
<a name="l00005"></a>00005 <span class="comment">//*****************************************************************//</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="Albany__ModelEvaluator_8hpp.html">Albany_ModelEvaluator.hpp</a>&quot;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;Teuchos_ScalarTraits.hpp&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;Teuchos_TestForException.hpp&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;Stokhos_EpetraVectorOrthogPoly.hpp&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;Stokhos_EpetraMultiVectorOrthogPoly.hpp&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;Stokhos_EpetraOperatorOrthogPoly.hpp&quot;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#ad9fadcd07613199e2d2b430649c6b40e">00014</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#ad9fadcd07613199e2d2b430649c6b40e">Albany::ModelEvaluator::ModelEvaluator</a>(
<a name="l00015"></a>00015   <span class="keyword">const</span> Teuchos::RCP&lt;Albany::Application&gt;&amp; app_,
<a name="l00016"></a>00016   <span class="keyword">const</span> Teuchos::RCP&lt;Teuchos::ParameterList&gt;&amp; <a class="code" href="felix__driver_8cpp.html#ac72c72afb7da5a0adcf02a0e202b4d92">appParams</a>) 
<a name="l00017"></a>00017   : <a class="code" href="InterfaceTry_8cpp.html#a5687d6d7d8e1356f9cbed0616b9e7cec">app</a>(app_),
<a name="l00018"></a>00018     supplies_prec(app_-&gt;suppliesPreconditioner())
<a name="l00019"></a>00019 {
<a name="l00020"></a>00020   Teuchos::RCP&lt;Teuchos::FancyOStream&gt; out = 
<a name="l00021"></a>00021     Teuchos::VerboseObjectBase::getDefaultOStream();
<a name="l00022"></a>00022 
<a name="l00023"></a>00023   <span class="comment">// Parameters (e.g., for sensitivities, SG expansions, ...)</span>
<a name="l00024"></a>00024   Teuchos::ParameterList&amp; problemParams = appParams-&gt;sublist(<span class="stringliteral">&quot;Problem&quot;</span>);
<a name="l00025"></a>00025   Teuchos::ParameterList&amp; parameterParams = 
<a name="l00026"></a>00026     problemParams.sublist(<span class="stringliteral">&quot;Parameters&quot;</span>);
<a name="l00027"></a>00027   <span class="keywordtype">int</span> num_param_vecs = 
<a name="l00028"></a>00028     parameterParams.get(<span class="stringliteral">&quot;Number of Parameter Vectors&quot;</span>, 0);
<a name="l00029"></a>00029   <span class="keywordtype">bool</span> using_old_parameter_list = <span class="keyword">false</span>;
<a name="l00030"></a>00030   <span class="keywordflow">if</span> (parameterParams.isType&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;Number&quot;</span>)) {
<a name="l00031"></a>00031     <span class="keywordtype">int</span> numParameters = parameterParams.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;Number&quot;</span>);
<a name="l00032"></a>00032     <span class="keywordflow">if</span> (numParameters &gt; 0) {
<a name="l00033"></a>00033       num_param_vecs = 1;
<a name="l00034"></a>00034       using_old_parameter_list = <span class="keyword">true</span>;
<a name="l00035"></a>00035     }
<a name="l00036"></a>00036   }
<a name="l00037"></a>00037   <a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.resize(num_param_vecs);
<a name="l00038"></a>00038   *out &lt;&lt; <span class="stringliteral">&quot;Number of parameters vectors  = &quot;</span> &lt;&lt; num_param_vecs &lt;&lt; std::endl;
<a name="l00039"></a>00039   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;num_param_vecs; i++) {
<a name="l00040"></a>00040     Teuchos::ParameterList* pList;
<a name="l00041"></a>00041     <span class="keywordflow">if</span> (using_old_parameter_list)
<a name="l00042"></a>00042       pList = &amp;parameterParams;
<a name="l00043"></a>00043     <span class="keywordflow">else</span>
<a name="l00044"></a>00044       pList = &amp;(parameterParams.sublist(<a class="code" href="namespaceAlbany.html#a0825dc2de792b06ebb1ded9784d6a111" title="Utility to make a string out of a string + int: strint(&amp;quot;dog&amp;quot;,2) = &amp;quot;dog 2&amp;quot;...">Albany::strint</a>(<span class="stringliteral">&quot;Parameter Vector&quot;</span>,i)));
<a name="l00045"></a>00045     <span class="keywordtype">int</span> numParameters = pList-&gt;get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;Number&quot;</span>);
<a name="l00046"></a>00046     TEUCHOS_TEST_FOR_EXCEPTION(
<a name="l00047"></a>00047       numParameters == 0, 
<a name="l00048"></a>00048       Teuchos::Exceptions::InvalidParameter,
<a name="l00049"></a>00049       std::endl &lt;&lt; <span class="stringliteral">&quot;Error!  In Albany::ModelEvaluator constructor:  &quot;</span> &lt;&lt;
<a name="l00050"></a>00050       <span class="stringliteral">&quot;Parameter vector &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; has zero parameters!&quot;</span> &lt;&lt; std::endl);
<a name="l00051"></a>00051     <a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>[i] = 
<a name="l00052"></a>00052       Teuchos::rcp(<span class="keyword">new</span> Teuchos::Array&lt;std::string&gt;(numParameters));
<a name="l00053"></a>00053     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;numParameters; j++) {
<a name="l00054"></a>00054       (*<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>[i])[j] = 
<a name="l00055"></a>00055   pList-&gt;get&lt;std::string&gt;(<a class="code" href="namespaceAlbany.html#a0825dc2de792b06ebb1ded9784d6a111" title="Utility to make a string out of a string + int: strint(&amp;quot;dog&amp;quot;,2) = &amp;quot;dog 2&amp;quot;...">Albany::strint</a>(<span class="stringliteral">&quot;Parameter&quot;</span>,j));
<a name="l00056"></a>00056     }
<a name="l00057"></a>00057     *out &lt;&lt; <span class="stringliteral">&quot;Number of parameters in parameter vector &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> 
<a name="l00058"></a>00058    &lt;&lt; numParameters &lt;&lt; std::endl;
<a name="l00059"></a>00059   }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   <span class="comment">// Setup sacado and epetra storage for parameters  </span>
<a name="l00062"></a>00062   <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>.resize(num_param_vecs);
<a name="l00063"></a>00063   <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab89f342be68c102b581f5c9f8f6f6e50" title="Epetra map for parameter vector.">epetra_param_map</a>.resize(num_param_vecs);
<a name="l00064"></a>00064   <a class="code" href="classAlbany_1_1ModelEvaluator.html#a1b9b09d16c3e65e149b9d92619ebcc48" title="Epetra parameter vector.">epetra_param_vec</a>.resize(num_param_vecs);
<a name="l00065"></a>00065   <a class="code" href="classAlbany_1_1ModelEvaluator.html#a7790ce8e97577962430f207735f66f19" title="Stochastic Galerkin parameters.">p_sg_vals</a>.resize(num_param_vecs);
<a name="l00066"></a>00066   <a class="code" href="classAlbany_1_1ModelEvaluator.html#ababf8e2481c37d6f11547aca400e0198" title="Multi-point parameters.">p_mp_vals</a>.resize(num_param_vecs);
<a name="l00067"></a>00067   <span class="keyword">const</span> Epetra_Comm&amp; <a class="code" href="felix__driver_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a> = <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getMap()-&gt;Comm();
<a name="l00068"></a>00068   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;num_param_vecs; i++) {
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <span class="comment">// Initialize Sacado parameter vector</span>
<a name="l00071"></a>00071     <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getParamLib()-&gt;fillVector&lt;<a class="code" href="structPHAL_1_1AlbanyTraits_1_1Residual.html">PHAL::AlbanyTraits::Residual</a>&gt;(
<a name="l00072"></a>00072       *(<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>[i]), <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i]);
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     <span class="comment">// Create Epetra map for parameter vector</span>
<a name="l00075"></a>00075     <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab89f342be68c102b581f5c9f8f6f6e50" title="Epetra map for parameter vector.">epetra_param_map</a>[i] = 
<a name="l00076"></a>00076       Teuchos::rcp(<span class="keyword">new</span> Epetra_LocalMap((<span class="keywordtype">int</span>) <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i].size(), 0, comm));
<a name="l00077"></a>00077 
<a name="l00078"></a>00078     <span class="comment">// Create Epetra vector for parameters</span>
<a name="l00079"></a>00079     <a class="code" href="classAlbany_1_1ModelEvaluator.html#a1b9b09d16c3e65e149b9d92619ebcc48" title="Epetra parameter vector.">epetra_param_vec</a>[i] = 
<a name="l00080"></a>00080       Teuchos::rcp(<span class="keyword">new</span> Epetra_Vector(*(<a class="code" href="classAlbany_1_1ModelEvaluator.html#ab89f342be68c102b581f5c9f8f6f6e50" title="Epetra map for parameter vector.">epetra_param_map</a>[i])));
<a name="l00081"></a>00081     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i].size(); j++)
<a name="l00082"></a>00082       (*(<a class="code" href="classAlbany_1_1ModelEvaluator.html#a1b9b09d16c3e65e149b9d92619ebcc48" title="Epetra parameter vector.">epetra_param_vec</a>[i]))[j] = <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i][j].baseValue;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <a class="code" href="classAlbany_1_1ModelEvaluator.html#a7790ce8e97577962430f207735f66f19" title="Stochastic Galerkin parameters.">p_sg_vals</a>[i].resize(<a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i].size());
<a name="l00085"></a>00085     <a class="code" href="classAlbany_1_1ModelEvaluator.html#ababf8e2481c37d6f11547aca400e0198" title="Multi-point parameters.">p_mp_vals</a>[i].resize(<a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i].size());
<a name="l00086"></a>00086   }  
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   <a class="code" href="classAlbany_1_1ModelEvaluator.html#a889d032869133fa501f25a74c53da19b">timer</a> = Teuchos::TimeMonitor::getNewTimer(<span class="stringliteral">&quot;Albany: **Total Fill Time**&quot;</span>);
<a name="l00089"></a>00089 }
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#a5e8068238999679ad828d26d895a992a">00091</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#a5e8068238999679ad828d26d895a992a">Albany::ModelEvaluator::~ModelEvaluator</a>(){
<a name="l00092"></a>00092 <span class="preprocessor">#ifdef ALBANY_DEBUG</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span>  std::cout &lt;&lt; <span class="stringliteral">&quot;Calling destructor for Albany_ModelEvaluator&quot;</span> &lt;&lt; std::endl;
<a name="l00094"></a>00094 <span class="preprocessor">#endif</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span>}
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="comment">// Overridden from EpetraExt::ModelEvaluator</span>
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 Teuchos::RCP&lt;const Epetra_Map&gt;
<a name="l00100"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#a651ab6c434337fee246484cf98632fe4">00100</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#a651ab6c434337fee246484cf98632fe4" title="Return solution vector map.">Albany::ModelEvaluator::get_x_map</a>()<span class="keyword"> const</span>
<a name="l00101"></a>00101 <span class="keyword"></span>{
<a name="l00102"></a>00102   <span class="keywordflow">return</span> <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getMap();
<a name="l00103"></a>00103 }
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 Teuchos::RCP&lt;const Epetra_Map&gt;
<a name="l00106"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#a9e749d7698b27d75363eabbbfc3709d0">00106</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#a9e749d7698b27d75363eabbbfc3709d0" title="Return residual vector map.">Albany::ModelEvaluator::get_f_map</a>()<span class="keyword"> const</span>
<a name="l00107"></a>00107 <span class="keyword"></span>{
<a name="l00108"></a>00108   <span class="keywordflow">return</span> <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getMap();
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 Teuchos::RCP&lt;const Epetra_Map&gt;
<a name="l00112"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#a79b7e71401b60a288561d5d4f7af7e6e">00112</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#a79b7e71401b60a288561d5d4f7af7e6e" title="Return parameter vector map.">Albany::ModelEvaluator::get_p_map</a>(<span class="keywordtype">int</span> l)<span class="keyword"> const</span>
<a name="l00113"></a>00113 <span class="keyword"></span>{
<a name="l00114"></a>00114   TEUCHOS_TEST_FOR_EXCEPTION(
<a name="l00115"></a>00115     l &gt;= static_cast&lt;int&gt;(<a class="code" href="classAlbany_1_1ModelEvaluator.html#ab89f342be68c102b581f5c9f8f6f6e50" title="Epetra map for parameter vector.">epetra_param_map</a>.size()) || l &lt; 0, 
<a name="l00116"></a>00116     Teuchos::Exceptions::InvalidParameter,
<a name="l00117"></a>00117     std::endl &lt;&lt; 
<a name="l00118"></a>00118     <span class="stringliteral">&quot;Error!  Albany::ModelEvaluator::get_p_map():  &quot;</span> &lt;&lt;
<a name="l00119"></a>00119     <span class="stringliteral">&quot;Invalid parameter index l = &quot;</span> &lt;&lt; l &lt;&lt; std::endl);
<a name="l00120"></a>00120 
<a name="l00121"></a>00121   <span class="keywordflow">return</span> <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab89f342be68c102b581f5c9f8f6f6e50" title="Epetra map for parameter vector.">epetra_param_map</a>[l];
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 Teuchos::RCP&lt;const Epetra_Map&gt;
<a name="l00125"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#a589ece3017d89ca1305b91d243984bc7">00125</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#a589ece3017d89ca1305b91d243984bc7" title="Return response function map.">Albany::ModelEvaluator::get_g_map</a>(<span class="keywordtype">int</span> l)<span class="keyword"> const</span>
<a name="l00126"></a>00126 <span class="keyword"></span>{
<a name="l00127"></a>00127   TEUCHOS_TEST_FOR_EXCEPTION(
<a name="l00128"></a>00128     l &gt;= <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getNumResponses() || l &lt; 0, 
<a name="l00129"></a>00129     Teuchos::Exceptions::InvalidParameter,
<a name="l00130"></a>00130     std::endl &lt;&lt; 
<a name="l00131"></a>00131     <span class="stringliteral">&quot;Error!  Albany::ModelEvaluator::get_g_map():  &quot;</span> &lt;&lt; 
<a name="l00132"></a>00132     <span class="stringliteral">&quot;Invalid response index l = &quot;</span> &lt;&lt; l &lt;&lt; std::endl);
<a name="l00133"></a>00133 
<a name="l00134"></a>00134   <span class="keywordflow">return</span> <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getResponse(l)-&gt;responseMap();
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 Teuchos::RCP&lt;const Teuchos::Array&lt;std::string&gt; &gt;
<a name="l00138"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#a53382608bc60bd9958203ef5bb3e450e">00138</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#a53382608bc60bd9958203ef5bb3e450e" title="Return array of parameter names.">Albany::ModelEvaluator::get_p_names</a>(<span class="keywordtype">int</span> l)<span class="keyword"> const</span>
<a name="l00139"></a>00139 <span class="keyword"></span>{
<a name="l00140"></a>00140   TEUCHOS_TEST_FOR_EXCEPTION(l &gt;= static_cast&lt;int&gt;(<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.size()) || l &lt; 0, 
<a name="l00141"></a>00141          Teuchos::Exceptions::InvalidParameter,
<a name="l00142"></a>00142                      std::endl &lt;&lt; 
<a name="l00143"></a>00143                      <span class="stringliteral">&quot;Error!  Albany::ModelEvaluator::get_p_names():  &quot;</span> &lt;&lt;
<a name="l00144"></a>00144                      <span class="stringliteral">&quot;Invalid parameter index l = &quot;</span> &lt;&lt; l &lt;&lt; std::endl);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146   <span class="keywordflow">return</span> <a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>[l];
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 Teuchos::RCP&lt;const Epetra_Vector&gt;
<a name="l00150"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#aa96aa53f11be120a0e248630f37e1b80">00150</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#aa96aa53f11be120a0e248630f37e1b80" title="Return initial solution and x_dot init.">Albany::ModelEvaluator::get_x_init</a>()<span class="keyword"> const</span>
<a name="l00151"></a>00151 <span class="keyword"></span>{
<a name="l00152"></a>00152   <span class="keywordflow">return</span> <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getAdaptSolMgr()-&gt;getInitialSolution();
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 Teuchos::RCP&lt;const Epetra_Vector&gt;
<a name="l00156"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#acd5f5151cdade17d89350444b50b92f8">00156</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#acd5f5151cdade17d89350444b50b92f8">Albany::ModelEvaluator::get_x_dot_init</a>()<span class="keyword"> const</span>
<a name="l00157"></a>00157 <span class="keyword"></span>{
<a name="l00158"></a>00158   <span class="keywordflow">return</span> <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getAdaptSolMgr()-&gt;getInitialSolutionDot();
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 Teuchos::RCP&lt;const Epetra_Vector&gt;
<a name="l00162"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#af13ca7badb37e9e33e3e1c2fc77e2095">00162</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#af13ca7badb37e9e33e3e1c2fc77e2095">Albany::ModelEvaluator::get_x_dotdot_init</a>()<span class="keyword"> const</span>
<a name="l00163"></a>00163 <span class="keyword"></span>{
<a name="l00164"></a>00164   Teuchos::RCP&lt;const Epetra_Vector&gt; x_dotdot_init
<a name="l00165"></a>00165     = Teuchos::rcp(<span class="keyword">new</span> Epetra_Vector(<a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getAdaptSolMgr()-&gt;getInitialSolutionDot()-&gt;Map()));
<a name="l00166"></a>00166   
<a name="l00167"></a>00167   <span class="keywordflow">return</span> x_dotdot_init;
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 Teuchos::RCP&lt;const Epetra_Vector&gt;
<a name="l00171"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#ae4c394e07a84832f9d9ed378b67b51b2">00171</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#ae4c394e07a84832f9d9ed378b67b51b2" title="Return initial parameters.">Albany::ModelEvaluator::get_p_init</a>(<span class="keywordtype">int</span> l)<span class="keyword"> const</span>
<a name="l00172"></a>00172 <span class="keyword"></span>{
<a name="l00173"></a>00173   TEUCHOS_TEST_FOR_EXCEPTION(l &gt;= static_cast&lt;int&gt;(<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.size()) || l &lt; 0, 
<a name="l00174"></a>00174          Teuchos::Exceptions::InvalidParameter,
<a name="l00175"></a>00175                      std::endl &lt;&lt; 
<a name="l00176"></a>00176                      <span class="stringliteral">&quot;Error!  Albany::ModelEvaluator::get_p_init():  &quot;</span> &lt;&lt;
<a name="l00177"></a>00177                      <span class="stringliteral">&quot;Invalid parameter index l = &quot;</span> &lt;&lt; l &lt;&lt; std::endl);
<a name="l00178"></a>00178   
<a name="l00179"></a>00179   <span class="keywordflow">return</span> <a class="code" href="classAlbany_1_1ModelEvaluator.html#a1b9b09d16c3e65e149b9d92619ebcc48" title="Epetra parameter vector.">epetra_param_vec</a>[l];
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 Teuchos::RCP&lt;Epetra_Operator&gt;
<a name="l00183"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#a66dd37d63d63f7b565c9724d120fe66b">00183</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#a66dd37d63d63f7b565c9724d120fe66b" title="Create W = alpha*M + beta*J + omega*N matrix.">Albany::ModelEvaluator::create_W</a>()<span class="keyword"> const</span>
<a name="l00184"></a>00184 <span class="keyword"></span>{
<a name="l00185"></a>00185   <span class="keywordflow">return</span> 
<a name="l00186"></a>00186     Teuchos::rcp(<span class="keyword">new</span> Epetra_CrsMatrix(::Copy, *(<a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getJacobianGraph())));
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 Teuchos::RCP&lt;EpetraExt::ModelEvaluator::Preconditioner&gt;
<a name="l00190"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#af2c67ea7eb5ea9fb1640c4c6017b6e92">00190</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#af2c67ea7eb5ea9fb1640c4c6017b6e92" title="Create preconditioner operator.">Albany::ModelEvaluator::create_WPrec</a>()<span class="keyword"> const</span>
<a name="l00191"></a>00191 <span class="keyword"></span>{
<a name="l00192"></a>00192   Teuchos::RCP&lt;Epetra_Operator&gt; precOp = <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getPreconditioner();
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   <span class="comment">// Teko prec needs space for Jacobian as well</span>
<a name="l00195"></a>00195   <a class="code" href="classAlbany_1_1ModelEvaluator.html#a73eb24d5dfa7067cd93a97c7ef781aab" title="Allocated Jacobian for sending to user preconditioner.">Extra_W_crs</a> = Teuchos::rcp_dynamic_cast&lt;Epetra_CrsMatrix&gt;(<a class="code" href="classAlbany_1_1ModelEvaluator.html#a66dd37d63d63f7b565c9724d120fe66b" title="Create W = alpha*M + beta*J + omega*N matrix.">create_W</a>(), <span class="keyword">true</span>);
<a name="l00196"></a>00196 
<a name="l00197"></a>00197   <span class="comment">// bool is answer to: &quot;Prec is already inverted?&quot;</span>
<a name="l00198"></a>00198   <span class="keywordflow">return</span> Teuchos::rcp(<span class="keyword">new</span> EpetraExt::ModelEvaluator::Preconditioner(precOp,<span class="keyword">true</span>));
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 Teuchos::RCP&lt;Epetra_Operator&gt;
<a name="l00202"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#a46eb76890088e5c77e738dc899d601f7">00202</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#a46eb76890088e5c77e738dc899d601f7" title="Create operator form of dg/dx for distributed responses.">Albany::ModelEvaluator::create_DgDx_op</a>(<span class="keywordtype">int</span> j)<span class="keyword"> const</span>
<a name="l00203"></a>00203 <span class="keyword"></span>{
<a name="l00204"></a>00204   TEUCHOS_TEST_FOR_EXCEPTION(
<a name="l00205"></a>00205     j &gt;= <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getNumResponses() || j &lt; 0, 
<a name="l00206"></a>00206     Teuchos::Exceptions::InvalidParameter,
<a name="l00207"></a>00207     std::endl &lt;&lt; 
<a name="l00208"></a>00208     <span class="stringliteral">&quot;Error!  Albany::ModelEvaluator::create_DgDx_op():  &quot;</span> &lt;&lt; 
<a name="l00209"></a>00209     <span class="stringliteral">&quot;Invalid response index j = &quot;</span> &lt;&lt; j &lt;&lt; std::endl);
<a name="l00210"></a>00210   
<a name="l00211"></a>00211   <span class="keywordflow">return</span> <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getResponse(j)-&gt;createGradientOp();
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 Teuchos::RCP&lt;Epetra_Operator&gt;
<a name="l00215"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#a4324f2741c106054e0a9867d9f1b6866">00215</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#a4324f2741c106054e0a9867d9f1b6866" title="Create operator form of dg/dx_dot for distributed responses.">Albany::ModelEvaluator::create_DgDx_dot_op</a>(<span class="keywordtype">int</span> j)<span class="keyword"> const</span>
<a name="l00216"></a>00216 <span class="keyword"></span>{
<a name="l00217"></a>00217   TEUCHOS_TEST_FOR_EXCEPTION(
<a name="l00218"></a>00218     j &gt;= <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getNumResponses() || j &lt; 0, 
<a name="l00219"></a>00219     Teuchos::Exceptions::InvalidParameter,
<a name="l00220"></a>00220     std::endl &lt;&lt; 
<a name="l00221"></a>00221     <span class="stringliteral">&quot;Error!  Albany::ModelEvaluator::create_DgDx_dot_op():  &quot;</span> &lt;&lt; 
<a name="l00222"></a>00222     <span class="stringliteral">&quot;Invalid response index j = &quot;</span> &lt;&lt; j &lt;&lt; std::endl);
<a name="l00223"></a>00223   
<a name="l00224"></a>00224   <span class="keywordflow">return</span> <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getResponse(j)-&gt;createGradientOp();
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 Teuchos::RCP&lt;Epetra_Operator&gt;
<a name="l00228"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#abf39492ba87006e0e0603d3e01ed7aa9">00228</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#abf39492ba87006e0e0603d3e01ed7aa9">Albany::ModelEvaluator::create_DgDx_dotdot_op</a>(<span class="keywordtype">int</span> j)<span class="keyword"> const</span>
<a name="l00229"></a>00229 <span class="keyword"></span>{
<a name="l00230"></a>00230   TEUCHOS_TEST_FOR_EXCEPTION(
<a name="l00231"></a>00231     j &gt;= <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getNumResponses() || j &lt; 0, 
<a name="l00232"></a>00232     Teuchos::Exceptions::InvalidParameter,
<a name="l00233"></a>00233     std::endl &lt;&lt; 
<a name="l00234"></a>00234     <span class="stringliteral">&quot;Error!  Albany::ModelEvaluator::create_DgDx_dotdot_op():  &quot;</span> &lt;&lt; 
<a name="l00235"></a>00235     <span class="stringliteral">&quot;Invalid response index j = &quot;</span> &lt;&lt; j &lt;&lt; std::endl);
<a name="l00236"></a>00236   
<a name="l00237"></a>00237   <span class="keywordflow">return</span> <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getResponse(j)-&gt;createGradientOp();
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 EpetraExt::ModelEvaluator::InArgs
<a name="l00241"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#aeafbf3fe89ec59d1410ec3e508aca528">00241</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#aeafbf3fe89ec59d1410ec3e508aca528" title="Create InArgs.">Albany::ModelEvaluator::createInArgs</a>()<span class="keyword"> const</span>
<a name="l00242"></a>00242 <span class="keyword"></span>{
<a name="l00243"></a>00243   InArgsSetup inArgs;
<a name="l00244"></a>00244   inArgs.setModelEvalDescription(this-&gt;description());
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   inArgs.setSupports(IN_ARG_t,<span class="keyword">true</span>);
<a name="l00247"></a>00247   inArgs.setSupports(IN_ARG_x,<span class="keyword">true</span>);
<a name="l00248"></a>00248   inArgs.setSupports(IN_ARG_x_dot,<span class="keyword">true</span>);
<a name="l00249"></a>00249   inArgs.setSupports(IN_ARG_x_dotdot,<span class="keyword">true</span>);
<a name="l00250"></a>00250   inArgs.setSupports(IN_ARG_alpha,<span class="keyword">true</span>);
<a name="l00251"></a>00251   inArgs.setSupports(IN_ARG_omega,<span class="keyword">true</span>);
<a name="l00252"></a>00252   inArgs.setSupports(IN_ARG_beta,<span class="keyword">true</span>);
<a name="l00253"></a>00253   inArgs.set_Np(<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.size());
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 <span class="preprocessor">#ifdef ALBANY_SG_MP</span>
<a name="l00256"></a>00256 <span class="preprocessor"></span>  inArgs.setSupports(IN_ARG_x_sg,<span class="keyword">true</span>);
<a name="l00257"></a>00257   inArgs.setSupports(IN_ARG_x_dot_sg,<span class="keyword">true</span>);
<a name="l00258"></a>00258   inArgs.setSupports(IN_ARG_x_dotdot_sg,<span class="keyword">true</span>);
<a name="l00259"></a>00259   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.size(); i++)
<a name="l00260"></a>00260     inArgs.setSupports(IN_ARG_p_sg, i, <span class="keyword">true</span>);
<a name="l00261"></a>00261   inArgs.setSupports(IN_ARG_sg_basis,<span class="keyword">true</span>);
<a name="l00262"></a>00262   inArgs.setSupports(IN_ARG_sg_quadrature,<span class="keyword">true</span>);
<a name="l00263"></a>00263   inArgs.setSupports(IN_ARG_sg_expansion,<span class="keyword">true</span>);
<a name="l00264"></a>00264   
<a name="l00265"></a>00265   inArgs.setSupports(IN_ARG_x_mp,<span class="keyword">true</span>);
<a name="l00266"></a>00266   inArgs.setSupports(IN_ARG_x_dot_mp,<span class="keyword">true</span>);
<a name="l00267"></a>00267   inArgs.setSupports(IN_ARG_x_dotdot_mp,<span class="keyword">true</span>);
<a name="l00268"></a>00268   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.size(); i++)
<a name="l00269"></a>00269     inArgs.setSupports(IN_ARG_p_mp, i, <span class="keyword">true</span>); 
<a name="l00270"></a>00270 <span class="preprocessor">#endif</span>
<a name="l00271"></a>00271 <span class="preprocessor"></span>
<a name="l00272"></a>00272   <span class="keywordflow">return</span> inArgs;
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 EpetraExt::ModelEvaluator::OutArgs
<a name="l00276"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#a72ed29a92f769942d66c0f16035c82c8">00276</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#a72ed29a92f769942d66c0f16035c82c8" title="Create OutArgs.">Albany::ModelEvaluator::createOutArgs</a>()<span class="keyword"> const</span>
<a name="l00277"></a>00277 <span class="keyword"></span>{
<a name="l00278"></a>00278   OutArgsSetup outArgs;
<a name="l00279"></a>00279   outArgs.setModelEvalDescription(this-&gt;description());
<a name="l00280"></a>00280 
<a name="l00281"></a>00281   <span class="keywordtype">int</span> n_g = <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getNumResponses();
<a name="l00282"></a>00282 
<a name="l00283"></a>00283   <span class="comment">// Deterministic</span>
<a name="l00284"></a>00284   outArgs.setSupports(OUT_ARG_f,<span class="keyword">true</span>);
<a name="l00285"></a>00285   outArgs.setSupports(OUT_ARG_W,<span class="keyword">true</span>);
<a name="l00286"></a>00286   outArgs.set_W_properties(
<a name="l00287"></a>00287     DerivativeProperties(DERIV_LINEARITY_UNKNOWN, DERIV_RANK_FULL, <span class="keyword">true</span>));
<a name="l00288"></a>00288   <span class="keywordflow">if</span> (<a class="code" href="classAlbany_1_1ModelEvaluator.html#a1fe99061ac6a0d1b137c0482131f98dc" title="Whether the problem supplies its own preconditioner.">supplies_prec</a>) outArgs.setSupports(OUT_ARG_WPrec, <span class="keyword">true</span>);
<a name="l00289"></a>00289   outArgs.set_Np_Ng(<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.size(), n_g);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.size(); i++)
<a name="l00292"></a>00292     outArgs.setSupports(OUT_ARG_DfDp, i, DerivativeSupport(DERIV_MV_BY_COL));
<a name="l00293"></a>00293   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;n_g; i++) {
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (<a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getResponse(i)-&gt;isScalarResponse()) {
<a name="l00295"></a>00295       outArgs.setSupports(OUT_ARG_DgDx, i,
<a name="l00296"></a>00296                           DerivativeSupport(DERIV_TRANS_MV_BY_ROW));
<a name="l00297"></a>00297       outArgs.setSupports(OUT_ARG_DgDx_dot, i,
<a name="l00298"></a>00298                           DerivativeSupport(DERIV_TRANS_MV_BY_ROW));
<a name="l00299"></a>00299       outArgs.setSupports(OUT_ARG_DgDx_dotdot, i,
<a name="l00300"></a>00300                           DerivativeSupport(DERIV_TRANS_MV_BY_ROW));
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302     <span class="keywordflow">else</span> {
<a name="l00303"></a>00303       outArgs.setSupports(OUT_ARG_DgDx, i,
<a name="l00304"></a>00304                           DerivativeSupport(DERIV_LINEAR_OP));
<a name="l00305"></a>00305       outArgs.setSupports(OUT_ARG_DgDx_dot, i,
<a name="l00306"></a>00306                           DerivativeSupport(DERIV_LINEAR_OP));
<a name="l00307"></a>00307       outArgs.setSupports(OUT_ARG_DgDx_dotdot, i,
<a name="l00308"></a>00308                           DerivativeSupport(DERIV_LINEAR_OP));
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.size(); j++)
<a name="l00312"></a>00312       outArgs.setSupports(OUT_ARG_DgDp, i, j,
<a name="l00313"></a>00313                           DerivativeSupport(DERIV_MV_BY_COL));
<a name="l00314"></a>00314   }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 <span class="preprocessor">#ifdef ALBANY_SG_MP</span>
<a name="l00318"></a>00318 <span class="preprocessor"></span>  <span class="comment">// Stochastic</span>
<a name="l00319"></a>00319   outArgs.setSupports(OUT_ARG_f_sg,<span class="keyword">true</span>);
<a name="l00320"></a>00320   outArgs.setSupports(OUT_ARG_W_sg,<span class="keyword">true</span>);
<a name="l00321"></a>00321   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.size(); i++)
<a name="l00322"></a>00322     outArgs.setSupports(OUT_ARG_DfDp_sg, i, DerivativeSupport(DERIV_MV_BY_COL));
<a name="l00323"></a>00323   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;n_g; i++)
<a name="l00324"></a>00324     outArgs.setSupports(OUT_ARG_g_sg, i, <span class="keyword">true</span>);
<a name="l00325"></a>00325   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;n_g; i++) {
<a name="l00326"></a>00326     <span class="keywordflow">if</span> (<a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getResponse(i)-&gt;isScalarResponse()) {
<a name="l00327"></a>00327       outArgs.setSupports(OUT_ARG_DgDx_sg, i,
<a name="l00328"></a>00328                           DerivativeSupport(DERIV_TRANS_MV_BY_ROW));
<a name="l00329"></a>00329       outArgs.setSupports(OUT_ARG_DgDx_dot_sg, i,
<a name="l00330"></a>00330                           DerivativeSupport(DERIV_TRANS_MV_BY_ROW));
<a name="l00331"></a>00331       outArgs.setSupports(OUT_ARG_DgDx_dotdot_sg, i,
<a name="l00332"></a>00332                           DerivativeSupport(DERIV_TRANS_MV_BY_ROW));
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334     <span class="keywordflow">else</span> {
<a name="l00335"></a>00335       outArgs.setSupports(OUT_ARG_DgDx_sg, i,
<a name="l00336"></a>00336                           DerivativeSupport(DERIV_LINEAR_OP));
<a name="l00337"></a>00337       outArgs.setSupports(OUT_ARG_DgDx_dot_sg, i,
<a name="l00338"></a>00338                           DerivativeSupport(DERIV_LINEAR_OP));
<a name="l00339"></a>00339       outArgs.setSupports(OUT_ARG_DgDx_dotdot_sg, i,
<a name="l00340"></a>00340                           DerivativeSupport(DERIV_LINEAR_OP));
<a name="l00341"></a>00341     }
<a name="l00342"></a>00342     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.size(); j++)
<a name="l00343"></a>00343       outArgs.setSupports(OUT_ARG_DgDp_sg, i, j,
<a name="l00344"></a>00344                           DerivativeSupport(DERIV_MV_BY_COL));
<a name="l00345"></a>00345   }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347   <span class="comment">// Multi-point</span>
<a name="l00348"></a>00348   outArgs.setSupports(OUT_ARG_f_mp,<span class="keyword">true</span>);
<a name="l00349"></a>00349   outArgs.setSupports(OUT_ARG_W_mp,<span class="keyword">true</span>);
<a name="l00350"></a>00350   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.size(); i++)
<a name="l00351"></a>00351     outArgs.setSupports(OUT_ARG_DfDp_mp, i, DerivativeSupport(DERIV_MV_BY_COL));
<a name="l00352"></a>00352   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;n_g; i++)
<a name="l00353"></a>00353     outArgs.setSupports(OUT_ARG_g_mp, i, <span class="keyword">true</span>);
<a name="l00354"></a>00354   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;n_g; i++) {
<a name="l00355"></a>00355     outArgs.setSupports(OUT_ARG_g_mp, i, <span class="keyword">true</span>);
<a name="l00356"></a>00356     <span class="keywordflow">if</span> (<a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getResponse(i)-&gt;isScalarResponse()) {
<a name="l00357"></a>00357       outArgs.setSupports(OUT_ARG_DgDx_mp, i,
<a name="l00358"></a>00358                           DerivativeSupport(DERIV_TRANS_MV_BY_ROW));
<a name="l00359"></a>00359       outArgs.setSupports(OUT_ARG_DgDx_dot_mp, i,
<a name="l00360"></a>00360                           DerivativeSupport(DERIV_TRANS_MV_BY_ROW));
<a name="l00361"></a>00361       outArgs.setSupports(OUT_ARG_DgDx_dotdot_mp, i,
<a name="l00362"></a>00362                           DerivativeSupport(DERIV_TRANS_MV_BY_ROW));
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364     <span class="keywordflow">else</span> {
<a name="l00365"></a>00365       outArgs.setSupports(OUT_ARG_DgDx_mp, i,
<a name="l00366"></a>00366                           DerivativeSupport(DERIV_LINEAR_OP));
<a name="l00367"></a>00367       outArgs.setSupports(OUT_ARG_DgDx_dot_mp, i,
<a name="l00368"></a>00368                           DerivativeSupport(DERIV_LINEAR_OP));
<a name="l00369"></a>00369       outArgs.setSupports(OUT_ARG_DgDx_dotdot_mp, i,
<a name="l00370"></a>00370                           DerivativeSupport(DERIV_LINEAR_OP));
<a name="l00371"></a>00371     }
<a name="l00372"></a>00372     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classAlbany_1_1ModelEvaluator.html#aaf64828c901d4d4d55e088dab57352fd" title="List of free parameter names.">param_names</a>.size(); j++)
<a name="l00373"></a>00373       outArgs.setSupports(OUT_ARG_DgDp_mp, i, j,
<a name="l00374"></a>00374                           DerivativeSupport(DERIV_MV_BY_COL));
<a name="l00375"></a>00375   }
<a name="l00376"></a>00376 <span class="preprocessor">#endif</span>
<a name="l00377"></a>00377 <span class="preprocessor"></span>
<a name="l00378"></a>00378   <span class="keywordflow">return</span> outArgs;
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 <span class="keywordtype">void</span> 
<a name="l00382"></a><a class="code" href="classAlbany_1_1ModelEvaluator.html#a68f56f909aecdfe3107335a80e5b3cea">00382</a> <a class="code" href="classAlbany_1_1ModelEvaluator.html#a68f56f909aecdfe3107335a80e5b3cea" title="Evaluate model on InArgs.">Albany::ModelEvaluator::evalModel</a>(<span class="keyword">const</span> InArgs&amp; inArgs, 
<a name="l00383"></a>00383          <span class="keyword">const</span> OutArgs&amp; outArgs)<span class="keyword"> const</span>
<a name="l00384"></a>00384 <span class="keyword"></span>{
<a name="l00385"></a>00385   Teuchos::TimeMonitor Timer(*<a class="code" href="classAlbany_1_1ModelEvaluator.html#a889d032869133fa501f25a74c53da19b">timer</a>); <span class="comment">//start timer</span>
<a name="l00386"></a>00386   <span class="comment">//</span>
<a name="l00387"></a>00387   <span class="comment">// Get the input arguments</span>
<a name="l00388"></a>00388   <span class="comment">//</span>
<a name="l00389"></a>00389   Teuchos::RCP&lt;const Epetra_Vector&gt; x = inArgs.get_x();
<a name="l00390"></a>00390   Teuchos::RCP&lt;const Epetra_Vector&gt; x_dot;
<a name="l00391"></a>00391   Teuchos::RCP&lt;const Epetra_Vector&gt; x_dotdot;
<a name="l00392"></a>00392   <span class="keywordtype">double</span> <a class="code" href="namespaceFELIX.html#a4d08741b97fea3938089670d2a84c598">alpha</a>     = 0.0;
<a name="l00393"></a>00393   <span class="keywordtype">double</span> omega     = 0.0;
<a name="l00394"></a>00394   <span class="keywordtype">double</span> beta      = 1.0;
<a name="l00395"></a>00395   <span class="keywordtype">double</span> curr_time = 0.0;
<a name="l00396"></a>00396   x_dot = inArgs.get_x_dot();
<a name="l00397"></a>00397   x_dotdot = inArgs.get_x_dotdot();
<a name="l00398"></a>00398   <span class="keywordflow">if</span> (x_dot != Teuchos::null || x_dotdot != Teuchos::null) {
<a name="l00399"></a>00399     alpha = inArgs.get_alpha();
<a name="l00400"></a>00400     omega = inArgs.get_omega();
<a name="l00401"></a>00401     beta = inArgs.get_beta();
<a name="l00402"></a>00402     curr_time  = inArgs.get_t();
<a name="l00403"></a>00403   }
<a name="l00404"></a>00404   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;inArgs.Np(); i++) {
<a name="l00405"></a>00405     Teuchos::RCP&lt;const Epetra_Vector&gt; p = inArgs.get_p(i);
<a name="l00406"></a>00406     <span class="keywordflow">if</span> (p != Teuchos::null) {
<a name="l00407"></a>00407       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i].size(); j++)
<a name="l00408"></a>00408   <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i][j].baseValue = (*p)[j];
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410   }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412   <span class="comment">//</span>
<a name="l00413"></a>00413   <span class="comment">// Get the output arguments</span>
<a name="l00414"></a>00414   <span class="comment">//</span>
<a name="l00415"></a>00415   EpetraExt::ModelEvaluator::Evaluation&lt;Epetra_Vector&gt; f_out = outArgs.get_f();
<a name="l00416"></a>00416   Teuchos::RCP&lt;Epetra_Operator&gt; W_out = outArgs.get_W();
<a name="l00417"></a>00417 
<a name="l00418"></a>00418   <span class="comment">// Cast W to a CrsMatrix, throw an exception if this fails</span>
<a name="l00419"></a>00419   Teuchos::RCP&lt;Epetra_CrsMatrix&gt; W_out_crs;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   <span class="keywordflow">if</span> (W_out != Teuchos::null)
<a name="l00422"></a>00422     W_out_crs = Teuchos::rcp_dynamic_cast&lt;Epetra_CrsMatrix&gt;(W_out, <span class="keyword">true</span>);
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 <span class="keywordtype">int</span> test_var = 0;
<a name="l00425"></a>00425 <span class="keywordflow">if</span>(test_var != 0){
<a name="l00426"></a>00426 std::cout &lt;&lt; <span class="stringliteral">&quot;The current solution length is: &quot;</span> &lt;&lt; x-&gt;MyLength() &lt;&lt; std::endl;
<a name="l00427"></a>00427 x-&gt;Print(std::cout);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430   
<a name="l00431"></a>00431   <span class="comment">// Get preconditioner operator, if requested</span>
<a name="l00432"></a>00432   Teuchos::RCP&lt;Epetra_Operator&gt; WPrec_out;
<a name="l00433"></a>00433   <span class="keywordflow">if</span> (outArgs.supports(OUT_ARG_WPrec)) WPrec_out = outArgs.get_WPrec();
<a name="l00434"></a>00434 
<a name="l00435"></a>00435   <span class="comment">//</span>
<a name="l00436"></a>00436   <span class="comment">// Compute the functions</span>
<a name="l00437"></a>00437   <span class="comment">//</span>
<a name="l00438"></a>00438   <span class="keywordtype">bool</span> f_already_computed = <span class="keyword">false</span>;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440   <span class="comment">// W matrix</span>
<a name="l00441"></a>00441   <span class="keywordflow">if</span> (W_out != Teuchos::null) {
<a name="l00442"></a>00442     <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;computeGlobalJacobian(alpha, beta, omega, curr_time, x_dot.get(), x_dotdot.get(),*x, 
<a name="l00443"></a>00443              <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, f_out.get(), *W_out_crs);
<a name="l00444"></a>00444     f_already_computed=<span class="keyword">true</span>;
<a name="l00445"></a>00445 <span class="keywordflow">if</span>(test_var != 0){
<a name="l00446"></a>00446 <span class="comment">//std::cout &lt;&lt; &quot;The current rhs length is: &quot; &lt;&lt; f_out-&gt;MyLength() &lt;&lt; std::endl;</span>
<a name="l00447"></a>00447 <span class="comment">//f_out-&gt;Print(std::cout);</span>
<a name="l00448"></a>00448 std::cout &lt;&lt; <span class="stringliteral">&quot;The current Jacobian length is: &quot;</span> &lt;&lt; W_out_crs-&gt;NumGlobalRows() &lt;&lt; std::endl;
<a name="l00449"></a>00449 W_out_crs-&gt;Print(std::cout);
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451   }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453   <span class="keywordflow">if</span> (WPrec_out != Teuchos::null) {
<a name="l00454"></a>00454     <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;computeGlobalJacobian(alpha, beta, omega, curr_time, x_dot.get(), x_dotdot.get(), *x, 
<a name="l00455"></a>00455              <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, f_out.get(), *<a class="code" href="classAlbany_1_1ModelEvaluator.html#a73eb24d5dfa7067cd93a97c7ef781aab" title="Allocated Jacobian for sending to user preconditioner.">Extra_W_crs</a>);
<a name="l00456"></a>00456     f_already_computed=<span class="keyword">true</span>;
<a name="l00457"></a>00457 <span class="keywordflow">if</span>(test_var != 0){
<a name="l00458"></a>00458 <span class="comment">//std::cout &lt;&lt; &quot;The current rhs length is: &quot; &lt;&lt; f_out-&gt;MyLength() &lt;&lt; std::endl;</span>
<a name="l00459"></a>00459 <span class="comment">//f_out-&gt;Print(std::cout);</span>
<a name="l00460"></a>00460 std::cout &lt;&lt; <span class="stringliteral">&quot;The current preconditioner length is: &quot;</span> &lt;&lt; <a class="code" href="classAlbany_1_1ModelEvaluator.html#a73eb24d5dfa7067cd93a97c7ef781aab" title="Allocated Jacobian for sending to user preconditioner.">Extra_W_crs</a>-&gt;NumGlobalRows() &lt;&lt; std::endl;
<a name="l00461"></a>00461 <a class="code" href="classAlbany_1_1ModelEvaluator.html#a73eb24d5dfa7067cd93a97c7ef781aab" title="Allocated Jacobian for sending to user preconditioner.">Extra_W_crs</a>-&gt;Print(std::cout);
<a name="l00462"></a>00462 }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;computeGlobalPreconditioner(<a class="code" href="classAlbany_1_1ModelEvaluator.html#a73eb24d5dfa7067cd93a97c7ef781aab" title="Allocated Jacobian for sending to user preconditioner.">Extra_W_crs</a>, WPrec_out);
<a name="l00465"></a>00465   }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467   <span class="comment">// df/dp</span>
<a name="l00468"></a>00468   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;outArgs.Np(); i++) {
<a name="l00469"></a>00469     Teuchos::RCP&lt;Epetra_MultiVector&gt; dfdp_out = 
<a name="l00470"></a>00470       outArgs.get_DfDp(i).getMultiVector();
<a name="l00471"></a>00471     <span class="keywordflow">if</span> (dfdp_out != Teuchos::null) {
<a name="l00472"></a>00472       Teuchos::Array&lt;int&gt; p_indexes = 
<a name="l00473"></a>00473         outArgs.get_DfDp(i).getDerivativeMultiVector().getParamIndexes();
<a name="l00474"></a>00474       Teuchos::RCP&lt;ParamVec&gt; p_vec;
<a name="l00475"></a>00475       <span class="keywordflow">if</span> (p_indexes.size() == 0)
<a name="l00476"></a>00476         p_vec = Teuchos::rcp(&amp;<a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i],<span class="keyword">false</span>);
<a name="l00477"></a>00477       <span class="keywordflow">else</span> {
<a name="l00478"></a>00478         p_vec = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="Albany__DataTypes_8hpp.html#aa17b892cdb0cb1ec55119bb8b01cb49e">ParamVec</a>);
<a name="l00479"></a>00479         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;p_indexes.size(); j++)
<a name="l00480"></a>00480           p_vec-&gt;addParam(<a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i][p_indexes[j]].family, 
<a name="l00481"></a>00481                           <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i][p_indexes[j]].baseValue);
<a name="l00482"></a>00482       }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484       <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;computeGlobalTangent(0.0, 0.0, 0.0, curr_time, <span class="keyword">false</span>, x_dot.get(), x_dotdot.get(), *x, 
<a name="l00485"></a>00485                                 <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, p_vec.get(),
<a name="l00486"></a>00486                                 NULL, NULL, NULL, NULL, f_out.get(), NULL, 
<a name="l00487"></a>00487                                 dfdp_out.get());
<a name="l00488"></a>00488 
<a name="l00489"></a>00489       f_already_computed=<span class="keyword">true</span>;
<a name="l00490"></a>00490 <span class="keywordflow">if</span>(test_var != 0){
<a name="l00491"></a>00491 std::cout &lt;&lt; <span class="stringliteral">&quot;The current rhs length is: &quot;</span> &lt;&lt; f_out-&gt;MyLength() &lt;&lt; std::endl;
<a name="l00492"></a>00492 f_out-&gt;Print(std::cout);
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495   }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   <span class="comment">// f</span>
<a name="l00498"></a>00498   <span class="keywordflow">if</span> (<a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;is_adjoint) {
<a name="l00499"></a>00499     Derivative f_deriv(f_out, DERIV_TRANS_MV_BY_ROW);
<a name="l00500"></a>00500     <span class="keywordtype">int</span> response_index = 0; <span class="comment">// need to add capability for sending this in</span>
<a name="l00501"></a>00501     <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;evaluateResponseDerivative(response_index, curr_time, x_dot.get(), x_dotdot.get(), *x, 
<a name="l00502"></a>00502             <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, NULL, 
<a name="l00503"></a>00503             NULL, f_deriv, Derivative(), Derivative(), Derivative());
<a name="l00504"></a>00504   }
<a name="l00505"></a>00505   <span class="keywordflow">else</span> {
<a name="l00506"></a>00506     <span class="keywordflow">if</span> (f_out != Teuchos::null &amp;&amp; !f_already_computed) {
<a name="l00507"></a>00507       <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;computeGlobalResidual(curr_time, x_dot.get(), x_dotdot.get(), *x, 
<a name="l00508"></a>00508                  <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, *f_out);
<a name="l00509"></a>00509 <span class="keywordflow">if</span>(test_var != 0){
<a name="l00510"></a>00510 std::cout &lt;&lt; <span class="stringliteral">&quot;The current rhs length is: &quot;</span> &lt;&lt; f_out-&gt;MyLength() &lt;&lt; std::endl;
<a name="l00511"></a>00511 f_out-&gt;Print(std::cout);
<a name="l00512"></a>00512 }
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514   }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516   <span class="comment">// Response functions</span>
<a name="l00517"></a>00517   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;outArgs.Ng(); i++) {
<a name="l00518"></a>00518     Teuchos::RCP&lt;Epetra_Vector&gt; g_out = outArgs.get_g(i);
<a name="l00519"></a>00519     <span class="keywordtype">bool</span> g_computed = <span class="keyword">false</span>;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     Derivative dgdx_out = outArgs.get_DgDx(i);
<a name="l00522"></a>00522     Derivative dgdxdot_out = outArgs.get_DgDx_dot(i);
<a name="l00523"></a>00523     Derivative dgdxdotdot_out = outArgs.get_DgDx_dotdot(i);
<a name="l00524"></a>00524 
<a name="l00525"></a>00525     <span class="comment">// dg/dx, dg/dxdot</span>
<a name="l00526"></a>00526     <span class="keywordflow">if</span> (!dgdx_out.isEmpty() || !dgdxdot_out.isEmpty() || !dgdxdotdot_out.isEmpty() ) {
<a name="l00527"></a>00527       <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;evaluateResponseDerivative(i, curr_time, x_dot.get(), x_dotdot.get(), *x,
<a name="l00528"></a>00528                                       <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, NULL,
<a name="l00529"></a>00529                                       g_out.get(), dgdx_out,
<a name="l00530"></a>00530                                       dgdxdot_out, dgdxdotdot_out, Derivative());
<a name="l00531"></a>00531       g_computed = <span class="keyword">true</span>;
<a name="l00532"></a>00532     }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     <span class="comment">// dg/dp</span>
<a name="l00535"></a>00535     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;outArgs.Np(); j++) {
<a name="l00536"></a>00536       Teuchos::RCP&lt;Epetra_MultiVector&gt; dgdp_out =
<a name="l00537"></a>00537         outArgs.get_DgDp(i,j).getMultiVector();
<a name="l00538"></a>00538       <span class="keywordflow">if</span> (dgdp_out != Teuchos::null) {
<a name="l00539"></a>00539         Teuchos::Array&lt;int&gt; p_indexes =
<a name="l00540"></a>00540           outArgs.get_DgDp(i,j).getDerivativeMultiVector().getParamIndexes();
<a name="l00541"></a>00541         Teuchos::RCP&lt;ParamVec&gt; p_vec;
<a name="l00542"></a>00542         <span class="keywordflow">if</span> (p_indexes.size() == 0)
<a name="l00543"></a>00543           p_vec = Teuchos::rcp(&amp;<a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[j],<span class="keyword">false</span>);
<a name="l00544"></a>00544         <span class="keywordflow">else</span> {
<a name="l00545"></a>00545           p_vec = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="Albany__DataTypes_8hpp.html#aa17b892cdb0cb1ec55119bb8b01cb49e">ParamVec</a>);
<a name="l00546"></a>00546           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;p_indexes.size(); k++)
<a name="l00547"></a>00547             p_vec-&gt;addParam(<a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[j][p_indexes[k]].family,
<a name="l00548"></a>00548                             <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[j][p_indexes[k]].baseValue);
<a name="l00549"></a>00549         }
<a name="l00550"></a>00550         <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;evaluateResponseTangent(i, alpha, beta, omega, curr_time, <span class="keyword">false</span>,
<a name="l00551"></a>00551                                      x_dot.get(), x_dotdot.get(), *x,
<a name="l00552"></a>00552                                      <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, p_vec.get(),
<a name="l00553"></a>00553                                      NULL, NULL, NULL, NULL, g_out.get(), NULL,
<a name="l00554"></a>00554                                      dgdp_out.get());
<a name="l00555"></a>00555         g_computed = <span class="keyword">true</span>;
<a name="l00556"></a>00556       }
<a name="l00557"></a>00557     }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559     <span class="keywordflow">if</span> (g_out != Teuchos::null &amp;&amp; !g_computed)
<a name="l00560"></a>00560       <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;evaluateResponse(i, curr_time, x_dot.get(), x_dotdot.get(), *x, <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, 
<a name="l00561"></a>00561           *g_out);
<a name="l00562"></a>00562   }
<a name="l00563"></a>00563 
<a name="l00564"></a>00564   <span class="comment">//</span>
<a name="l00565"></a>00565   <span class="comment">// Stochastic Galerkin</span>
<a name="l00566"></a>00566   <span class="comment">//</span>
<a name="l00567"></a>00567 <span class="preprocessor">#ifdef ALBANY_SG_MP</span>
<a name="l00568"></a>00568 <span class="preprocessor"></span>  InArgs::sg_const_vector_t x_sg = inArgs.get_x_sg();
<a name="l00569"></a>00569   <span class="keywordflow">if</span> (x_sg != Teuchos::null) {
<a name="l00570"></a>00570     <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;init_sg(inArgs.get_sg_basis(), 
<a name="l00571"></a>00571      inArgs.get_sg_quadrature(), 
<a name="l00572"></a>00572      inArgs.get_sg_expansion(), 
<a name="l00573"></a>00573      x_sg-&gt;productComm());
<a name="l00574"></a>00574     InArgs::sg_const_vector_t x_dot_sg  = inArgs.get_x_dot_sg();
<a name="l00575"></a>00575     InArgs::sg_const_vector_t x_dotdot_sg  = inArgs.get_x_dotdot_sg();
<a name="l00576"></a>00576     InArgs::sg_const_vector_t epetra_p_sg = inArgs.get_p_sg(0);
<a name="l00577"></a>00577     Teuchos::Array&lt;int&gt; p_sg_index;
<a name="l00578"></a>00578     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;inArgs.Np(); i++) {
<a name="l00579"></a>00579       InArgs::sg_const_vector_t p_sg = inArgs.get_p_sg(i);
<a name="l00580"></a>00580       <span class="keywordflow">if</span> (p_sg != Teuchos::null) {
<a name="l00581"></a>00581   p_sg_index.push_back(i);
<a name="l00582"></a>00582   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classAlbany_1_1ModelEvaluator.html#a7790ce8e97577962430f207735f66f19" title="Stochastic Galerkin parameters.">p_sg_vals</a>[i].size(); j++) {
<a name="l00583"></a>00583     <span class="keywordtype">int</span> num_sg_blocks = p_sg-&gt;size();
<a name="l00584"></a>00584     <a class="code" href="classAlbany_1_1ModelEvaluator.html#a7790ce8e97577962430f207735f66f19" title="Stochastic Galerkin parameters.">p_sg_vals</a>[i][j].reset(<a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;getStochasticExpansion(), num_sg_blocks);
<a name="l00585"></a>00585     <a class="code" href="classAlbany_1_1ModelEvaluator.html#a7790ce8e97577962430f207735f66f19" title="Stochastic Galerkin parameters.">p_sg_vals</a>[i][j].copyForWrite();
<a name="l00586"></a>00586     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;num_sg_blocks; l++) {
<a name="l00587"></a>00587       <a class="code" href="classAlbany_1_1ModelEvaluator.html#a7790ce8e97577962430f207735f66f19" title="Stochastic Galerkin parameters.">p_sg_vals</a>[i][j].fastAccessCoeff(l) = (*p_sg)[l][j];
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589   }
<a name="l00590"></a>00590       }
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     OutArgs::sg_vector_t f_sg = outArgs.get_f_sg();
<a name="l00594"></a>00594     OutArgs::sg_operator_t W_sg = outArgs.get_W_sg();
<a name="l00595"></a>00595     <span class="keywordtype">bool</span> f_sg_computed = <span class="keyword">false</span>;
<a name="l00596"></a>00596 
<a name="l00597"></a>00597     <span class="comment">// W_sg</span>
<a name="l00598"></a>00598     <span class="keywordflow">if</span> (W_sg != Teuchos::null) {
<a name="l00599"></a>00599       Stokhos::VectorOrthogPoly&lt;Epetra_CrsMatrix&gt; W_sg_crs(W_sg-&gt;basis(), 
<a name="l00600"></a>00600                  W_sg-&gt;map());
<a name="l00601"></a>00601       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;W_sg-&gt;size(); i++)
<a name="l00602"></a>00602   W_sg_crs.setCoeffPtr(
<a name="l00603"></a>00603     i,
<a name="l00604"></a>00604     Teuchos::rcp_dynamic_cast&lt;Epetra_CrsMatrix&gt;(W_sg-&gt;getCoeffPtr(i)));
<a name="l00605"></a>00605       <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;computeGlobalSGJacobian(alpha, beta, omega, curr_time, 
<a name="l00606"></a>00606            x_dot_sg.get(),  x_dotdot_sg.get(), *x_sg, 
<a name="l00607"></a>00607            <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, p_sg_index, <a class="code" href="classAlbany_1_1ModelEvaluator.html#a7790ce8e97577962430f207735f66f19" title="Stochastic Galerkin parameters.">p_sg_vals</a>,
<a name="l00608"></a>00608            f_sg.get(), W_sg_crs);
<a name="l00609"></a>00609       f_sg_computed = <span class="keyword">true</span>;
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     <span class="comment">// df/dp_sg</span>
<a name="l00613"></a>00613     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;outArgs.Np(); i++) {
<a name="l00614"></a>00614       Teuchos::RCP&lt; Stokhos::EpetraMultiVectorOrthogPoly &gt; dfdp_sg
<a name="l00615"></a>00615         = outArgs.get_DfDp_sg(i).getMultiVector();
<a name="l00616"></a>00616       <span class="keywordflow">if</span> (dfdp_sg != Teuchos::null) {
<a name="l00617"></a>00617         Teuchos::Array&lt;int&gt; p_indexes =
<a name="l00618"></a>00618           outArgs.get_DfDp_sg(i).getDerivativeMultiVector().getParamIndexes();
<a name="l00619"></a>00619         Teuchos::RCP&lt;ParamVec&gt; p_vec;
<a name="l00620"></a>00620         <span class="keywordflow">if</span> (p_indexes.size() == 0)
<a name="l00621"></a>00621           p_vec = Teuchos::rcp(&amp;<a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i],<span class="keyword">false</span>);
<a name="l00622"></a>00622         <span class="keywordflow">else</span> {
<a name="l00623"></a>00623           p_vec = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="Albany__DataTypes_8hpp.html#aa17b892cdb0cb1ec55119bb8b01cb49e">ParamVec</a>);
<a name="l00624"></a>00624           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;p_indexes.size(); j++)
<a name="l00625"></a>00625             p_vec-&gt;addParam(<a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i][p_indexes[j]].family,
<a name="l00626"></a>00626                             <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i][p_indexes[j]].baseValue);
<a name="l00627"></a>00627         }
<a name="l00628"></a>00628 
<a name="l00629"></a>00629         <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;computeGlobalSGTangent(0.0, 0.0, 0.0, curr_time, <span class="keyword">false</span>,
<a name="l00630"></a>00630                                     x_dot_sg.get(), x_dotdot_sg.get(),*x_sg,
<a name="l00631"></a>00631                                     <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, p_sg_index, <a class="code" href="classAlbany_1_1ModelEvaluator.html#a7790ce8e97577962430f207735f66f19" title="Stochastic Galerkin parameters.">p_sg_vals</a>,
<a name="l00632"></a>00632                                     p_vec.get(), NULL, NULL, NULL, NULL,
<a name="l00633"></a>00633                                     f_sg.get(), NULL, dfdp_sg.get());
<a name="l00634"></a>00634 
<a name="l00635"></a>00635         f_sg_computed = <span class="keyword">true</span>;
<a name="l00636"></a>00636       }
<a name="l00637"></a>00637     }
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     <span class="keywordflow">if</span> (f_sg != Teuchos::null &amp;&amp; !f_sg_computed)
<a name="l00640"></a>00640       <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;computeGlobalSGResidual(curr_time, x_dot_sg.get(), x_dotdot_sg.get(),*x_sg, 
<a name="l00641"></a>00641            <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, p_sg_index, <a class="code" href="classAlbany_1_1ModelEvaluator.html#a7790ce8e97577962430f207735f66f19" title="Stochastic Galerkin parameters.">p_sg_vals</a>,
<a name="l00642"></a>00642            *f_sg);
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <span class="comment">// Response functions</span>
<a name="l00645"></a>00645     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;outArgs.Ng(); i++) {
<a name="l00646"></a>00646       OutArgs::sg_vector_t g_sg = outArgs.get_g_sg(i);
<a name="l00647"></a>00647       <span class="keywordtype">bool</span> g_sg_computed = <span class="keyword">false</span>;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649       SGDerivative dgdx_sg = outArgs.get_DgDx_sg(i);
<a name="l00650"></a>00650       SGDerivative dgdxdot_sg = outArgs.get_DgDx_dot_sg(i);
<a name="l00651"></a>00651       SGDerivative dgdxdotdot_sg = outArgs.get_DgDx_dotdot_sg(i);
<a name="l00652"></a>00652 
<a name="l00653"></a>00653       <span class="comment">// dg/dx, dg/dxdot</span>
<a name="l00654"></a>00654       <span class="keywordflow">if</span> (!dgdx_sg.isEmpty() || !dgdxdot_sg.isEmpty() || !dgdxdotdot_sg.isEmpty()) {
<a name="l00655"></a>00655         <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;evaluateSGResponseDerivative(
<a name="l00656"></a>00656             i, curr_time, x_dot_sg.get(), x_dotdot_sg.get(), *x_sg,
<a name="l00657"></a>00657             sacado_param_vec, p_sg_index, p_sg_vals,
<a name="l00658"></a>00658             NULL, g_sg.get(), dgdx_sg,
<a name="l00659"></a>00659             dgdxdot_sg, dgdxdotdot_sg, SGDerivative());
<a name="l00660"></a>00660         g_sg_computed = <span class="keyword">true</span>;
<a name="l00661"></a>00661       }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663       <span class="comment">// dg/dp</span>
<a name="l00664"></a>00664       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;outArgs.Np(); j++) {
<a name="l00665"></a>00665         Teuchos::RCP&lt; Stokhos::EpetraMultiVectorOrthogPoly &gt; dgdp_sg =
<a name="l00666"></a>00666           outArgs.get_DgDp_sg(i,j).getMultiVector();
<a name="l00667"></a>00667         <span class="keywordflow">if</span> (dgdp_sg != Teuchos::null) {
<a name="l00668"></a>00668           Teuchos::Array&lt;int&gt; p_indexes =
<a name="l00669"></a>00669             outArgs.get_DgDp_sg(i,j).getDerivativeMultiVector().getParamIndexes();
<a name="l00670"></a>00670           Teuchos::RCP&lt;ParamVec&gt; p_vec;
<a name="l00671"></a>00671           <span class="keywordflow">if</span> (p_indexes.size() == 0)
<a name="l00672"></a>00672             p_vec = Teuchos::rcp(&amp;sacado_param_vec[j],<span class="keyword">false</span>);
<a name="l00673"></a>00673           <span class="keywordflow">else</span> {
<a name="l00674"></a>00674             p_vec = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="Albany__DataTypes_8hpp.html#aa17b892cdb0cb1ec55119bb8b01cb49e">ParamVec</a>);
<a name="l00675"></a>00675             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;p_indexes.size(); k++)
<a name="l00676"></a>00676               p_vec-&gt;addParam(sacado_param_vec[j][p_indexes[k]].family,
<a name="l00677"></a>00677                               sacado_param_vec[j][p_indexes[k]].baseValue);
<a name="l00678"></a>00678           }
<a name="l00679"></a>00679           <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;evaluateSGResponseTangent(i, alpha, beta, omega, curr_time, <span class="keyword">false</span>,
<a name="l00680"></a>00680                                          x_dot_sg.get(), x_dotdot_sg.get(), *x_sg,
<a name="l00681"></a>00681                                          sacado_param_vec, p_sg_index,
<a name="l00682"></a>00682                                          p_sg_vals, p_vec.get(),
<a name="l00683"></a>00683                                          NULL, NULL, NULL, NULL, g_sg.get(),
<a name="l00684"></a>00684                                          NULL, dgdp_sg.get());
<a name="l00685"></a>00685           g_sg_computed = <span class="keyword">true</span>;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687         }
<a name="l00688"></a>00688       }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690       <span class="keywordflow">if</span> (g_sg != Teuchos::null &amp;&amp; !g_sg_computed)
<a name="l00691"></a>00691   <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;evaluateSGResponse(i, curr_time, x_dot_sg.get(), x_dotdot_sg.get(), *x_sg, 
<a name="l00692"></a>00692         sacado_param_vec, p_sg_index, p_sg_vals, 
<a name="l00693"></a>00693         *g_sg);
<a name="l00694"></a>00694     }
<a name="l00695"></a>00695   }
<a name="l00696"></a>00696 
<a name="l00697"></a>00697   <span class="comment">//</span>
<a name="l00698"></a>00698   <span class="comment">// Multi-point evaluation</span>
<a name="l00699"></a>00699   <span class="comment">//</span>
<a name="l00700"></a>00700   mp_const_vector_t x_mp = inArgs.get_x_mp();
<a name="l00701"></a>00701   <span class="keywordflow">if</span> (x_mp != Teuchos::null) {
<a name="l00702"></a>00702     mp_const_vector_t x_dot_mp  = inArgs.get_x_dot_mp();
<a name="l00703"></a>00703     mp_const_vector_t x_dotdot_mp  = inArgs.get_x_dotdot_mp();
<a name="l00704"></a>00704     Teuchos::Array&lt;int&gt; p_mp_index;
<a name="l00705"></a>00705     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;inArgs.Np(); i++) {
<a name="l00706"></a>00706       mp_const_vector_t p_mp = inArgs.get_p_mp(i);
<a name="l00707"></a>00707       <span class="keywordflow">if</span> (p_mp != Teuchos::null) {
<a name="l00708"></a>00708   p_mp_index.push_back(i);
<a name="l00709"></a>00709   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classAlbany_1_1ModelEvaluator.html#ababf8e2481c37d6f11547aca400e0198" title="Multi-point parameters.">p_mp_vals</a>[i].size(); j++) {
<a name="l00710"></a>00710     <span class="keywordtype">int</span> num_mp_blocks = p_mp-&gt;size();
<a name="l00711"></a>00711     <a class="code" href="classAlbany_1_1ModelEvaluator.html#ababf8e2481c37d6f11547aca400e0198" title="Multi-point parameters.">p_mp_vals</a>[i][j].reset(num_mp_blocks);
<a name="l00712"></a>00712     <a class="code" href="classAlbany_1_1ModelEvaluator.html#ababf8e2481c37d6f11547aca400e0198" title="Multi-point parameters.">p_mp_vals</a>[i][j].copyForWrite();
<a name="l00713"></a>00713     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;num_mp_blocks; l++) {
<a name="l00714"></a>00714       <a class="code" href="classAlbany_1_1ModelEvaluator.html#ababf8e2481c37d6f11547aca400e0198" title="Multi-point parameters.">p_mp_vals</a>[i][j].fastAccessCoeff(l) = (*p_mp)[l][j];
<a name="l00715"></a>00715     }
<a name="l00716"></a>00716   }
<a name="l00717"></a>00717       }
<a name="l00718"></a>00718     }
<a name="l00719"></a>00719     
<a name="l00720"></a>00720     mp_vector_t f_mp = outArgs.get_f_mp();
<a name="l00721"></a>00721     mp_operator_t W_mp = outArgs.get_W_mp();
<a name="l00722"></a>00722     <span class="keywordtype">bool</span> f_mp_computed = <span class="keyword">false</span>;
<a name="l00723"></a>00723 
<a name="l00724"></a>00724     <span class="comment">// W_mp</span>
<a name="l00725"></a>00725     <span class="keywordflow">if</span> (W_mp != Teuchos::null) {
<a name="l00726"></a>00726       Stokhos::ProductContainer&lt;Epetra_CrsMatrix&gt; W_mp_crs(W_mp-&gt;map());
<a name="l00727"></a>00727       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;W_mp-&gt;size(); i++)
<a name="l00728"></a>00728   W_mp_crs.setCoeffPtr(
<a name="l00729"></a>00729     i,
<a name="l00730"></a>00730     Teuchos::rcp_dynamic_cast&lt;Epetra_CrsMatrix&gt;(W_mp-&gt;getCoeffPtr(i)));
<a name="l00731"></a>00731       <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;computeGlobalMPJacobian(alpha, beta, omega, curr_time, 
<a name="l00732"></a>00732            x_dot_mp.get(), x_dotdot_mp.get(), *x_mp, 
<a name="l00733"></a>00733            <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, p_mp_index, <a class="code" href="classAlbany_1_1ModelEvaluator.html#ababf8e2481c37d6f11547aca400e0198" title="Multi-point parameters.">p_mp_vals</a>,
<a name="l00734"></a>00734            f_mp.get(), W_mp_crs);
<a name="l00735"></a>00735       f_mp_computed = <span class="keyword">true</span>;
<a name="l00736"></a>00736     }
<a name="l00737"></a>00737 
<a name="l00738"></a>00738     <span class="comment">// df/dp_mp</span>
<a name="l00739"></a>00739     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;outArgs.Np(); i++) {
<a name="l00740"></a>00740       Teuchos::RCP&lt; Stokhos::ProductEpetraMultiVector &gt; dfdp_mp
<a name="l00741"></a>00741         = outArgs.get_DfDp_mp(i).getMultiVector();
<a name="l00742"></a>00742       <span class="keywordflow">if</span> (dfdp_mp != Teuchos::null) {
<a name="l00743"></a>00743         Teuchos::Array&lt;int&gt; p_indexes =
<a name="l00744"></a>00744           outArgs.get_DfDp_mp(i).getDerivativeMultiVector().getParamIndexes();
<a name="l00745"></a>00745         Teuchos::RCP&lt;ParamVec&gt; p_vec;
<a name="l00746"></a>00746         <span class="keywordflow">if</span> (p_indexes.size() == 0)
<a name="l00747"></a>00747           p_vec = Teuchos::rcp(&amp;<a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i],<span class="keyword">false</span>);
<a name="l00748"></a>00748         <span class="keywordflow">else</span> {
<a name="l00749"></a>00749           p_vec = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="Albany__DataTypes_8hpp.html#aa17b892cdb0cb1ec55119bb8b01cb49e">ParamVec</a>);
<a name="l00750"></a>00750           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;p_indexes.size(); j++)
<a name="l00751"></a>00751             p_vec-&gt;addParam(<a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i][p_indexes[j]].family,
<a name="l00752"></a>00752                             <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>[i][p_indexes[j]].baseValue);
<a name="l00753"></a>00753         }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755         <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;computeGlobalMPTangent(0.0, 0.0, 0.0, curr_time, <span class="keyword">false</span>,
<a name="l00756"></a>00756                                     x_dot_mp.get(), x_dotdot_mp.get(), *x_mp,
<a name="l00757"></a>00757                                     <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, p_mp_index, <a class="code" href="classAlbany_1_1ModelEvaluator.html#ababf8e2481c37d6f11547aca400e0198" title="Multi-point parameters.">p_mp_vals</a>,
<a name="l00758"></a>00758                                     p_vec.get(), NULL, NULL, NULL, NULL,
<a name="l00759"></a>00759                                     f_mp.get(), NULL, dfdp_mp.get());
<a name="l00760"></a>00760 
<a name="l00761"></a>00761         f_mp_computed = <span class="keyword">true</span>;
<a name="l00762"></a>00762       }
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     <span class="keywordflow">if</span> (f_mp != Teuchos::null &amp;&amp; !f_mp_computed)
<a name="l00766"></a>00766       <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;computeGlobalMPResidual(curr_time, x_dot_mp.get(), x_dotdot_mp.get(), *x_mp, 
<a name="l00767"></a>00767            <a class="code" href="classAlbany_1_1ModelEvaluator.html#af9d86cd71f7d759bf19a0e21af611c9c" title="Sacado parameter vector.">sacado_param_vec</a>, p_mp_index, <a class="code" href="classAlbany_1_1ModelEvaluator.html#ababf8e2481c37d6f11547aca400e0198" title="Multi-point parameters.">p_mp_vals</a>,
<a name="l00768"></a>00768            *f_mp);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770     <span class="comment">// Response functions</span>
<a name="l00771"></a>00771     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;outArgs.Ng(); i++) {
<a name="l00772"></a>00772       mp_vector_t g_mp = outArgs.get_g_mp(i);
<a name="l00773"></a>00773       <span class="keywordtype">bool</span> g_mp_computed = <span class="keyword">false</span>;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775       MPDerivative dgdx_mp = outArgs.get_DgDx_mp(i);
<a name="l00776"></a>00776       MPDerivative dgdxdot_mp = outArgs.get_DgDx_dot_mp(i);
<a name="l00777"></a>00777       MPDerivative dgdxdotdot_mp = outArgs.get_DgDx_dotdot_mp(i);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779       <span class="comment">// dg/dx, dg/dxdot</span>
<a name="l00780"></a>00780       <span class="keywordflow">if</span> (!dgdx_mp.isEmpty() || !dgdxdot_mp.isEmpty() || !dgdxdotdot_mp.isEmpty() ) {
<a name="l00781"></a>00781         <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;evaluateMPResponseDerivative(
<a name="l00782"></a>00782             i, curr_time, x_dot_mp.get(), x_dotdot_mp.get(), *x_mp,
<a name="l00783"></a>00783             sacado_param_vec, p_mp_index, p_mp_vals,
<a name="l00784"></a>00784             NULL, g_mp.get(), dgdx_mp,
<a name="l00785"></a>00785             dgdxdot_mp, dgdxdotdot_mp, MPDerivative());
<a name="l00786"></a>00786         g_mp_computed = <span class="keyword">true</span>;
<a name="l00787"></a>00787       }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789       <span class="comment">// dg/dp</span>
<a name="l00790"></a>00790       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;outArgs.Np(); j++) {
<a name="l00791"></a>00791         Teuchos::RCP&lt; Stokhos::ProductEpetraMultiVector &gt; dgdp_mp =
<a name="l00792"></a>00792           outArgs.get_DgDp_mp(i,j).getMultiVector();
<a name="l00793"></a>00793         <span class="keywordflow">if</span> (dgdp_mp != Teuchos::null) {
<a name="l00794"></a>00794           Teuchos::Array&lt;int&gt; p_indexes =
<a name="l00795"></a>00795             outArgs.get_DgDp_mp(i,j).getDerivativeMultiVector().getParamIndexes();
<a name="l00796"></a>00796           Teuchos::RCP&lt;ParamVec&gt; p_vec;
<a name="l00797"></a>00797           <span class="keywordflow">if</span> (p_indexes.size() == 0)
<a name="l00798"></a>00798             p_vec = Teuchos::rcp(&amp;sacado_param_vec[j],<span class="keyword">false</span>);
<a name="l00799"></a>00799           <span class="keywordflow">else</span> {
<a name="l00800"></a>00800             p_vec = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="Albany__DataTypes_8hpp.html#aa17b892cdb0cb1ec55119bb8b01cb49e">ParamVec</a>);
<a name="l00801"></a>00801             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;p_indexes.size(); k++)
<a name="l00802"></a>00802               p_vec-&gt;addParam(sacado_param_vec[j][p_indexes[k]].family,
<a name="l00803"></a>00803                               sacado_param_vec[j][p_indexes[k]].baseValue);
<a name="l00804"></a>00804           }
<a name="l00805"></a>00805           <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;evaluateMPResponseTangent(i, alpha, beta, omega, curr_time, <span class="keyword">false</span>,
<a name="l00806"></a>00806                                          x_dot_mp.get(), x_dotdot_mp.get(), *x_mp,
<a name="l00807"></a>00807                                          sacado_param_vec, p_mp_index,
<a name="l00808"></a>00808                                          p_mp_vals, p_vec.get(),
<a name="l00809"></a>00809                                          NULL, NULL, NULL, NULL, g_mp.get(),
<a name="l00810"></a>00810                                          NULL, dgdp_mp.get());
<a name="l00811"></a>00811           g_mp_computed = <span class="keyword">true</span>;
<a name="l00812"></a>00812         }
<a name="l00813"></a>00813       }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815       <span class="keywordflow">if</span> (g_mp != Teuchos::null &amp;&amp; !g_mp_computed)
<a name="l00816"></a>00816   <a class="code" href="classAlbany_1_1ModelEvaluator.html#ab408d78fdc21b5b2f634fe7189007ad9" title="Application object.">app</a>-&gt;evaluateMPResponse(i, curr_time, x_dot_mp.get(), x_dotdot_mp.get(), *x_mp, 
<a name="l00817"></a>00817         sacado_param_vec, p_mp_index, p_mp_vals, 
<a name="l00818"></a>00818         *g_mp);
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820   }
<a name="l00821"></a>00821 <span class="preprocessor">#endif //ALBANY_SG_MP</span>
<a name="l00822"></a>00822 <span class="preprocessor"></span>}
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Mar 26 2014 18:36:36 for Albany: a Trilinos-based PDE code by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
