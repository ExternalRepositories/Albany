<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Albany: a Trilinos-based PDE code: Albany_GenericSTKMeshStruct.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>Albany_GenericSTKMeshStruct.cpp</h1>  </div>
</div>
<div class="contents">
<a href="Albany__GenericSTKMeshStruct_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//*****************************************************************//</span>
<a name="l00002"></a>00002 <span class="comment">//    Albany 2.0:  Copyright 2012 Sandia Corporation               //</span>
<a name="l00003"></a>00003 <span class="comment">//    This Software is released under the BSD license detailed     //</span>
<a name="l00004"></a>00004 <span class="comment">//    in the file &quot;license.txt&quot; in the top-level Albany directory  //</span>
<a name="l00005"></a>00005 <span class="comment">//*****************************************************************//</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="Albany__GenericSTKMeshStruct_8hpp.html">Albany_GenericSTKMeshStruct.hpp</a>&quot;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="Albany__OrdinarySTKFieldContainer_8hpp.html">Albany_OrdinarySTKFieldContainer.hpp</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="Albany__MultiSTKFieldContainer_8hpp.html">Albany_MultiSTKFieldContainer.hpp</a>&quot;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="preprocessor">#ifdef ALBANY_SEACAS</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stk_io/IossBridge.hpp&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#endif</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="Albany__Utils_8hpp.html">Albany_Utils.hpp</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;stk_mesh/base/GetEntities.hpp&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;stk_mesh/fem/CreateAdjacentEntities.hpp&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="comment">// Rebalance </span>
<a name="l00024"></a>00024 <span class="preprocessor">#ifdef ALBANY_ZOLTAN</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stk_rebalance/Rebalance.hpp&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;stk_rebalance/Partition.hpp&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;stk_rebalance/ZoltanPartition.hpp&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;stk_rebalance_utils/RebalanceUtils.hpp&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#endif</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="comment">// Refinement</span>
<a name="l00032"></a>00032 <span class="preprocessor">#ifdef ALBANY_STK_PERCEPT</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stk_adapt/UniformRefiner.hpp&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stk_adapt/UniformRefinerPattern.hpp&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#endif</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a>00037 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00038"></a><a class="code" href="Albany__GenericSTKMeshStruct_8cpp.html#a08aa4277274ca44febdc2807beba152f">00038</a> <a class="code" href="Albany__GenericSTKMeshStruct_8cpp.html#a08aa4277274ca44febdc2807beba152f">printCTD</a>(<span class="keyword">const</span> CellTopologyData &amp; t )
<a name="l00039"></a>00039 {
<a name="l00040"></a>00040   std::cout &lt;&lt; t.name ;
<a name="l00041"></a>00041   std::cout &lt;&lt; <span class="stringliteral">&quot; { D = &quot;</span> &lt;&lt; t.dimension ;
<a name="l00042"></a>00042   std::cout &lt;&lt; <span class="stringliteral">&quot; , NV = &quot;</span> &lt;&lt; t.vertex_count ;
<a name="l00043"></a>00043   std::cout &lt;&lt; <span class="stringliteral">&quot; , K = 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; t.key &lt;&lt; std::dec ;
<a name="l00044"></a>00044   std::cout &lt;&lt; std::endl ;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046   <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> d = 0 ; d &lt; 4 ; ++d ) {
<a name="l00047"></a>00047     <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> i = 0 ; i &lt; t.subcell_count[d] ; ++i ) {
<a name="l00048"></a>00048 
<a name="l00049"></a>00049       <span class="keyword">const</span> CellTopologyData_Subcell &amp; sub = t.subcell[d][i] ;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051       std::cout &lt;&lt; <span class="stringliteral">&quot;  subcell[&quot;</span> &lt;&lt; d &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;] = { &quot;</span> ;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053       std::cout &lt;&lt; sub.topology-&gt;name ;
<a name="l00054"></a>00054       std::cout &lt;&lt; <span class="stringliteral">&quot; ,&quot;</span> ;
<a name="l00055"></a>00055       <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> j = 0 ; j &lt; sub.topology-&gt;node_count ; ++j ) {
<a name="l00056"></a>00056         std::cout &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; sub.node[j] ;
<a name="l00057"></a>00057       }
<a name="l00058"></a>00058       std::cout &lt;&lt; <span class="stringliteral">&quot; }&quot;</span> &lt;&lt; std::endl ;
<a name="l00059"></a>00059     }
<a name="l00060"></a>00060   }
<a name="l00061"></a>00061 
<a name="l00062"></a>00062   std::cout &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; std::endl &lt;&lt; std::endl ;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a7e0f7b94a6a5309958c635b8558989a2">00066</a> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a7e0f7b94a6a5309958c635b8558989a2">Albany::GenericSTKMeshStruct::GenericSTKMeshStruct</a>(
<a name="l00067"></a>00067     <span class="keyword">const</span> Teuchos::RCP&lt;Teuchos::ParameterList&gt;&amp; params_,
<a name="l00068"></a>00068     <span class="keyword">const</span> Teuchos::RCP&lt;Teuchos::ParameterList&gt;&amp; adaptParams_,
<a name="l00069"></a>00069     <span class="keywordtype">int</span> numDim_)
<a name="l00070"></a>00070     : params(params_),
<a name="l00071"></a>00071       adaptParams(adaptParams_),
<a name="l00072"></a>00072       buildEMesh(false),
<a name="l00073"></a>00073       uniformRefinementInitialized(false)
<a name="l00074"></a>00074 <span class="comment">//      , out(Teuchos::VerboseObjectBase::getDefaultOStream())</span>
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076 
<a name="l00077"></a>00077   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a> = <span class="keyword">new</span> stk::mesh::fem::FEMMetaData();
<a name="l00078"></a>00078 
<a name="l00079"></a>00079   <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a79e6b7eb88b97c07767ed5ee673bed5b" title="Determine if a percept mesh object is needed.">buildEMesh</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a69a3faef6b4f7638255a3feb779ed914">buildPerceptEMesh</a>();
<a name="l00080"></a>00080 
<a name="l00081"></a>00081   <span class="comment">// numDim = -1 is default flag value to postpone initialization</span>
<a name="l00082"></a>00082   <span class="keywordflow">if</span> (numDim_&gt;0) {
<a name="l00083"></a>00083     this-&gt;<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a302b929f043c676f028876f393978787">numDim</a> = numDim_;
<a name="l00084"></a>00084     std::vector&lt;std::string&gt; entity_rank_names = stk::mesh::fem::entity_rank_names(numDim_);
<a name="l00085"></a>00085     <span class="comment">// eMesh needs &quot;FAMILY_TREE&quot; entity</span>
<a name="l00086"></a>00086     <span class="keywordflow">if</span>(<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a79e6b7eb88b97c07767ed5ee673bed5b" title="Determine if a percept mesh object is needed.">buildEMesh</a>)
<a name="l00087"></a>00087       entity_rank_names.push_back(<span class="stringliteral">&quot;FAMILY_TREE&quot;</span>);
<a name="l00088"></a>00088     <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;FEM_initialize(numDim_, entity_rank_names);
<a name="l00089"></a>00089   }
<a name="l00090"></a>00090 
<a name="l00091"></a>00091   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a69d84e0494e6ab2a2c78201c8d5224fa">interleavedOrdering</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get(<span class="stringliteral">&quot;Interleaved Ordering&quot;</span>,<span class="keyword">true</span>);
<a name="l00092"></a>00092   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a13d830e2ad5e2cfb46d05451e40f2415">allElementBlocksHaveSamePhysics</a> = <span class="keyword">true</span>; 
<a name="l00093"></a>00093   <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a4640eff6761ddaf2c669e55b510a7ecf">compositeTet</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Use Composite Tet 10&quot;</span>, <span class="keyword">false</span>);
<a name="l00094"></a>00094   
<a name="l00095"></a>00095   <span class="comment">// This is typical, can be resized for multiple material problems</span>
<a name="l00096"></a>00096   <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#aa5b51847bf2f760e188e953d00d250e9">meshSpecs</a>.resize(1);
<a name="l00097"></a>00097 
<a name="l00098"></a>00098   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a> = NULL;
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a160bba4c65644059e1d782c7929f3b4b">00101</a> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a160bba4c65644059e1d782c7929f3b4b">Albany::GenericSTKMeshStruct::~GenericSTKMeshStruct</a>()
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103   <span class="keyword">delete</span> <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>;
<a name="l00104"></a>00104   <span class="keyword">delete</span> <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>;
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#ae82d1109009b447cbc774991cd23d8dd">00107</a> <span class="keywordtype">void</span> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#ae82d1109009b447cbc774991cd23d8dd">Albany::GenericSTKMeshStruct::SetupFieldData</a>(
<a name="l00108"></a>00108       <span class="keyword">const</span> Teuchos::RCP&lt;const Epetra_Comm&gt;&amp; <a class="code" href="felix__driver_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>,
<a name="l00109"></a>00109                   <span class="keyword">const</span> <span class="keywordtype">int</span> neq_,
<a name="l00110"></a>00110                   <span class="keyword">const</span> <a class="code" href="classAlbany_1_1AbstractFieldContainer.html#a2bfe39ada257455a2bbe082a0b743704">AbstractFieldContainer::FieldContainerRequirements</a>&amp; req,
<a name="l00111"></a>00111                   <span class="keyword">const</span> Teuchos::RCP&lt;Albany::StateInfoStruct&gt;&amp; <a class="code" href="InterfaceTry_8cpp.html#a22a797db574d6de7b11c63d19b59ce22">sis</a>,
<a name="l00112"></a>00112                   <span class="keyword">const</span> <span class="keywordtype">int</span> worksetSize) 
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114   TEUCHOS_TEST_FOR_EXCEPTION(!<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;is_FEM_initialized(),
<a name="l00115"></a>00115        std::logic_error,
<a name="l00116"></a>00116        <span class="stringliteral">&quot;LogicError: metaData-&gt;FEM_initialize(numDim) not yet called&quot;</span> &lt;&lt; std::endl);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#af8cd56ae8f9776c957c4d074e66a8d8b">neq</a> = neq_;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120   this-&gt;<a class="code" href="structAlbany_1_1AbstractMeshStruct.html#a89984a7cc2754421e2475089899c4b20">nodal_data_block</a> = sis-&gt;getNodalDataBlock();
<a name="l00121"></a>00121 
<a name="l00122"></a>00122   <span class="keywordflow">if</span> (<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a> == NULL)
<a name="l00123"></a>00123 
<a name="l00124"></a>00124      <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a> = <span class="keyword">new</span> stk::mesh::BulkData(stk::mesh::fem::FEMMetaData::get_meta_data(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>),
<a name="l00125"></a>00125                           <a class="code" href="namespaceAlbany.html#a15bbfa6de65c4c7e0314fb5589e7d041">Albany::getMpiCommFromEpetraComm</a>(*comm), worksetSize );
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 <span class="preprocessor">#ifdef ALBANY_LCM</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span>  <span class="comment">// If adaptation in LCM, create a new part for boundary</span>
<a name="l00129"></a>00129   <span class="keywordflow">if</span> (<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a306ced47bdffadbbb41174f84d7758ab" title="The adaptation parameter list (null if the problem isn&amp;#39;t adaptive).">adaptParams</a>.is_null() == <span class="keyword">false</span>) {
<a name="l00130"></a>00130     stk::mesh::Part &amp;
<a name="l00131"></a>00131     boundary_part = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;declare_part(<span class="stringliteral">&quot;boundary&quot;</span>);
<a name="l00132"></a>00132 <span class="preprocessor">#ifdef ALBANY_SEACAS</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>    stk::io::put_io_part_attribute(boundary_part);
<a name="l00134"></a>00134 <span class="preprocessor">#endif</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>  }
<a name="l00136"></a>00136 <span class="preprocessor">#endif // ALBANY_LCM</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span>
<a name="l00138"></a>00138   <span class="comment">// Build the container for the STK fields</span>
<a name="l00139"></a>00139   Teuchos::Array&lt;std::string&gt; default_solution_vector; <span class="comment">// Empty</span>
<a name="l00140"></a>00140   Teuchos::Array&lt;std::string&gt; solution_vector =
<a name="l00141"></a>00141     <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;Teuchos::Array&lt;std::string&gt; &gt;(<span class="stringliteral">&quot;Solution Vector Components&quot;</span>, default_solution_vector);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143   Teuchos::Array&lt;std::string&gt; default_residual_vector; <span class="comment">// Empty</span>
<a name="l00144"></a>00144   Teuchos::Array&lt;std::string&gt; residual_vector =
<a name="l00145"></a>00145     <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;Teuchos::Array&lt;std::string&gt; &gt;(<span class="stringliteral">&quot;Residual Vector Components&quot;</span>, default_residual_vector);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147   <span class="comment">// Build the usual Albany fields unless the user explicitly specifies the residual or solution vector layout</span>
<a name="l00148"></a>00148   <span class="keywordflow">if</span>(solution_vector.length() == 0 &amp;&amp; residual_vector.length() == 0){
<a name="l00149"></a>00149 
<a name="l00150"></a>00150       <span class="keywordflow">if</span>(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a69d84e0494e6ab2a2c78201c8d5224fa">interleavedOrdering</a>)
<a name="l00151"></a>00151         this-&gt;<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#aeb01f5da92ae994535ad182db65d0841">fieldContainer</a> = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="classAlbany_1_1OrdinarySTKFieldContainer.html">Albany::OrdinarySTKFieldContainer&lt;true&gt;</a>(<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>, 
<a name="l00152"></a>00152             <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>, neq_, req, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a302b929f043c676f028876f393978787">numDim</a>, sis)); 
<a name="l00153"></a>00153       <span class="keywordflow">else</span>
<a name="l00154"></a>00154         this-&gt;<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#aeb01f5da92ae994535ad182db65d0841">fieldContainer</a> = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="classAlbany_1_1OrdinarySTKFieldContainer.html">Albany::OrdinarySTKFieldContainer&lt;false&gt;</a>(<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>,
<a name="l00155"></a>00155             <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>, neq_, req, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a302b929f043c676f028876f393978787">numDim</a>, sis)); 
<a name="l00156"></a>00156 
<a name="l00157"></a>00157   }
<a name="l00158"></a>00158  
<a name="l00159"></a>00159   <span class="keywordflow">else</span> {
<a name="l00160"></a>00160 
<a name="l00161"></a>00161       <span class="keywordflow">if</span>(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a69d84e0494e6ab2a2c78201c8d5224fa">interleavedOrdering</a>)
<a name="l00162"></a>00162         this-&gt;<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#aeb01f5da92ae994535ad182db65d0841">fieldContainer</a> = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="classAlbany_1_1MultiSTKFieldContainer.html">Albany::MultiSTKFieldContainer&lt;true&gt;</a>(<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>, 
<a name="l00163"></a>00163             <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>, neq_, req, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a302b929f043c676f028876f393978787">numDim</a>, sis, solution_vector, residual_vector)); 
<a name="l00164"></a>00164       <span class="keywordflow">else</span>
<a name="l00165"></a>00165         this-&gt;<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#aeb01f5da92ae994535ad182db65d0841">fieldContainer</a> = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="classAlbany_1_1MultiSTKFieldContainer.html">Albany::MultiSTKFieldContainer&lt;false&gt;</a>(<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>,
<a name="l00166"></a>00166             <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>, neq_, req, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a302b929f043c676f028876f393978787">numDim</a>, sis, solution_vector, residual_vector)); 
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 <span class="comment">// Exodus is only for 2D and 3D. Have 1D version as well</span>
<a name="l00171"></a>00171   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#af3d8b175e15475f847e964537e55d5b9">exoOutput</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;isType&lt;std::string&gt;(<span class="stringliteral">&quot;Exodus Output File Name&quot;</span>);
<a name="l00172"></a>00172   <span class="keywordflow">if</span> (<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#af3d8b175e15475f847e964537e55d5b9">exoOutput</a>)
<a name="l00173"></a>00173     <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a9843ad191f958f9e1d9bb94dc00cac23">exoOutFile</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;std::string&gt;(<span class="stringliteral">&quot;Exodus Output File Name&quot;</span>);
<a name="l00174"></a>00174   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#acb98b4c0582f1f461b0cad5a18d74d44">exoOutputInterval</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;Exodus Write Interval&quot;</span>, 1);
<a name="l00175"></a>00175   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#aeb3b18a2d480551f0e35165e21d09afa">cdfOutput</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;isType&lt;std::string&gt;(<span class="stringliteral">&quot;NetCDF Output File Name&quot;</span>);
<a name="l00176"></a>00176   <span class="keywordflow">if</span> (cdfOutput) 
<a name="l00177"></a>00177     <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a6074483bcf6055bf55ebea90c2e12d40">cdfOutFile</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;std::string&gt;(<span class="stringliteral">&quot;NetCDF Output File Name&quot;</span>);
<a name="l00178"></a>00178   
<a name="l00179"></a>00179   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#ad925e7a613b32bc708adc74729bbf6ae">nLat</a>       =  <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get(<span class="stringliteral">&quot;NetCDF Output Number of Latitudes&quot;</span>,100);
<a name="l00180"></a>00180   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#aa22abc35de95a63c79b28348a73df692">nLon</a>       =  <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get(<span class="stringliteral">&quot;NetCDF Output Number of Longitudes&quot;</span>,100);
<a name="l00181"></a>00181   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#aea36c7c68f5b1f31f8a533d29b3f64e1">cdfOutputInterval</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NetCDF Write Interval&quot;</span>, 1);
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <span class="comment">//get the type of transformation of STK mesh (for FELIX problems)</span>
<a name="l00185"></a>00185   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a3abc585cd24fb2ef8bef4ac7fd55b0a7">transformType</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get(<span class="stringliteral">&quot;Transform Type&quot;</span>, <span class="stringliteral">&quot;None&quot;</span>); <span class="comment">//get the type of transformation of STK mesh (for FELIX problems)</span>
<a name="l00186"></a>00186   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a883f9c7044622ed3a484e414d5e4c603">felixAlpha</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get(<span class="stringliteral">&quot;FELIX alpha&quot;</span>, 0.0); 
<a name="l00187"></a>00187   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#ac217b3014260a6c108c5e8399b5b4410">felixL</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get(<span class="stringliteral">&quot;FELIX L&quot;</span>, 1.0); 
<a name="l00188"></a>00188  
<a name="l00189"></a>00189   <span class="comment">//boolean specifying if ascii mesh has contiguous IDs; only used for ascii meshes on 1 processor</span>
<a name="l00190"></a>00190   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a9ed544cc418a925a8eb60b6b70b388bd">contigIDs</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get(<span class="stringliteral">&quot;Contiguous IDs&quot;</span>, <span class="keyword">true</span>);
<a name="l00191"></a>00191  
<a name="l00192"></a>00192   <span class="comment">//Does user want to write coordinates to matrix market file (e.g., for ML analysis)? </span>
<a name="l00193"></a>00193   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a31f76183bd991dfa1f8f7a342ec8b551">writeCoordsToMMFile</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get(<span class="stringliteral">&quot;Write Coordinates to MatrixMarket&quot;</span>, <span class="keyword">false</span>); 
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#ab2f0ee0b9e0ade83c183c938d68232fc">transferSolutionToCoords</a> = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Transfer Solution to Coordinates&quot;</span>, <span class="keyword">false</span>);
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 <span class="preprocessor">#ifdef ALBANY_STK_PERCEPT</span>
<a name="l00198"></a>00198 <span class="preprocessor"></span>  <span class="comment">// Build the eMesh if needed</span>
<a name="l00199"></a>00199   <span class="keywordflow">if</span>(<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a79e6b7eb88b97c07767ed5ee673bed5b" title="Determine if a percept mesh object is needed.">buildEMesh</a>)
<a name="l00200"></a>00200 
<a name="l00201"></a>00201    eMesh = Teuchos::rcp(<span class="keyword">new</span> stk::percept::PerceptMesh(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>, <span class="keyword">false</span>));
<a name="l00202"></a>00202 
<a name="l00203"></a>00203   <span class="comment">// Build  the requested refiners </span>
<a name="l00204"></a>00204   <span class="keywordflow">if</span>(!eMesh.is_null()){
<a name="l00205"></a>00205 
<a name="l00206"></a>00206    <span class="keywordflow">if</span>(<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a8cd1b8dc787365f7ea6234a76748f7d2">buildUniformRefiner</a>()) <span class="comment">// cant currently build both types of refiners (FIXME)</span>
<a name="l00207"></a>00207 
<a name="l00208"></a>00208       <span class="keywordflow">return</span>;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210    <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a3b25bd7db0d329736acfd651f568fe25">buildLocalRefiner</a>();
<a name="l00211"></a>00211 
<a name="l00212"></a>00212   }
<a name="l00213"></a>00213 <span class="preprocessor">#endif</span>
<a name="l00214"></a>00214 <span class="preprocessor"></span>
<a name="l00215"></a>00215 }
<a name="l00216"></a>00216 
<a name="l00217"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a69a3faef6b4f7638255a3feb779ed914">00217</a> <span class="keywordtype">bool</span> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a69a3faef6b4f7638255a3feb779ed914">Albany::GenericSTKMeshStruct::buildPerceptEMesh</a>(){
<a name="l00218"></a>00218 
<a name="l00219"></a>00219    <span class="comment">// If there exists a nonempty &quot;refine&quot;, &quot;convert&quot;, or &quot;enrich&quot; string</span>
<a name="l00220"></a>00220     std::string refine = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;std::string&gt;(<span class="stringliteral">&quot;STK Initial Refine&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00221"></a>00221     <span class="keywordflow">if</span>(refine.length() &gt; 0) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00222"></a>00222     std::string convert = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;std::string&gt;(<span class="stringliteral">&quot;STK Initial Enrich&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00223"></a>00223     <span class="keywordflow">if</span>(convert.length() &gt; 0) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00224"></a>00224     std::string enrich = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;std::string&gt;(<span class="stringliteral">&quot;STK Initial Convert&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00225"></a>00225     <span class="keywordflow">if</span>(enrich.length() &gt; 0) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="comment">// Or, if a percept mesh is needed to support general adaptation indicated in the &quot;Adaptation&quot; sublist</span>
<a name="l00228"></a>00228     <span class="keywordflow">if</span>(!<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a306ced47bdffadbbb41174f84d7758ab" title="The adaptation parameter list (null if the problem isn&amp;#39;t adaptive).">adaptParams</a>.is_null()){
<a name="l00229"></a>00229 
<a name="l00230"></a>00230       std::string&amp; method = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a306ced47bdffadbbb41174f84d7758ab" title="The adaptation parameter list (null if the problem isn&amp;#39;t adaptive).">adaptParams</a>-&gt;get(<span class="stringliteral">&quot;Method&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232       <span class="keywordflow">if</span> (method == <span class="stringliteral">&quot;Unif Size&quot;</span>)
<a name="l00233"></a>00233         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235     }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00241"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a8cd1b8dc787365f7ea6234a76748f7d2">00241</a> <span class="keywordtype">bool</span> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a8cd1b8dc787365f7ea6234a76748f7d2">Albany::GenericSTKMeshStruct::buildUniformRefiner</a>(){
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 <span class="preprocessor">#ifdef ALBANY_STK_PERCEPT</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span>
<a name="l00245"></a>00245     stk::adapt::BlockNamesType block_names(stk::percept::EntityRankEnd+1u);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247     std::string refine = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;std::string&gt;(<span class="stringliteral">&quot;STK Initial Refine&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00248"></a>00248     std::string convert = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;std::string&gt;(<span class="stringliteral">&quot;STK Initial Convert&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00249"></a>00249     std::string enrich = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;std::string&gt;(<span class="stringliteral">&quot;STK Initial Enrich&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251     std::string convert_options = stk::adapt::UniformRefinerPatternBase::s_convert_options;
<a name="l00252"></a>00252     std::string refine_options  = stk::adapt::UniformRefinerPatternBase::s_refine_options;
<a name="l00253"></a>00253     std::string enrich_options  = stk::adapt::UniformRefinerPatternBase::s_enrich_options;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     <span class="comment">// Has anything been specified?</span>
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="keywordflow">if</span>(refine.length() == 0 &amp;&amp; convert.length() == 0 &amp;&amp; enrich.length() == 0)
<a name="l00258"></a>00258 
<a name="l00259"></a>00259        <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     <span class="keywordflow">if</span> (refine.length())
<a name="l00262"></a>00262 
<a name="l00263"></a>00263       <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#ac9820167de24c5bf68489128a3bb387e" title="Perform initial adaptation input checking.">checkInput</a>(<span class="stringliteral">&quot;refine&quot;</span>, refine, refine_options);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     <span class="keywordflow">if</span> (convert.length())
<a name="l00266"></a>00266 
<a name="l00267"></a>00267       <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#ac9820167de24c5bf68489128a3bb387e" title="Perform initial adaptation input checking.">checkInput</a>(<span class="stringliteral">&quot;convert&quot;</span>, convert, convert_options);
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     <span class="keywordflow">if</span> (enrich.length())
<a name="l00270"></a>00270 
<a name="l00271"></a>00271       <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#ac9820167de24c5bf68489128a3bb387e" title="Perform initial adaptation input checking.">checkInput</a>(<span class="stringliteral">&quot;enrich&quot;</span>, enrich, enrich_options);
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     refinerPattern = stk::adapt::UniformRefinerPatternBase::createPattern(refine, enrich, convert, *eMesh, block_names);
<a name="l00274"></a>00274     <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#ac448099e33faad3776ea91abd8c1dbfe">uniformRefinementInitialized</a> = <span class="keyword">true</span>;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="preprocessor">#else</span>
<a name="l00279"></a>00279 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00280"></a>00280 <span class="preprocessor">#endif</span>
<a name="l00281"></a>00281 <span class="preprocessor"></span>
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00284"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a3b25bd7db0d329736acfd651f568fe25">00284</a> <span class="keywordtype">bool</span> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a3b25bd7db0d329736acfd651f568fe25">Albany::GenericSTKMeshStruct::buildLocalRefiner</a>(){
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="preprocessor">#ifdef ALBANY_STK_PERCEPT</span>
<a name="l00287"></a>00287 <span class="preprocessor"></span>
<a name="l00288"></a>00288     <span class="keywordflow">if</span>(<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a306ced47bdffadbbb41174f84d7758ab" title="The adaptation parameter list (null if the problem isn&amp;#39;t adaptive).">adaptParams</a>.is_null()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 <span class="comment">//    stk::adapt::BlockNamesType block_names = stk::adapt::BlockNamesType();</span>
<a name="l00291"></a>00291     stk::adapt::BlockNamesType block_names(stk::percept::EntityRankEnd+1u);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     std::string adapt_method = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a306ced47bdffadbbb41174f84d7758ab" title="The adaptation parameter list (null if the problem isn&amp;#39;t adaptive).">adaptParams</a>-&gt;get&lt;std::string&gt;(<span class="stringliteral">&quot;Method&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     <span class="comment">// Check if adaptation was specified</span>
<a name="l00296"></a>00296     <span class="keywordflow">if</span>(adapt_method.length() == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>; 
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     std::string pattern = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a306ced47bdffadbbb41174f84d7758ab" title="The adaptation parameter list (null if the problem isn&amp;#39;t adaptive).">adaptParams</a>-&gt;get&lt;std::string&gt;(<span class="stringliteral">&quot;Refiner Pattern&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keywordflow">if</span>(pattern == <span class="stringliteral">&quot;Local_Tet4_Tet4_N&quot;</span>){
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 <span class="comment">//      refinerPattern = Teuchos::rcp(new stk::adapt::Local_Tet4_Tet4_N(*eMesh, block_names));</span>
<a name="l00303"></a>00303       refinerPattern = Teuchos::rcp(<span class="keyword">new</span> stk::adapt::Local_Tet4_Tet4_N(*eMesh));
<a name="l00304"></a>00304       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307     <span class="keywordflow">else</span> {
<a name="l00308"></a>00308 
<a name="l00309"></a>00309       TEUCHOS_TEST_FOR_EXCEPTION(<span class="keyword">true</span>, Teuchos::Exceptions::InvalidParameter, std::endl &lt;&lt;
<a name="l00310"></a>00310          <span class="stringliteral">&quot;Error!  Unknown local adaptation pattern in GenericSTKMeshStruct: &quot;</span> &lt;&lt; pattern &lt;&lt;
<a name="l00311"></a>00311          <span class="stringliteral">&quot;!&quot;</span> &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;Supplied parameter list is: &quot;</span> &lt;&lt; std::endl &lt;&lt; *<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a306ced47bdffadbbb41174f84d7758ab" title="The adaptation parameter list (null if the problem isn&amp;#39;t adaptive).">adaptParams</a>
<a name="l00312"></a>00312          &lt;&lt; <span class="stringliteral">&quot;\nValid patterns are: Local_Tet4_Tet4_N&quot;</span> &lt;&lt; std::endl);
<a name="l00313"></a>00313     }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <span class="preprocessor">#endif</span>
<a name="l00317"></a>00317 <span class="preprocessor"></span>
<a name="l00318"></a>00318     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 <span class="keywordtype">void</span> 
<a name="l00323"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a4a4f61de6a24d9180ab8a234c8c532a2">00323</a> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a4a4f61de6a24d9180ab8a234c8c532a2">Albany::GenericSTKMeshStruct::cullSubsetParts</a>(std::vector&lt;std::string&gt;&amp; ssNames, 
<a name="l00324"></a>00324     std::map&lt;std::string, stk::mesh::Part*&gt;&amp; partVec){
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 <span class="comment">/*</span>
<a name="l00327"></a>00327 <span class="comment">When dealing with sideset lists, it is common to have parts that are subsets of other parts, like:</span>
<a name="l00328"></a>00328 <span class="comment">Part[ surface_12 , 18 ] {</span>
<a name="l00329"></a>00329 <span class="comment">  Supersets { {UNIVERSAL} }</span>
<a name="l00330"></a>00330 <span class="comment">  Intersection_Of { } }</span>
<a name="l00331"></a>00331 <span class="comment">  Subsets { surface_quad4_edge2d2_12 }</span>
<a name="l00332"></a>00332 <span class="comment"></span>
<a name="l00333"></a>00333 <span class="comment">Part[ surface_quad4_edge2d2_12 , 19 ] {</span>
<a name="l00334"></a>00334 <span class="comment">  Supersets { {UNIVERSAL} {FEM_ROOT_CELL_TOPOLOGY_PART_Line_2} surface_12 }</span>
<a name="l00335"></a>00335 <span class="comment">  Intersection_Of { } }</span>
<a name="l00336"></a>00336 <span class="comment">  Subsets { }</span>
<a name="l00337"></a>00337 <span class="comment"></span>
<a name="l00338"></a>00338 <span class="comment">This function gets rid of the subset in the list. </span>
<a name="l00339"></a>00339 <span class="comment">*/</span>
<a name="l00340"></a>00340 
<a name="l00341"></a>00341   <span class="keyword">using</span> std::map;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343   map&lt;std::string, stk::mesh::Part*&gt;::iterator it;
<a name="l00344"></a>00344   std::vector&lt;stk::mesh::Part*&gt;::const_iterator p;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346   <span class="keywordflow">for</span>(it = partVec.begin(); it != partVec.end(); ++it){ <span class="comment">// loop over the parts in the map</span>
<a name="l00347"></a>00347 
<a name="l00348"></a>00348     <span class="comment">// for each part in turn, get the name of parts that are a subset of it</span>
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <span class="keyword">const</span> stk::mesh::PartVector &amp; subsets   = it-&gt;second-&gt;subsets();
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     <span class="keywordflow">for</span> ( p = subsets.begin() ; p != subsets.end() ; ++p ) {
<a name="l00353"></a>00353       <span class="keyword">const</span> std::string &amp; <a class="code" href="MOR__ExtendedEpetraLapack_8cpp.html#af5da5165aa5eeff113accece5748c995">n</a> = (*p)-&gt;name();
<a name="l00354"></a>00354 <span class="comment">//      std::cout &lt;&lt; &quot;Erasing: &quot; &lt;&lt; n &lt;&lt; std::endl;</span>
<a name="l00355"></a>00355       partVec.erase(n); <span class="comment">// erase it if it is in the base map</span>
<a name="l00356"></a>00356     }
<a name="l00357"></a>00357   }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359 <span class="comment">//  ssNames.clear();</span>
<a name="l00360"></a>00360 
<a name="l00361"></a>00361   <span class="comment">// Build the remaining data structures</span>
<a name="l00362"></a>00362   <span class="keywordflow">for</span>(it = partVec.begin(); it != partVec.end(); ++it){ <span class="comment">// loop over the parts in the map</span>
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     std::string ssn = it-&gt;first;
<a name="l00365"></a>00365     ssNames.push_back(ssn);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367   }
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 Teuchos::ArrayRCP&lt;Teuchos::RCP&lt;Albany::MeshSpecsStruct&gt; &gt;&amp;
<a name="l00372"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#acd4965d539587e65829b88e25896387c">00372</a> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#acd4965d539587e65829b88e25896387c">Albany::GenericSTKMeshStruct::getMeshSpecs</a>()
<a name="l00373"></a>00373 {
<a name="l00374"></a>00374   TEUCHOS_TEST_FOR_EXCEPTION(<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#aa5b51847bf2f760e188e953d00d250e9">meshSpecs</a>==Teuchos::null,
<a name="l00375"></a>00375        std::logic_error,
<a name="l00376"></a>00376        <span class="stringliteral">&quot;meshSpecs accessed, but it has not been constructed&quot;</span> &lt;&lt; std::endl);
<a name="l00377"></a>00377   <span class="keywordflow">return</span> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#aa5b51847bf2f760e188e953d00d250e9">meshSpecs</a>;
<a name="l00378"></a>00378 }
<a name="l00379"></a>00379 
<a name="l00380"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a65a072dfa4df218a71f3ea0f88b6fdd2">00380</a> <span class="keywordtype">int</span> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a65a072dfa4df218a71f3ea0f88b6fdd2" title="Utility function that uses some integer arithmetic to choose a good worksetSize.">Albany::GenericSTKMeshStruct::computeWorksetSize</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> worksetSizeMax,
<a name="l00381"></a>00381                                                      <span class="keyword">const</span> <span class="keywordtype">int</span> ebSizeMax)<span class="keyword"> const</span>
<a name="l00382"></a>00382 <span class="keyword"></span>{
<a name="l00383"></a>00383   <span class="comment">// Resize workset size down to maximum number in an element block</span>
<a name="l00384"></a>00384   <span class="keywordflow">if</span> (worksetSizeMax &gt; ebSizeMax || worksetSizeMax &lt; 1) <span class="keywordflow">return</span> ebSizeMax;
<a name="l00385"></a>00385   <span class="keywordflow">else</span> {
<a name="l00386"></a>00386      <span class="comment">// compute numWorksets, and shrink workset size to minimize padding</span>
<a name="l00387"></a>00387      <span class="keyword">const</span> <span class="keywordtype">int</span> numWorksets = 1 + (ebSizeMax-1) / worksetSizeMax;
<a name="l00388"></a>00388      <span class="keywordflow">return</span> (1 + (ebSizeMax-1) /  numWorksets);
<a name="l00389"></a>00389   }
<a name="l00390"></a>00390 }
<a name="l00391"></a>00391 
<a name="l00392"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#abf7d0c9a9ce08fcdf4b722ca3d051dec">00392</a> <span class="keywordtype">void</span> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#abf7d0c9a9ce08fcdf4b722ca3d051dec" title="Rebuild the mesh with elem-&amp;gt;face-&amp;gt;segment-&amp;gt;node connectivity for adaptation.">Albany::GenericSTKMeshStruct::computeAddlConnectivity</a>()
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394 
<a name="l00395"></a>00395   <span class="keywordflow">if</span>(<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a306ced47bdffadbbb41174f84d7758ab" title="The adaptation parameter list (null if the problem isn&amp;#39;t adaptive).">adaptParams</a>.is_null()) <span class="keywordflow">return</span>;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   std::string&amp; method = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a306ced47bdffadbbb41174f84d7758ab" title="The adaptation parameter list (null if the problem isn&amp;#39;t adaptive).">adaptParams</a>-&gt;get(<span class="stringliteral">&quot;Method&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00398"></a>00398 
<a name="l00399"></a>00399   <span class="comment">// Mesh fracture requires full mesh connectivity, created here</span>
<a name="l00400"></a>00400   <span class="keywordflow">if</span>(method == <span class="stringliteral">&quot;Topmod&quot;</span> || method == <span class="stringliteral">&quot;Random&quot;</span>){ 
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     stk::mesh::PartVector add_parts;
<a name="l00403"></a>00403     stk::mesh::create_adjacent_entities(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>, add_parts);
<a name="l00404"></a>00404   
<a name="l00405"></a>00405     <a class="code" href="namespaceAAdapt.html#a3c520a41b4eeda67a27eaa620a369bc4">stk::mesh::EntityRank</a> elementRank = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;element_rank();
<a name="l00406"></a>00406     <a class="code" href="namespaceAAdapt.html#a3c520a41b4eeda67a27eaa620a369bc4">stk::mesh::EntityRank</a> nodeRank = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;node_rank();
<a name="l00407"></a>00407     <a class="code" href="namespaceAAdapt.html#a3c520a41b4eeda67a27eaa620a369bc4">stk::mesh::EntityRank</a> sideRank = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;side_rank();
<a name="l00408"></a>00408   
<a name="l00409"></a>00409     std::vector&lt;stk::mesh::Entity*&gt; element_lst;
<a name="l00410"></a>00410   <span class="comment">//  stk::mesh::get_entities(*(bulkData),elementRank,element_lst);</span>
<a name="l00411"></a>00411     
<a name="l00412"></a>00412     stk::mesh::Selector select_owned_or_shared = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;locally_owned_part() | <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;globally_shared_part();
<a name="l00413"></a>00413     stk::mesh::Selector select_owned = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;locally_owned_part();
<a name="l00414"></a>00414   
<a name="l00415"></a>00415   <span class="comment">/*</span>
<a name="l00416"></a>00416 <span class="comment">        stk::mesh::Selector select_owned_in_part =</span>
<a name="l00417"></a>00417 <span class="comment">        stk::mesh::Selector( metaData-&gt;universal_part() ) &amp;</span>
<a name="l00418"></a>00418 <span class="comment">        stk::mesh::Selector( metaData-&gt;locally_owned_part() );</span>
<a name="l00419"></a>00419 <span class="comment">  </span>
<a name="l00420"></a>00420 <span class="comment">        stk::mesh::get_selected_entities( select_owned_in_part ,</span>
<a name="l00421"></a>00421 <span class="comment">  */</span>
<a name="l00422"></a>00422   
<a name="l00423"></a>00423      <span class="comment">// Loop through only on-processor elements as we are just deleting entities inside the element</span>
<a name="l00424"></a>00424      stk::mesh::get_selected_entities( select_owned,
<a name="l00425"></a>00425         <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;buckets( elementRank ) ,
<a name="l00426"></a>00426         element_lst );
<a name="l00427"></a>00427   
<a name="l00428"></a>00428     <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;modification_begin();
<a name="l00429"></a>00429   
<a name="l00430"></a>00430       <span class="comment">// Remove extra relations from element</span>
<a name="l00431"></a>00431     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; element_lst.size(); ++i){
<a name="l00432"></a>00432         <a class="code" href="namespaceAAdapt.html#a6e672c66f1cfcf2ba9f8baf4a51e0381">stk::mesh::Entity</a> &amp; element = *(element_lst[i]);
<a name="l00433"></a>00433         stk::mesh::PairIterRelation relations = element.relations();
<a name="l00434"></a>00434         std::vector&lt;stk::mesh::Entity*&gt; del_relations;
<a name="l00435"></a>00435         std::vector&lt;int&gt; del_ids;
<a name="l00436"></a>00436         <span class="keywordflow">for</span> (stk::mesh::PairIterRelation::iterator j = relations.begin();
<a name="l00437"></a>00437              j != relations.end(); ++j){
<a name="l00438"></a>00438   
<a name="l00439"></a>00439           <span class="comment">// remove all relationships from element unless to faces(segments</span>
<a name="l00440"></a>00440           <span class="comment">//   in 2D) or nodes </span>
<a name="l00441"></a>00441   
<a name="l00442"></a>00442           <span class="keywordflow">if</span> (
<a name="l00443"></a>00443               j-&gt;entity_rank() != elementRank-1 &amp;&amp; <span class="comment">// element to face relation</span>
<a name="l00444"></a>00444               j-&gt;entity_rank() != nodeRank  
<a name="l00445"></a>00445              ){
<a name="l00446"></a>00446   
<a name="l00447"></a>00447             del_relations.push_back(j-&gt;entity());
<a name="l00448"></a>00448             del_ids.push_back(j-&gt;identifier());
<a name="l00449"></a>00449           }
<a name="l00450"></a>00450         }
<a name="l00451"></a>00451   
<a name="l00452"></a>00452       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; del_relations.size(); ++j){
<a name="l00453"></a>00453         <a class="code" href="namespaceAAdapt.html#a6e672c66f1cfcf2ba9f8baf4a51e0381">stk::mesh::Entity</a> &amp; entity = *(del_relations[j]);
<a name="l00454"></a>00454         <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;destroy_relation(element,entity,del_ids[j]);
<a name="l00455"></a>00455       }
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457   
<a name="l00458"></a>00458     <span class="keywordflow">if</span> (elementRank == 3){
<a name="l00459"></a>00459       <span class="comment">// Remove extra relations from face</span>
<a name="l00460"></a>00460       std::vector&lt;stk::mesh::Entity*&gt; face_lst;
<a name="l00461"></a>00461       <span class="comment">//stk::mesh::get_entities(*(bulkData),elementRank-1,face_lst);</span>
<a name="l00462"></a>00462       <span class="comment">// Loop through all faces visible to this processor, as a face can be visible on two processors</span>
<a name="l00463"></a>00463       stk::mesh::get_selected_entities( select_owned_or_shared,
<a name="l00464"></a>00464                                         <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;buckets( elementRank-1 ) ,
<a name="l00465"></a>00465                                         face_lst );
<a name="l00466"></a>00466       <a class="code" href="namespaceAAdapt.html#a3c520a41b4eeda67a27eaa620a369bc4">stk::mesh::EntityRank</a> entityRank = face_lst[0]-&gt;entity_rank(); <span class="comment">// This is rank 2 always...</span>
<a name="l00467"></a>00467   <span class="comment">//std::cout &lt;&lt; &quot;element rank - 1: &quot; &lt;&lt; elementRank - 1 &lt;&lt; &quot; face rank: &quot; &lt;&lt; entityRank &lt;&lt; std::endl;</span>
<a name="l00468"></a>00468       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; face_lst.size(); ++i){
<a name="l00469"></a>00469         <a class="code" href="namespaceAAdapt.html#a6e672c66f1cfcf2ba9f8baf4a51e0381">stk::mesh::Entity</a> &amp; face = *(face_lst[i]);
<a name="l00470"></a>00470         stk::mesh::PairIterRelation relations = face.relations();
<a name="l00471"></a>00471         std::vector&lt;stk::mesh::Entity*&gt; del_relations;
<a name="l00472"></a>00472         std::vector&lt;int&gt; del_ids;
<a name="l00473"></a>00473         <span class="keywordflow">for</span> (stk::mesh::PairIterRelation::iterator j = relations.begin();
<a name="l00474"></a>00474              j != relations.end(); ++j){
<a name="l00475"></a>00475   
<a name="l00476"></a>00476           <span class="keywordflow">if</span> (
<a name="l00477"></a>00477               j-&gt;entity_rank() != entityRank+1 &amp;&amp; <span class="comment">// face to element relation</span>
<a name="l00478"></a>00478               j-&gt;entity_rank() != entityRank-1 <span class="comment">// &amp;&amp; // face to segment relation</span>
<a name="l00479"></a>00479   <span class="comment">//            j-&gt;entity_rank() != sideRank     ){</span>
<a name="l00480"></a>00480              ){
<a name="l00481"></a>00481   
<a name="l00482"></a>00482             del_relations.push_back(j-&gt;entity());
<a name="l00483"></a>00483             del_ids.push_back(j-&gt;identifier());
<a name="l00484"></a>00484           }
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486   
<a name="l00487"></a>00487         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; del_relations.size(); ++j){
<a name="l00488"></a>00488           <a class="code" href="namespaceAAdapt.html#a6e672c66f1cfcf2ba9f8baf4a51e0381">stk::mesh::Entity</a> &amp; entity = *(del_relations[j]);
<a name="l00489"></a>00489           <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;destroy_relation(face, entity, del_ids[j]);
<a name="l00490"></a>00490   <span class="comment">//std::cout &lt;&lt; &quot;Deleting rank: &quot; &lt;&lt; entity.entity_rank() &lt;&lt; &quot; id: &quot; &lt;&lt; del_ids[j] &lt;&lt; std::endl;</span>
<a name="l00491"></a>00491         }
<a name="l00492"></a>00492       }
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494   
<a name="l00495"></a>00495     <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;modification_end();
<a name="l00496"></a>00496   }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498 }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500 
<a name="l00501"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#aa01a5d16e8407c86406cc34dafed20c1">00501</a> <span class="keywordtype">void</span> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#aa01a5d16e8407c86406cc34dafed20c1" title="Perform initial uniform refinement of the mesh.">Albany::GenericSTKMeshStruct::uniformRefineMesh</a>(<span class="keyword">const</span> Teuchos::RCP&lt;const Epetra_Comm&gt;&amp; <a class="code" href="felix__driver_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>){
<a name="l00502"></a>00502 
<a name="l00503"></a>00503 <span class="preprocessor">#ifdef ALBANY_STK_PERCEPT</span>
<a name="l00504"></a>00504 <span class="preprocessor"></span><span class="comment">// Refine if requested</span>
<a name="l00505"></a>00505   <span class="keywordflow">if</span>(!<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#ac448099e33faad3776ea91abd8c1dbfe">uniformRefinementInitialized</a>) <span class="keywordflow">return</span>;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507   <a class="code" href="classAlbany_1_1AbstractSTKFieldContainer.html#a9f8c0890f03fd3c85d90028183aefcb4">AbstractSTKFieldContainer::IntScalarFieldType</a>* proc_rank_field = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#aeb01f5da92ae994535ad182db65d0841">fieldContainer</a>-&gt;getProcRankField();
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 
<a name="l00510"></a>00510   <span class="keywordflow">if</span>(!refinerPattern.is_null() &amp;&amp; proc_rank_field){
<a name="l00511"></a>00511 
<a name="l00512"></a>00512     stk::adapt::UniformRefiner refiner(*eMesh, *refinerPattern, proc_rank_field);
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     <span class="keywordtype">int</span> numRefinePasses = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;Number of Refinement Passes&quot;</span>, 1);
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> pass = 0; pass &lt; numRefinePasses; pass++){
<a name="l00517"></a>00517 
<a name="l00518"></a>00518       <span class="keywordflow">if</span>(comm-&gt;MyPID() == 0)
<a name="l00519"></a>00519         std::cout &lt;&lt; <span class="stringliteral">&quot;Mesh refinement pass: &quot;</span> &lt;&lt; pass + 1 &lt;&lt; std::endl;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521       refiner.doBreak();
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="comment">// printCTD(*refinerPattern-&gt;getFromTopology());</span>
<a name="l00526"></a>00526 <span class="comment">// printCTD(*refinerPattern-&gt;getToTopology());</span>
<a name="l00527"></a>00527 
<a name="l00528"></a>00528     <span class="comment">// Need to reset cell topology if the cell topology has changed</span>
<a name="l00529"></a>00529 
<a name="l00530"></a>00530     <span class="keywordflow">if</span>(refinerPattern-&gt;getFromTopology()-&gt;name != refinerPattern-&gt;getToTopology()-&gt;name){
<a name="l00531"></a>00531 
<a name="l00532"></a>00532       <span class="keywordtype">int</span> numEB = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a7f5a8f068baee4ccb3b557d0ea267b4a">partVec</a>.size();
<a name="l00533"></a>00533 
<a name="l00534"></a>00534       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> eb=0; eb&lt;numEB; eb++) {
<a name="l00535"></a>00535 
<a name="l00536"></a>00536         <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#aa5b51847bf2f760e188e953d00d250e9">meshSpecs</a>[eb]-&gt;ctd = *refinerPattern-&gt;getToTopology();
<a name="l00537"></a>00537 
<a name="l00538"></a>00538       }
<a name="l00539"></a>00539     }
<a name="l00540"></a>00540   }
<a name="l00541"></a>00541 <span class="preprocessor">#endif</span>
<a name="l00542"></a>00542 <span class="preprocessor"></span>
<a name="l00543"></a>00543 }
<a name="l00544"></a>00544 
<a name="l00545"></a>00545 
<a name="l00546"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a32da7b972f22351c82db5311cd25b6f4">00546</a> <span class="keywordtype">void</span> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a32da7b972f22351c82db5311cd25b6f4" title="Re-load balance mesh.">Albany::GenericSTKMeshStruct::rebalanceInitialMesh</a>(<span class="keyword">const</span> Teuchos::RCP&lt;const Epetra_Comm&gt;&amp; <a class="code" href="felix__driver_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>){
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 
<a name="l00549"></a>00549   <span class="keywordtype">bool</span> rebalance = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Rebalance Mesh&quot;</span>, <span class="keyword">false</span>);
<a name="l00550"></a>00550   <span class="keywordtype">bool</span> useSerialMesh = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>-&gt;get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Use Serial Mesh&quot;</span>, <span class="keyword">false</span>);
<a name="l00551"></a>00551 
<a name="l00552"></a>00552   <span class="keywordflow">if</span>(rebalance || (useSerialMesh &amp;&amp; comm-&gt;NumProc() &gt; 1)){
<a name="l00553"></a>00553 
<a name="l00554"></a>00554     <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a4d61145fdfc8df27e3db2d169e5c8aa9" title="Re-load balance adapted mesh.">rebalanceAdaptedMesh</a>(<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a91d398e36ea823e2ffb509ed3ac5d809">params</a>, comm);
<a name="l00555"></a>00555 
<a name="l00556"></a>00556   }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a4d61145fdfc8df27e3db2d169e5c8aa9">00560</a> <span class="keywordtype">void</span> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a4d61145fdfc8df27e3db2d169e5c8aa9" title="Re-load balance adapted mesh.">Albany::GenericSTKMeshStruct::rebalanceAdaptedMesh</a>(<span class="keyword">const</span> Teuchos::RCP&lt;Teuchos::ParameterList&gt;&amp; params_,
<a name="l00561"></a>00561                                                         <span class="keyword">const</span> Teuchos::RCP&lt;const Epetra_Comm&gt;&amp; <a class="code" href="felix__driver_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>){
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 <span class="comment">// Zoltan is required here</span>
<a name="l00564"></a>00564 
<a name="l00565"></a>00565 <span class="preprocessor">#ifdef ALBANY_ZOLTAN</span>
<a name="l00566"></a>00566 <span class="preprocessor"></span>
<a name="l00567"></a>00567     <span class="keyword">using</span> std::cout; <span class="keyword">using</span> std::endl;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     <span class="keywordflow">if</span>(comm-&gt;NumProc() &lt;= 1)
<a name="l00570"></a>00570 
<a name="l00571"></a>00571       <span class="keywordflow">return</span>;
<a name="l00572"></a>00572 
<a name="l00573"></a>00573     <span class="keywordtype">double</span> imbalance;
<a name="l00574"></a>00574 
<a name="l00575"></a>00575     <a class="code" href="classAlbany_1_1AbstractSTKFieldContainer.html#ab29b7b67367d394e0364838c6e3fcf73">AbstractSTKFieldContainer::VectorFieldType</a>* coordinates_field = <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#aeb01f5da92ae994535ad182db65d0841">fieldContainer</a>-&gt;getCoordinatesField();
<a name="l00576"></a>00576 
<a name="l00577"></a>00577     stk::mesh::Selector selector(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;universal_part());
<a name="l00578"></a>00578     stk::mesh::Selector owned_selector(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;locally_owned_part());
<a name="l00579"></a>00579 
<a name="l00580"></a>00580     <span class="keywordflow">if</span>(comm-&gt;MyPID() == 0){
<a name="l00581"></a>00581 
<a name="l00582"></a>00582       std::cout &lt;&lt; <span class="stringliteral">&quot;Before rebal nelements &quot;</span> &lt;&lt; comm-&gt;MyPID() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; 
<a name="l00583"></a>00583         stk::mesh::count_selected_entities(owned_selector, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;buckets(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;element_rank())) &lt;&lt; endl;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585       std::cout &lt;&lt; <span class="stringliteral">&quot;Before rebal &quot;</span> &lt;&lt; comm-&gt;MyPID() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; 
<a name="l00586"></a>00586         stk::mesh::count_selected_entities(owned_selector, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;buckets(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;node_rank())) &lt;&lt; endl;
<a name="l00587"></a>00587     }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589 
<a name="l00590"></a>00590     imbalance = stk::rebalance::check_balance(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>, NULL, 
<a name="l00591"></a>00591       <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;node_rank(), &amp;selector);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     <span class="keywordflow">if</span>(comm-&gt;MyPID() == 0)
<a name="l00594"></a>00594 
<a name="l00595"></a>00595       std::cout &lt;&lt; <span class="stringliteral">&quot;Before rebalance: Imbalance threshold is = &quot;</span> &lt;&lt; imbalance &lt;&lt; endl;
<a name="l00596"></a>00596 
<a name="l00597"></a>00597     <span class="comment">// Use Zoltan to determine new partition. Set the desired parameters (if any) from the input file</span>
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     Teuchos::ParameterList graph_options;
<a name="l00600"></a>00600 
<a name="l00601"></a>00601    <span class="comment">//graph_options.sublist(stk::rebalance::Zoltan::default_parameters_name()).set(&quot;LOAD BALANCING METHOD&quot;      , &quot;4&quot;);</span>
<a name="l00602"></a>00602     <span class="comment">//graph_options.sublist(stk::rebalance::Zoltan::default_parameters_name()).set(&quot;ZOLTAN DEBUG LEVEL&quot;      , &quot;10&quot;);</span>
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     <span class="keywordflow">if</span>(params_-&gt;isSublist(<span class="stringliteral">&quot;Rebalance Options&quot;</span>)){
<a name="l00605"></a>00605 
<a name="l00606"></a>00606       <span class="keyword">const</span> Teuchos::RCP&lt;Teuchos::ParameterList&gt;&amp; load_balance_method = Teuchos::sublist(params_, <span class="stringliteral">&quot;Rebalance Options&quot;</span>);
<a name="l00607"></a>00607 
<a name="l00608"></a>00608     <span class="comment">// Set the desired parameters. The options are shown in</span>
<a name="l00609"></a>00609     <span class="comment">// TRILINOS_ROOT/packages/stk/stk_rebalance/ZontanPartition.cpp</span>
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 <span class="comment">//      load_balance_method.set(&quot;LOAD BALANCING METHOD&quot;      , &quot;4&quot;);</span>
<a name="l00612"></a>00612 <span class="comment">//      load_balance_method.set(&quot;ZOLTAN DEBUG LEVEL&quot;      , &quot;10&quot;);</span>
<a name="l00613"></a>00613 
<a name="l00614"></a>00614       graph_options.sublist(stk::rebalance::Zoltan::default_parameters_name()) = *load_balance_method;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616     }
<a name="l00617"></a>00617 
<a name="l00618"></a>00618     stk::rebalance::Zoltan zoltan_partition(<a class="code" href="namespaceAlbany.html#a15bbfa6de65c4c7e0314fb5589e7d041">Albany::getMpiCommFromEpetraComm</a>(*comm), <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a302b929f043c676f028876f393978787">numDim</a>, graph_options);
<a name="l00619"></a>00619     stk::rebalance::rebalance(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>, owned_selector, coordinates_field, NULL, zoltan_partition);
<a name="l00620"></a>00620 
<a name="l00621"></a>00621 
<a name="l00622"></a>00622     imbalance = stk::rebalance::check_balance(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>, NULL, 
<a name="l00623"></a>00623       <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;node_rank(), &amp;selector);
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="keywordflow">if</span>(comm-&gt;MyPID() == 0)
<a name="l00626"></a>00626       std::cout &lt;&lt; <span class="stringliteral">&quot;After rebalance: Imbalance threshold is = &quot;</span> &lt;&lt; imbalance &lt;&lt; endl;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628 <span class="preprocessor">#if 0 // Other experiments at rebalancing</span>
<a name="l00629"></a>00629 <span class="preprocessor"></span>
<a name="l00630"></a>00630     <span class="comment">// Configure Zoltan to use graph-based partitioning</span>
<a name="l00631"></a>00631     Teuchos::ParameterList graph;
<a name="l00632"></a>00632     Teuchos::ParameterList lb_method;
<a name="l00633"></a>00633     lb_method.set(<span class="stringliteral">&quot;LOAD BALANCING METHOD&quot;</span>      , <span class="stringliteral">&quot;4&quot;</span>);
<a name="l00634"></a>00634     graph.sublist(stk::rebalance::Zoltan::default_parameters_name()) = lb_method;
<a name="l00635"></a>00635 
<a name="l00636"></a>00636     stk::rebalance::Zoltan zoltan_partitiona(<a class="code" href="namespaceAlbany.html#a15bbfa6de65c4c7e0314fb5589e7d041">Albany::getMpiCommFromEpetraComm</a>(*comm), <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a302b929f043c676f028876f393978787">numDim</a>, graph);
<a name="l00637"></a>00637 
<a name="l00638"></a>00638     *out &lt;&lt; <span class="stringliteral">&quot;Universal part &quot;</span> &lt;&lt; comm-&gt;MyPID() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; 
<a name="l00639"></a>00639       stk::mesh::count_selected_entities(selector, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;buckets(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;element_rank())) &lt;&lt; endl;
<a name="l00640"></a>00640     *out &lt;&lt; <span class="stringliteral">&quot;Owned part &quot;</span> &lt;&lt; comm-&gt;MyPID() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; 
<a name="l00641"></a>00641       stk::mesh::count_selected_entities(owned_selector, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;buckets(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;element_rank())) &lt;&lt; endl;
<a name="l00642"></a>00642 
<a name="l00643"></a>00643     stk::rebalance::rebalance(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>, owned_selector, coordinates_field, NULL, zoltan_partitiona);
<a name="l00644"></a>00644 
<a name="l00645"></a>00645     *out &lt;&lt; <span class="stringliteral">&quot;After rebal &quot;</span> &lt;&lt; comm-&gt;MyPID() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; 
<a name="l00646"></a>00646       stk::mesh::count_selected_entities(owned_selector, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;buckets(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;node_rank())) &lt;&lt; endl;
<a name="l00647"></a>00647     *out &lt;&lt; <span class="stringliteral">&quot;After rebal nelements &quot;</span> &lt;&lt; comm-&gt;MyPID() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; 
<a name="l00648"></a>00648       stk::mesh::count_selected_entities(owned_selector, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>-&gt;buckets(<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;element_rank())) &lt;&lt; endl;
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     imbalance = stk::rebalance::check_balance(*<a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a943f4f4b0d90c74b94e299f5471dbc35">bulkData</a>, NULL, 
<a name="l00652"></a>00652       <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#abf63f8821561dea275706c29dae5a697">metaData</a>-&gt;node_rank(), &amp;selector);
<a name="l00653"></a>00653 
<a name="l00654"></a>00654     <span class="keywordflow">if</span>(comm-&gt;MyPID() == 0){
<a name="l00655"></a>00655 
<a name="l00656"></a>00656       *out &lt;&lt; <span class="stringliteral">&quot;Before second rebal: Imbalance threshold is = &quot;</span> &lt;&lt; imbalance &lt;&lt; endl;
<a name="l00657"></a>00657 
<a name="l00658"></a>00658     }
<a name="l00659"></a>00659 <span class="preprocessor">#endif</span>
<a name="l00660"></a>00660 <span class="preprocessor"></span>
<a name="l00661"></a>00661 <span class="preprocessor">#endif  //ALBANY_ZOLTAN</span>
<a name="l00662"></a>00662 <span class="preprocessor"></span>
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 
<a name="l00665"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#ad5d821f805dc9cff3d2567548b4ce604">00665</a> <span class="keywordtype">void</span> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#ad5d821f805dc9cff3d2567548b4ce604" title="Process STK mesh for element block specific info.">Albany::GenericSTKMeshStruct::setupMeshBlkInfo</a>()
<a name="l00666"></a>00666 {
<a name="l00667"></a>00667 <span class="preprocessor">#if 0</span>
<a name="l00668"></a>00668 <span class="preprocessor"></span>
<a name="l00669"></a>00669    <span class="keywordtype">int</span> nBlocks = <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#aa5b51847bf2f760e188e953d00d250e9">meshSpecs</a>.size();
<a name="l00670"></a>00670 
<a name="l00671"></a>00671    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nBlocks; i++){
<a name="l00672"></a>00672 
<a name="l00673"></a>00673       <span class="keyword">const</span> <a class="code" href="structAlbany_1_1MeshSpecsStruct.html">MeshSpecsStruct</a> &amp;ms = *<a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#aa5b51847bf2f760e188e953d00d250e9">meshSpecs</a>[i];
<a name="l00674"></a>00674 
<a name="l00675"></a>00675       <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a5075974c2d1c40902a0fdd2c04a9d5b0">meshDynamicData</a>[i] = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="classAlbany_1_1CellSpecs.html">CellSpecs</a>(ms.<a class="code" href="structAlbany_1_1MeshSpecsStruct.html#a5f1877643a8ff1bd7632b4e67b8feee9">ctd</a>, ms.<a class="code" href="structAlbany_1_1MeshSpecsStruct.html#a48b9a2cdad5bf020294f441d3a6a7836">worksetSize</a>, ms.<a class="code" href="structAlbany_1_1MeshSpecsStruct.html#a4cdca1e1acd9357e91a3558e612b1227">cubatureDegree</a>,
<a name="l00676"></a>00676                       <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#a302b929f043c676f028876f393978787">numDim</a>, <a class="code" href="structAlbany_1_1AbstractSTKMeshStruct.html#af8cd56ae8f9776c957c4d074e66a8d8b">neq</a>, 0, <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a26257475329565d714ecba3267129c31">useCompositeTet</a>()));
<a name="l00677"></a>00677 
<a name="l00678"></a>00678    }
<a name="l00679"></a>00679 <span class="preprocessor">#endif</span>
<a name="l00680"></a>00680 <span class="preprocessor"></span>
<a name="l00681"></a>00681 }
<a name="l00682"></a>00682 
<a name="l00683"></a>00683 
<a name="l00684"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a0d040599f4df72bc590665f7b404b176">00684</a> <span class="keywordtype">void</span> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a0d040599f4df72bc590665f7b404b176">Albany::GenericSTKMeshStruct::printParts</a>(stk::mesh::fem::FEMMetaData *metaData){
<a name="l00685"></a>00685 
<a name="l00686"></a>00686     std::cout &lt;&lt; <span class="stringliteral">&quot;Printing all part names of the parts found in the metaData:&quot;</span> &lt;&lt; std::endl;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688     stk::mesh::PartVector all_parts = metaData-&gt;get_parts();
<a name="l00689"></a>00689 
<a name="l00690"></a>00690     <span class="keywordflow">for</span> (stk::mesh::PartVector::iterator i_part = all_parts.begin(); i_part != all_parts.end(); ++i_part)
<a name="l00691"></a>00691     {
<a name="l00692"></a>00692        stk::mesh::Part *  part = *i_part ;
<a name="l00693"></a>00693 
<a name="l00694"></a>00694        std::cout &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; part-&gt;name() &lt;&lt; std::endl;
<a name="l00695"></a>00695 
<a name="l00696"></a>00696     }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698 }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 <span class="keywordtype">void</span>
<a name="l00701"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#ac9820167de24c5bf68489128a3bb387e">00701</a> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#ac9820167de24c5bf68489128a3bb387e" title="Perform initial adaptation input checking.">Albany::GenericSTKMeshStruct::checkInput</a>(std::string option, std::string value, std::string allowed_values){
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 <span class="preprocessor">#ifdef ALBANY_STK_PERCEPT</span>
<a name="l00704"></a>00704 <span class="preprocessor"></span>      std::vector&lt;std::string&gt; vals = <a class="code" href="namespacePHAL.html#a6e3a1d737d4ec3cb5d0e4eccfb7828e6">stk::adapt::Util::split</a>(allowed_values, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l00705"></a>00705       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; vals.size(); i++)
<a name="l00706"></a>00706         {
<a name="l00707"></a>00707           <span class="keywordflow">if</span> (vals[i] == value)
<a name="l00708"></a>00708             <span class="keywordflow">return</span>;
<a name="l00709"></a>00709         }
<a name="l00710"></a>00710 
<a name="l00711"></a>00711        TEUCHOS_TEST_FOR_EXCEPTION(<span class="keyword">true</span>,
<a name="l00712"></a>00712          std::runtime_error,
<a name="l00713"></a>00713          <span class="stringliteral">&quot;Adaptation input error in GenericSTKMeshStruct initialization: bar option: &quot;</span> &lt;&lt; option &lt;&lt; std::endl);
<a name="l00714"></a>00714 <span class="preprocessor">#endif</span>
<a name="l00715"></a>00715 <span class="preprocessor"></span>}
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 Teuchos::RCP&lt;Teuchos::ParameterList&gt;
<a name="l00718"></a><a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a81cdcb00e08a795989c5ea1b859da13d">00718</a> <a class="code" href="classAlbany_1_1GenericSTKMeshStruct.html#a81cdcb00e08a795989c5ea1b859da13d">Albany::GenericSTKMeshStruct::getValidGenericSTKParameters</a>(std::string listname)<span class="keyword"> const</span>
<a name="l00719"></a>00719 <span class="keyword"></span>{
<a name="l00720"></a>00720   Teuchos::RCP&lt;Teuchos::ParameterList&gt; validPL = rcp(<span class="keyword">new</span> Teuchos::ParameterList(listname));;
<a name="l00721"></a>00721   validPL-&gt;set&lt;std::string&gt;(<span class="stringliteral">&quot;Cell Topology&quot;</span>, <span class="stringliteral">&quot;Quad&quot;</span> , <span class="stringliteral">&quot;Quad or Tri Cell Topology&quot;</span>);
<a name="l00722"></a>00722   validPL-&gt;set&lt;std::string&gt;(<span class="stringliteral">&quot;Exodus Output File Name&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l00723"></a>00723       <span class="stringliteral">&quot;Request exodus output to given file name. Requires SEACAS build&quot;</span>);
<a name="l00724"></a>00724   validPL-&gt;set&lt;std::string&gt;(<span class="stringliteral">&quot;Exodus Solution Name&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l00725"></a>00725       <span class="stringliteral">&quot;Name of solution output vector written to Exodus file. Requires SEACAS build&quot;</span>);
<a name="l00726"></a>00726   validPL-&gt;set&lt;std::string&gt;(<span class="stringliteral">&quot;Exodus Residual Name&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l00727"></a>00727       <span class="stringliteral">&quot;Name of residual output vector written to Exodus file. Requires SEACAS build&quot;</span>);
<a name="l00728"></a>00728   validPL-&gt;set&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;Exodus Write Interval&quot;</span>, 3, <span class="stringliteral">&quot;Step interval to write solution data to Exodus file&quot;</span>);
<a name="l00729"></a>00729   validPL-&gt;set&lt;std::string&gt;(<span class="stringliteral">&quot;NetCDF Output File Name&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l00730"></a>00730       <span class="stringliteral">&quot;Request NetCDF output to given file name. Requires SEACAS build&quot;</span>);
<a name="l00731"></a>00731   validPL-&gt;set&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NetCDF Write Interval&quot;</span>, 1, <span class="stringliteral">&quot;Step interval to write solution data to NetCDF file&quot;</span>);
<a name="l00732"></a>00732   validPL-&gt;set&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NetCDF Output Number of Latitudes&quot;</span>, 1, 
<a name="l00733"></a>00733       <span class="stringliteral">&quot;Number of samples in Latitude direction for NetCDF output. Default is 100.&quot;</span>);
<a name="l00734"></a>00734   validPL-&gt;set&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NetCDF Output Number of Longitudes&quot;</span>, 1, 
<a name="l00735"></a>00735       <span class="stringliteral">&quot;Number of samples in Longitude direction for NetCDF output. Default is 100.&quot;</span>);
<a name="l00736"></a>00736   validPL-&gt;set&lt;std::string&gt;(<span class="stringliteral">&quot;Method&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l00737"></a>00737     <span class="stringliteral">&quot;The discretization method, parsed in the Discretization Factory&quot;</span>);
<a name="l00738"></a>00738   validPL-&gt;set&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;Cubature Degree&quot;</span>, 3, <span class="stringliteral">&quot;Integration order sent to Intrepid&quot;</span>);
<a name="l00739"></a>00739   validPL-&gt;set&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;Cubature Rule&quot;</span>, 0, <span class="stringliteral">&quot;Integration rule sent to Intrepid: 0=GAUSS, 1=GAUSS_RADAU_LEFT, 2=GAUSS_RADAU_RIGHT, 3=GAUSS_LOBATTO&quot;</span>);
<a name="l00740"></a>00740   validPL-&gt;set&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;Workset Size&quot;</span>, 50, <span class="stringliteral">&quot;Upper bound on workset (bucket) size&quot;</span>);
<a name="l00741"></a>00741   validPL-&gt;set&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Interleaved Ordering&quot;</span>, <span class="keyword">true</span>, <span class="stringliteral">&quot;Flag for interleaved or blocked unknown ordering&quot;</span>);
<a name="l00742"></a>00742   validPL-&gt;set&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Separate Evaluators by Element Block&quot;</span>, <span class="keyword">false</span>,
<a name="l00743"></a>00743                      <span class="stringliteral">&quot;Flag for different evaluation trees for each Element Block&quot;</span>);
<a name="l00744"></a>00744   validPL-&gt;set&lt;std::string&gt;(<span class="stringliteral">&quot;Transform Type&quot;</span>, <span class="stringliteral">&quot;None&quot;</span>, <span class="stringliteral">&quot;None or ISMIP-HOM Test A&quot;</span>); <span class="comment">//for FELIX problem that require tranformation of STK mesh</span>
<a name="l00745"></a>00745   validPL-&gt;set&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Write Coordinates to MatrixMarket&quot;</span>, <span class="keyword">false</span>, <span class="stringliteral">&quot;Writing Coordinates to MatrixMarket File&quot;</span>); <span class="comment">//for writing coordinates to matrix market file</span>
<a name="l00746"></a>00746   validPL-&gt;set&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;FELIX alpha&quot;</span>, 0.0, <span class="stringliteral">&quot;Surface boundary inclination for FELIX problems (in degrees)&quot;</span>); <span class="comment">//for FELIX problem that require tranformation of STK mesh</span>
<a name="l00747"></a>00747   validPL-&gt;set&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;FELIX L&quot;</span>, 1, <span class="stringliteral">&quot;Domain length for FELIX problems&quot;</span>); <span class="comment">//for FELIX problem that require tranformation of STK mesh</span>
<a name="l00748"></a>00748 
<a name="l00749"></a>00749   validPL-&gt;set&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Contiguous IDs&quot;</span>, <span class="stringliteral">&quot;true&quot;</span>, <span class="stringliteral">&quot;Tells Ascii mesh reader is mesh has contiguous global IDs on 1 processor.&quot;</span>); <span class="comment">//for FELIX problem that require tranformation of STK mesh</span>
<a name="l00750"></a>00750 
<a name="l00751"></a>00751   Teuchos::Array&lt;std::string&gt; defaultFields;
<a name="l00752"></a>00752   validPL-&gt;set&lt;Teuchos::Array&lt;std::string&gt; &gt;(<span class="stringliteral">&quot;Restart Fields&quot;</span>, defaultFields, 
<a name="l00753"></a>00753                      <span class="stringliteral">&quot;Fields to pick up from the restart file when restarting&quot;</span>);
<a name="l00754"></a>00754   validPL-&gt;set&lt;Teuchos::Array&lt;std::string&gt; &gt;(<span class="stringliteral">&quot;Solution Vector Components&quot;</span>, defaultFields,
<a name="l00755"></a>00755       <span class="stringliteral">&quot;Names and layout of solution output vector written to Exodus file. Requires SEACAS build&quot;</span>);
<a name="l00756"></a>00756   validPL-&gt;set&lt;Teuchos::Array&lt;std::string&gt; &gt;(<span class="stringliteral">&quot;Residual Vector Components&quot;</span>, defaultFields,
<a name="l00757"></a>00757       <span class="stringliteral">&quot;Names and layout of residual output vector written to Exodus file. Requires SEACAS build&quot;</span>);
<a name="l00758"></a>00758 
<a name="l00759"></a>00759   validPL-&gt;set&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Use Serial Mesh&quot;</span>, <span class="keyword">false</span>, <span class="stringliteral">&quot;Read in a single mesh on PE 0 and rebalance&quot;</span>);
<a name="l00760"></a>00760   validPL-&gt;set&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Transfer Solution to Coordinates&quot;</span>, <span class="keyword">false</span>, <span class="stringliteral">&quot;Copies the solution vector to the coordinates for output&quot;</span>);
<a name="l00761"></a>00761 
<a name="l00762"></a>00762   validPL-&gt;set&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Use Serial Mesh&quot;</span>, <span class="keyword">false</span>, <span class="stringliteral">&quot;Read in a single mesh on PE 0 and rebalance&quot;</span>);
<a name="l00763"></a>00763   validPL-&gt;set&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Use Composite Tet 10&quot;</span>, <span class="keyword">false</span>, <span class="stringliteral">&quot;Flag to use the composite tet 10 basis in Intrepid&quot;</span>);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765   <span class="comment">// Uniform percept adaptation of input mesh prior to simulation</span>
<a name="l00766"></a>00766 
<a name="l00767"></a>00767   validPL-&gt;set&lt;std::string&gt;(<span class="stringliteral">&quot;STK Initial Refine&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;stk::percept refinement option to apply after the mesh is input&quot;</span>);
<a name="l00768"></a>00768   validPL-&gt;set&lt;std::string&gt;(<span class="stringliteral">&quot;STK Initial Enrich&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;stk::percept enrichment option to apply after the mesh is input&quot;</span>);
<a name="l00769"></a>00769   validPL-&gt;set&lt;std::string&gt;(<span class="stringliteral">&quot;STK Initial Convert&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;stk::percept conversion option to apply after the mesh is input&quot;</span>);
<a name="l00770"></a>00770   validPL-&gt;set&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Rebalance Mesh&quot;</span>, <span class="keyword">false</span>, <span class="stringliteral">&quot;Parallel re-load balance initial mesh after generation&quot;</span>);
<a name="l00771"></a>00771   validPL-&gt;set&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;Number of Refinement Passes&quot;</span>, 1, <span class="stringliteral">&quot;Number of times to apply the refinement process&quot;</span>);
<a name="l00772"></a>00772 
<a name="l00773"></a>00773   <span class="keywordflow">return</span> validPL;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775 }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Mar 26 2014 18:36:36 for Albany: a Trilinos-based PDE code by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
