<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Albany: a Trilinos-based PDE code: QCAD_StringFormulaEvaluator.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>QCAD_StringFormulaEvaluator.cpp</h1>  </div>
</div>
<div class="contents">
<a href="QCAD__StringFormulaEvaluator_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;list&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;exception&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="QCAD__StringFormulaEvaluator_8hpp.html">QCAD_StringFormulaEvaluator.hpp</a>&quot;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a><a class="code" href="classEvaluateException.html">00012</a> <span class="keyword">class </span><a class="code" href="classEvaluateException.html">EvaluateException</a>: <span class="keyword">public</span> std::exception
<a name="l00013"></a>00013 {
<a name="l00014"></a>00014 <span class="keyword">public</span>:
<a name="l00015"></a><a class="code" href="classEvaluateException.html#a28c5969187aab770593345e604f83e8f">00015</a>   <a class="code" href="classEvaluateException.html#a28c5969187aab770593345e604f83e8f">EvaluateException</a>(std::string message) {
<a name="l00016"></a>00016     <a class="code" href="classEvaluateException.html#ac08d4f30117d3ba26bc4393daab270a7">msg</a> = message;
<a name="l00017"></a>00017   }
<a name="l00018"></a><a class="code" href="classEvaluateException.html#a14a3105eb11a329e63683705d58eea52">00018</a>   <a class="code" href="classEvaluateException.html#a14a3105eb11a329e63683705d58eea52">~EvaluateException</a>() throw () {}
<a name="l00019"></a>00019 
<a name="l00020"></a><a class="code" href="classEvaluateException.html#a97c4d70fc3ad2b56d9471f598581024d">00020</a>   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classEvaluateException.html#a97c4d70fc3ad2b56d9471f598581024d">what</a>() <span class="keyword">const</span> throw() {
<a name="l00021"></a>00021     <span class="keywordflow">return</span> <a class="code" href="classEvaluateException.html#ac08d4f30117d3ba26bc4393daab270a7">msg</a>.c_str();
<a name="l00022"></a>00022   }
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="keyword">private</span>:
<a name="l00025"></a><a class="code" href="classEvaluateException.html#ac08d4f30117d3ba26bc4393daab270a7">00025</a>   std::string <a class="code" href="classEvaluateException.html#ac08d4f30117d3ba26bc4393daab270a7">msg</a>;
<a name="l00026"></a>00026 };
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> coordType&gt;
<a name="l00029"></a><a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">00029</a> coordType <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(std::string s, coordType x, coordType y, coordType z) {
<a name="l00030"></a>00030   <span class="keywordflow">if</span>(s == <span class="stringliteral">&quot;x&quot;</span>) <span class="keywordflow">return</span> x;
<a name="l00031"></a>00031   <span class="keywordflow">if</span>(s == <span class="stringliteral">&quot;y&quot;</span>) <span class="keywordflow">return</span> y;
<a name="l00032"></a>00032   <span class="keywordflow">if</span>(s == <span class="stringliteral">&quot;z&quot;</span>) <span class="keywordflow">return</span> z;
<a name="l00033"></a>00033   coordType t = atof(s.c_str()); <span class="comment">//Must be able to assign coordType with a double</span>
<a name="l00034"></a>00034   <span class="keywordflow">return</span> t;
<a name="l00035"></a>00035 }
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> coordType&gt;
<a name="l00039"></a><a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a657ff51e182cd1316b7289e9ffdaf56a">00039</a> std::string <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a657ff51e182cd1316b7289e9ffdaf56a">toStr</a>(coordType d) {
<a name="l00040"></a>00040   std::ostringstream convert; 
<a name="l00041"></a>00041   convert &lt;&lt; d;
<a name="l00042"></a>00042   <span class="keywordflow">return</span> convert.str();
<a name="l00043"></a>00043 }
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a573be9f81c67662231dcd289cfb55329">00045</a> <span class="keywordtype">void</span> <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a573be9f81c67662231dcd289cfb55329">printList</a>(std::list&lt;std::string&gt; l) {
<a name="l00046"></a>00046   <span class="keywordflow">for</span>(std::list&lt;std::string&gt;::iterator it = l.begin(); it != l.end(); ++it)
<a name="l00047"></a>00047     std::cout &lt;&lt; <span class="stringliteral">&quot;|&quot;</span> &lt;&lt; *it;
<a name="l00048"></a>00048   std::cout &lt;&lt; <span class="stringliteral">&quot;|&quot;</span> &lt;&lt; std::endl;
<a name="l00049"></a>00049 }
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> coordType&gt;
<a name="l00053"></a><a class="code" href="QCAD__StringFormulaEvaluator_8hpp.html#a5464546f2757f0148e5b09f57f824192">00053</a> coordType <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a5464546f2757f0148e5b09f57f824192">Evaluate</a>(std::string strExpression, coordType x, coordType y, coordType z)
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055   <span class="keywordtype">bool</span> bDebug = <span class="keyword">false</span>;
<a name="l00056"></a>00056   <span class="comment">//std::transform(expr.begin(), expr.end(), expr.begin(), ::tolower); // i.e., expr.tolower()</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058   std::string expr;
<a name="l00059"></a>00059   <span class="keywordflow">for</span>(std::string::iterator it = strExpression.begin(); it != strExpression.end(); ++it) {
<a name="l00060"></a>00060     <span class="keywordflow">if</span>(*it == <span class="charliteral">&#39; &#39;</span>) <span class="keywordflow">continue</span>;
<a name="l00061"></a>00061     expr += *it;
<a name="l00062"></a>00062   }
<a name="l00063"></a>00063 
<a name="l00064"></a>00064   <span class="keywordflow">if</span>(bDebug) { std::cout &lt;&lt; <span class="stringliteral">&quot;After manip: &quot;</span> &lt;&lt; expr &lt;&lt; std::endl; }
<a name="l00065"></a>00065 
<a name="l00066"></a>00066   std::list&lt;std::string&gt; stack;  <span class="comment">// not a std::stack because we need list operations later</span>
<a name="l00067"></a>00067   std::string value = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00068"></a>00068        
<a name="l00069"></a>00069   <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; expr.length(); i++) {
<a name="l00070"></a>00070     <span class="keywordflow">if</span>(bDebug) { std::cout &lt;&lt; <span class="stringliteral">&quot;i = &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;:  val=&quot;</span> &lt;&lt; value &lt;&lt; <span class="stringliteral">&quot;,  stack=&quot;</span>; <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a573be9f81c67662231dcd289cfb55329">printList</a>(stack); }
<a name="l00071"></a>00071     std::string s = expr.substr(i, 1);
<a name="l00072"></a>00072 
<a name="l00073"></a>00073     <span class="comment">// pick up any doublelogical operators first.</span>
<a name="l00074"></a>00074     <span class="keywordflow">if</span> (i &lt; expr.length() - 1) {
<a name="l00075"></a>00075       std::string op = expr.substr(i, 2);
<a name="l00076"></a>00076       <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;&lt;=&quot;</span> || op == <span class="stringliteral">&quot;&gt;=&quot;</span> || op == <span class="stringliteral">&quot;==&quot;</span>) {
<a name="l00077"></a>00077   stack.push_front(value);
<a name="l00078"></a>00078   value = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00079"></a>00079   stack.push_front(op);
<a name="l00080"></a>00080   i++;
<a name="l00081"></a>00081   <span class="keywordflow">continue</span>;
<a name="l00082"></a>00082       }
<a name="l00083"></a>00083     }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <span class="keywordtype">char</span> chr = s[0];
<a name="l00086"></a>00086     <span class="keywordflow">if</span> (!isdigit(chr) &amp;&amp; !isalpha(chr) &amp;&amp; chr != <span class="charliteral">&#39;.&#39;</span> &amp;&amp; value != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00087"></a>00087       stack.push_front(value);
<a name="l00088"></a>00088       value = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00089"></a>00089     }
<a name="l00090"></a>00090     
<a name="l00091"></a>00091     <span class="keywordflow">if</span> (s == <span class="stringliteral">&quot;(&quot;</span>) {
<a name="l00092"></a>00092       std::string innerExp = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00093"></a>00093       i++; <span class="comment">//Fetch Next Character</span>
<a name="l00094"></a>00094       <span class="keywordtype">int</span> bracketCount = 0;
<a name="l00095"></a>00095       <span class="keywordflow">for</span> (; i &lt; expr.length(); i++) {
<a name="l00096"></a>00096   s = expr.substr(i, 1);
<a name="l00097"></a>00097   <span class="keywordflow">if</span> (s == <span class="stringliteral">&quot;(&quot;</span>) bracketCount++;
<a name="l00098"></a>00098   <span class="keywordflow">if</span> (s == <span class="stringliteral">&quot;)&quot;</span>) {
<a name="l00099"></a>00099     <span class="keywordflow">if</span> (bracketCount == 0) <span class="keywordflow">break</span>;
<a name="l00100"></a>00100     bracketCount--;
<a name="l00101"></a>00101   }
<a name="l00102"></a>00102   innerExp += s;
<a name="l00103"></a>00103       }
<a name="l00104"></a>00104       <span class="keywordflow">if</span>(bracketCount != 0) 
<a name="l00105"></a>00105   <span class="keywordflow">throw</span> <a class="code" href="classEvaluateException.html">EvaluateException</a>(<span class="stringliteral">&quot;Mismatched parenthesis&quot;</span>);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107       stack.push_front( <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a657ff51e182cd1316b7289e9ffdaf56a">toStr</a>(<a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a5464546f2757f0148e5b09f57f824192">Evaluate</a>(innerExp,x,y,z)) );
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s == <span class="stringliteral">&quot;+&quot;</span> ||
<a name="l00110"></a>00110        s == <span class="stringliteral">&quot;-&quot;</span> ||
<a name="l00111"></a>00111        s == <span class="stringliteral">&quot;*&quot;</span> ||
<a name="l00112"></a>00112        s == <span class="stringliteral">&quot;/&quot;</span> ||
<a name="l00113"></a>00113        s == <span class="stringliteral">&quot;&lt;&quot;</span> ||
<a name="l00114"></a>00114        s == <span class="stringliteral">&quot;&gt;&quot;</span> ||
<a name="l00115"></a>00115        s == <span class="stringliteral">&quot;^&quot;</span>) {
<a name="l00116"></a>00116       stack.push_front(s);
<a name="l00117"></a>00117     }
<a name="l00118"></a>00118     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isdigit(chr) || isalpha(chr) || chr == <span class="charliteral">&#39;.&#39;</span>) {
<a name="l00119"></a>00119       <span class="keywordflow">if</span>(chr == <span class="charliteral">&#39;.&#39;</span> &amp;&amp; value.find(<span class="charliteral">&#39;.&#39;</span>) != std::string::npos)
<a name="l00120"></a>00120   <span class="keywordflow">throw</span> <a class="code" href="classEvaluateException.html">EvaluateException</a>(<span class="stringliteral">&quot;Invalid decimal.&quot;</span>);
<a name="l00121"></a>00121       value += s;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123       <span class="keywordflow">if</span> (i == (expr.length() - 1))
<a name="l00124"></a>00124   stack.push_front(value);
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126     <span class="keywordflow">else</span> {
<a name="l00127"></a>00127       <span class="keywordflow">throw</span> <a class="code" href="classEvaluateException.html">EvaluateException</a>(<span class="stringliteral">&quot;Invalid character.&quot;</span>);
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129   }
<a name="l00130"></a>00130   <span class="keywordflow">if</span>(bDebug) { std::cout &lt;&lt; <span class="stringliteral">&quot;Stack at end = &quot;</span>; <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a573be9f81c67662231dcd289cfb55329">printList</a>(stack); }
<a name="l00131"></a>00131 
<a name="l00132"></a>00132   <span class="keywordtype">double</span> result = 0;
<a name="l00133"></a>00133   std::list&lt;std::string&gt;&amp; list = stack; <span class="comment">//now we use stack as a list, so just for code readability</span>
<a name="l00134"></a>00134   std::list&lt;std::string&gt;::reverse_iterator it, itm1, itp1, begin;
<a name="l00135"></a>00135   begin = list.rbegin(); ++begin;
<a name="l00136"></a>00136   <span class="keywordflow">for</span>( it = begin; it != list.rend(); ++it) {
<a name="l00137"></a>00137     <span class="keywordflow">if</span> (*it == <span class="stringliteral">&quot;^&quot;</span>) {
<a name="l00138"></a>00138       it++; itm1 = it; it--; it--; itp1 = it; it++;  <span class="comment">//setup iterators</span>
<a name="l00139"></a>00139       *it = <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a657ff51e182cd1316b7289e9ffdaf56a">toStr</a>( pow(<a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(*itp1,x,y,z),<a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(*itm1,x,y,z)) );
<a name="l00140"></a>00140       list.erase(it.base()); itm1++; list.erase(itm1.base());  <span class="comment">//erase() erases the element *AFTER* what it points to</span>
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142   }
<a name="l00143"></a>00143   <span class="keywordflow">if</span>(bDebug) { std::cout &lt;&lt; <span class="stringliteral">&quot;List after ^ block = &quot;</span>; <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a573be9f81c67662231dcd289cfb55329">printList</a>(list); }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145   begin = list.rbegin(); ++begin;
<a name="l00146"></a>00146   <span class="keywordflow">for</span>( it = begin; it != list.rend(); ++it) {
<a name="l00147"></a>00147     <span class="keywordflow">if</span> (*it == <span class="stringliteral">&quot;/&quot;</span>) {
<a name="l00148"></a>00148       it++; itm1 = it; it--; it--; itp1 = it; it++;  <span class="comment">//setup iterators</span>
<a name="l00149"></a>00149       *it = <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a657ff51e182cd1316b7289e9ffdaf56a">toStr</a>( <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(*itp1,x,y,z) / <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(*itm1,x,y,z) );
<a name="l00150"></a>00150       list.erase(it.base()); itm1++; list.erase(itm1.base());  <span class="comment">//erase() erases the element *AFTER* what it points to</span>
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152   }
<a name="l00153"></a>00153   <span class="keywordflow">if</span>(bDebug) { std::cout &lt;&lt; <span class="stringliteral">&quot;List after / block = &quot;</span>; <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a573be9f81c67662231dcd289cfb55329">printList</a>(list); }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155   begin = list.rbegin(); ++begin;
<a name="l00156"></a>00156   <span class="keywordflow">for</span>( it = begin; it != list.rend(); ++it) {
<a name="l00157"></a>00157     <span class="keywordflow">if</span> (*it == <span class="stringliteral">&quot;*&quot;</span>) {
<a name="l00158"></a>00158       it++; itm1 = it; it--; it--; itp1 = it; it++;  <span class="comment">//setup iterators</span>
<a name="l00159"></a>00159       *it = <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a657ff51e182cd1316b7289e9ffdaf56a">toStr</a>( <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(*itp1,x,y,z) * <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(*itm1,x,y,z) );
<a name="l00160"></a>00160       list.erase(it.base()); itm1++; list.erase(itm1.base());  <span class="comment">//erase() erases the element *AFTER* what it points to</span>
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162   }
<a name="l00163"></a>00163   <span class="keywordflow">if</span>(bDebug) { std::cout &lt;&lt; <span class="stringliteral">&quot;List after * block = &quot;</span>; <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a573be9f81c67662231dcd289cfb55329">printList</a>(list); }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   begin = list.rbegin();
<a name="l00166"></a>00166   <span class="keywordflow">for</span>( it = begin; it != list.rend(); ++it) {
<a name="l00167"></a>00167     <span class="keywordflow">if</span> (*it == <span class="stringliteral">&quot;+&quot;</span>) {      
<a name="l00168"></a>00168       <span class="keywordflow">if</span> (it.base() == list.end()) { <span class="comment">// unary plus</span>
<a name="l00169"></a>00169   it++; itm1 = it; it--; <span class="comment">//setup iterators</span>
<a name="l00170"></a>00170   *it = <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a657ff51e182cd1316b7289e9ffdaf56a">toStr</a>( <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(*itm1,x,y,z) );
<a name="l00171"></a>00171   itm1++; list.erase(itm1.base());  <span class="comment">//erase() erases the element *AFTER* what it points to</span>
<a name="l00172"></a>00172       } 
<a name="l00173"></a>00173       <span class="keywordflow">else</span> { <span class="comment">// binary plus</span>
<a name="l00174"></a>00174   it++; itm1 = it; it--; it--; itp1 = it; it++;  <span class="comment">//setup iterators</span>
<a name="l00175"></a>00175   *it = <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a657ff51e182cd1316b7289e9ffdaf56a">toStr</a>( <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(*itp1,x,y,z) + <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(*itm1,x,y,z) );
<a name="l00176"></a>00176   list.erase(it.base()); itm1++; list.erase(itm1.base());  <span class="comment">//erase() erases the element *AFTER* what it points to</span>
<a name="l00177"></a>00177       }
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179   }
<a name="l00180"></a>00180   <span class="keywordflow">if</span>(bDebug) { std::cout &lt;&lt; <span class="stringliteral">&quot;List after + block = &quot;</span>; <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a573be9f81c67662231dcd289cfb55329">printList</a>(list); }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   begin = list.rbegin();
<a name="l00183"></a>00183   <span class="keywordflow">for</span>( it = begin; it != list.rend(); ++it) {
<a name="l00184"></a>00184     <span class="keywordflow">if</span> (*it == <span class="stringliteral">&quot;-&quot;</span>) {
<a name="l00185"></a>00185       <span class="keywordflow">if</span> (it.base() == list.end()) { <span class="comment">// unary minus</span>
<a name="l00186"></a>00186   it++; itm1 = it; it--; <span class="comment">//setup iterators</span>
<a name="l00187"></a>00187   *it = <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a657ff51e182cd1316b7289e9ffdaf56a">toStr</a>( -<a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(*itm1,x,y,z) );
<a name="l00188"></a>00188   itm1++; list.erase(itm1.base());  <span class="comment">//erase() erases the element *AFTER* what it points to</span>
<a name="l00189"></a>00189       } 
<a name="l00190"></a>00190       <span class="keywordflow">else</span> { <span class="comment">// binary minus</span>
<a name="l00191"></a>00191   it++; itm1 = it; it--; it--; itp1 = it; it++;  <span class="comment">//setup iterators</span>
<a name="l00192"></a>00192   *it = <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a657ff51e182cd1316b7289e9ffdaf56a">toStr</a>( <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(*itp1,x,y,z) - <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(*itm1,x,y,z) );
<a name="l00193"></a>00193   list.erase(it.base()); itm1++; list.erase(itm1.base());  <span class="comment">//erase() erases the element *AFTER* what it points to</span>
<a name="l00194"></a>00194       }
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196   }
<a name="l00197"></a>00197   <span class="keywordflow">if</span>(bDebug) { std::cout &lt;&lt; <span class="stringliteral">&quot;List after - block = &quot;</span>; <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a573be9f81c67662231dcd289cfb55329">printList</a>(list); }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199   <span class="comment">//Logic operators: use list as a stack, popping from the back</span>
<a name="l00200"></a>00200   <span class="keywordflow">while</span> (list.size() &gt;= 3) {  
<a name="l00201"></a>00201     coordType right = <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(list.back(), x,y,z); list.pop_back();
<a name="l00202"></a>00202     std::string op = list.back(); list.pop_back();
<a name="l00203"></a>00203     coordType left = <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(list.back(), x,y,z); list.pop_back();
<a name="l00204"></a>00204 
<a name="l00205"></a>00205     <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;&lt;&quot;</span>) result = (left &lt; right) ? 1 : 0;
<a name="l00206"></a>00206     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;&gt;&quot;</span>) result = (left &gt; right) ? 1 : 0;
<a name="l00207"></a>00207     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;&lt;=&quot;</span>) result = (left &lt;= right) ? 1 : 0;
<a name="l00208"></a>00208     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;&gt;=&quot;</span>) result = (left &gt;= right) ? 1 : 0;
<a name="l00209"></a>00209     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;==&quot;</span>) result = (left == right) ? 1 : 0;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211     list.push_back( <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a657ff51e182cd1316b7289e9ffdaf56a">toStr</a>(result) );
<a name="l00212"></a>00212   }
<a name="l00213"></a>00213    
<a name="l00214"></a>00214   <span class="keywordflow">return</span> <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#ab2fad2c07335be3757db5dfc70d1f8c9">toDbl</a>(list.back(),x,y,z);
<a name="l00215"></a>00215 }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 <span class="comment">//Explicit instantiations to fix linker errors -- hardcoded now; need to do this better (Andy/Eric?)</span>
<a name="l00218"></a>00218 <span class="preprocessor">#include &quot;<a class="code" href="PHAL__AlbanyTraits_8hpp.html">PHAL_AlbanyTraits.hpp</a>&quot;</span>
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="keyword">template</span> <span class="keywordtype">double</span> <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a460f062651f32b0217930a7855f43d07">Evaluate&lt;double&gt;</a>(std::string, double, double, double); <span class="comment">// explicit instantiation.</span>
<a name="l00221"></a>00221 <span class="keyword">template</span> <a class="code" href="Albany__DataTypes_8hpp.html#a9873eef23bdd284ea9b675234676e7db">FadType</a> <a class="code" href="QCAD__StringFormulaEvaluator_8cpp.html#a1a021918dca2c7ea21c66cb8848b3e1c">Evaluate&lt;FadType&gt;</a>(std::string, FadType, FadType, FadType); <span class="comment">// explicit instantiation.</span>
<a name="l00222"></a>00222 <span class="preprocessor">#ifdef ALBANY_FADTYPE_NOTEQUAL_TANFADTYPE</span>
<a name="l00223"></a>00223 <span class="preprocessor"></span><span class="keyword">template</span> <a class="code" href="Albany__DataTypes_8hpp.html#a6553f3ba5e7401b54b9bcb7d45d047d5">TanFadType</a> Evaluate&lt;TanFadType&gt;(std::string, TanFadType, TanFadType, TanFadType); <span class="comment">// explicit instantiation.</span>
<a name="l00224"></a>00224 <span class="preprocessor">#endif</span>
<a name="l00225"></a>00225 <span class="preprocessor"></span>
<a name="l00226"></a>00226 <span class="comment">//Uncomment for testing - then this file alone builds a command line calculator</span>
<a name="l00227"></a>00227 <span class="comment">/*int main(int argc, char* argv[]) {</span>
<a name="l00228"></a>00228 <span class="comment"></span>
<a name="l00229"></a>00229 <span class="comment">  double result;</span>
<a name="l00230"></a>00230 <span class="comment">  double x=1, y=2, z=3;</span>
<a name="l00231"></a>00231 <span class="comment">  std::string input;</span>
<a name="l00232"></a>00232 <span class="comment"></span>
<a name="l00233"></a>00233 <span class="comment">  while (true) {</span>
<a name="l00234"></a>00234 <span class="comment">    std::cout &lt;&lt; &quot;Please enter an expression to evaluate (q to quit) x=1,y=2,z=3: &quot;;</span>
<a name="l00235"></a>00235 <span class="comment">    std::getline(std::cin, input);</span>
<a name="l00236"></a>00236 <span class="comment">    if( input == &quot;q&quot; ) break;</span>
<a name="l00237"></a>00237 <span class="comment">    try {</span>
<a name="l00238"></a>00238 <span class="comment">      result = Evaluate(input,x,y,z);</span>
<a name="l00239"></a>00239 <span class="comment">    }</span>
<a name="l00240"></a>00240 <span class="comment">    catch(std::exception&amp; e) {</span>
<a name="l00241"></a>00241 <span class="comment">      std::cout &lt;&lt; &quot;Error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;</span>
<a name="l00242"></a>00242 <span class="comment">      continue;</span>
<a name="l00243"></a>00243 <span class="comment">    }</span>
<a name="l00244"></a>00244 <span class="comment">    std::cout &lt;&lt; &quot;&gt;&gt; &quot; &lt;&lt; result &lt;&lt; std::endl;</span>
<a name="l00245"></a>00245 <span class="comment">  }</span>
<a name="l00246"></a>00246 <span class="comment">  std::cout &lt;&lt; &quot;Goodbye!&quot; &lt;&lt; std::endl;</span>
<a name="l00247"></a>00247 <span class="comment"></span>
<a name="l00248"></a>00248 <span class="comment">  //std::string test1(&quot;5+4&quot;);</span>
<a name="l00249"></a>00249 <span class="comment">  //double result1 = Evaluate(test1);</span>
<a name="l00250"></a>00250 <span class="comment">  //std::cout &lt;&lt; test1 &lt;&lt; &quot; = &quot; &lt;&lt; result1 &lt;&lt; std::endl;</span>
<a name="l00251"></a>00251 <span class="comment">  return 0;</span>
<a name="l00252"></a>00252 <span class="comment">}*/</span>
<a name="l00253"></a>00253   
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Mar 26 2014 18:36:44 for Albany: a Trilinos-based PDE code by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
